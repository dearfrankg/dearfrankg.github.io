<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    <title>dev notes</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/gitment.css">
    <link rel="stylesheet" href="/css/font_859455_eaq7v6w8ktj.css">
</head>

<body>
<header class="header">
    <div class="header-inner">
        <div class="header-title">

        </div>
        <nav class="header-nav">
            
            <a href="/" class="header-nav-link">
                Home
            </a>
            

            
            <a href="/archives" class="header-nav-link">
                Archives
            </a>
            

            
            <a href="/tags" class="header-nav-link">
                Tags
            </a>
            

            
        </nav>
    </div>
</header>
<header class="mobile-header">
    <div class="mobile-nav">
        <div class="mobile-nav-icon">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <div class="mobile-nav-title">
            <a href="/" class="mobile-nav-title-link">Frank Gutierrez's Blog</a>
        </div>

    </div>
    <nav class="mobile-menu">
        <ul class="mobile-menu-list">
            <li class="mobile-menu-item">
                <i class="iconfont icon-home"></i>
                <a href="/" class="mobile-nav-link">Home</a>
            </li>
            <li class="mobile-menu-item">
                <i class="iconfont icon-archive"></i>
                <a href="/archives" class="mobile-nav-link">Archives</a>
            </li>
            <li class="mobile-menu-item">
                <i class="iconfont icon-tag"></i>
                <a href="/tags" class="mobile-nav-link">Tags</a>
            </li>
            <li class="mobile-menu-item">
                <i class="iconfont icon-about"></i>
                <a href="/about/" class="mobile-nav-link">About</a>
            </li>
        </ul>
    </nav>
</header>
<div class="main">
    <div class="content-inner">
        <div class="posts">
    
        <article class="post-abstract">
            <div class="post-title">
                <h2><a class="post-title-link" href="/2018/12/15/20181215-example-databases/">MySQL Refresher</a></h2>
            </div>
            <div class="post-meta">
                <span class="post-time">2018-12-15</span>
                
            </div>
            <div class="post-content">
                
                    <h2 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h2><p>It was time to practice my SQL to keep it fresh and up to date with the new SQL engines (mysql 8.x)</p>
<h3 id="Update-to-mysql-8-x"><a href="#Update-to-mysql-8-x" class="headerlink" title="Update to mysql 8.x"></a>Update to mysql 8.x</h3><p>You need the latest version to ge the latest features. You don’t want to be so quick to upgade production.</p>
<ul>
<li><code>mysql services stop mysql</code></li>
<li><code>brew upgrade mysql</code></li>
<li><code>brew services start mysql</code></li>
</ul>
<h3 id="Upgrade-Sequel-Pro"><a href="#Upgrade-Sequel-Pro" class="headerlink" title="Upgrade Sequel Pro"></a>Upgrade Sequel Pro</h3><p>I needed to go to the <strong>nightly</strong> build to make it work with mysql 8.x</p>
<ul>
<li><code>brew uninstall sequel-pro</code></li>
<li><code>brew cask install homebrew/cask-versions/sequel-pro-nightly</code></li>
</ul>
<h3 id="mysql-8-x-reference-manual"><a href="#mysql-8-x-reference-manual" class="headerlink" title="mysql 8.x reference manual"></a>mysql 8.x reference manual</h3><ul>
<li><a href="https://goo.gl/rbm7u7" target="_blank" rel="noopener">mysql 8.x reference manual</a></li>
</ul>
<h3 id="Get-example-databases"><a href="#Get-example-databases" class="headerlink" title="Get example databases"></a>Get example databases</h3><p>Download from <a href="https://goo.gl/Fu4TVc" target="_blank" rel="noopener">here</a> for most, and <a href="http://www.mysqltutorial.org/wp-content/uploads/2018/03/mysqlsampledatabase.zip" target="_blank" rel="noopener">here</a> for the classicmodels database.</p>
<ul>
<li>employee data</li>
<li>world database</li>
<li>world_x database</li>
<li>sakila database</li>
<li>menagerie database</li>
<li>classicmodels</li>
</ul>
<p>The classicmodels database is used for the follwing tutorial:</p>
<ul>
<li><a href="https://goo.gl/4QuuU" target="_blank" rel="noopener">Tutorial</a></li>
</ul>
<h2 id="Kicking-the-tires"><a href="#Kicking-the-tires" class="headerlink" title="Kicking the tires"></a>Kicking the tires</h2><p>I will use the <code>employees</code> database to try some queries. After a while I was able to do simple queries as expected yet there were some queries requiring me to do backflips.</p>
<h2 id="Show-each-department’s-highest-paid-employee-and-their-salary"><a href="#Show-each-department’s-highest-paid-employee-and-their-salary" class="headerlink" title="Show each department’s highest paid employee and their salary"></a>Show each department’s highest paid employee and their salary</h2><h3 id="Aggregating-the-data"><a href="#Aggregating-the-data" class="headerlink" title="Aggregating the data"></a>Aggregating the data</h3><p>Most examples online show how to search a table with everything in one table. I do not have a table with everything in one table but I can write a query that will collect all the data I need for that one table.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  dept_name dept,</span><br><span class="line">  emp_no my_emp_no,</span><br><span class="line">  <span class="keyword">concat</span>(first_name, <span class="string">' '</span>, last_name) <span class="keyword">name</span>,</span><br><span class="line">  <span class="keyword">max</span>(salary) salary</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  departments</span><br><span class="line">  <span class="keyword">join</span> dept_emp <span class="keyword">using</span> (dept_no)</span><br><span class="line">  <span class="keyword">join</span> employees <span class="keyword">using</span> (emp_no)</span><br><span class="line">  <span class="keyword">join</span> salaries <span class="keyword">using</span> (emp_no)</span><br><span class="line"></span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  salary &gt; <span class="number">120000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line">  my_emp_no,</span><br><span class="line">  dept</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>To get the employee info I needed to join <code>dept_emp</code> then join <code>employees</code></li>
<li>To ge the salary info I needed to join <code>salaries</code></li>
</ul>
<p><strong>developer trick:</strong></p>
<ul>
<li>At present this is a slow query. To speed things up during developent I can add the where clause temporarily. We will dramatically reduce the number of employees that have to be iterated over, by filtering to show only employees making over 120k. This works because every department has an employee making over this amount.</li>
</ul>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">+--------------------+-----------+---------------------------+--------+</span><br><span class="line">| dept               | my_emp_no | name                      | salary |</span><br><span class="line">+--------------------+-----------+---------------------------+--------+</span><br><span class="line">...</span><br><span class="line">| Production         |    456344 | Jessie Thiran             | 120910 |</span><br><span class="line">| Production         |    460878 | Jeanna Ghalwash           | 124663 |</span><br><span class="line">| Production         |    474176 | Shimshon Azuma            | 137563 |</span><br><span class="line">| Quality Management |     73644 | Eberhardt Backhouse       | 122376 |</span><br><span class="line">| Quality Management |    253338 | Yuping Heiserman          | 120459 |</span><br><span class="line">| Quality Management |    280550 | Honglan Petereit          | 122965 |</span><br><span class="line">| Quality Management |    400008 | Mandell Alencar           | 123566 |</span><br><span class="line">| Quality Management |    472905 | Shin Luck                 | 132103 |</span><br><span class="line">| Research           |     34947 | Mario Perfilyeva          | 124181 |</span><br><span class="line">| Research           |     37869 | Jayesh Schrift            | 121363 |</span><br><span class="line">| Research           |     60869 | Utz Menhardt              | 123530 |</span><br><span class="line">| Research           |     76073 | Mitchel Furedi            | 122940 |</span><br><span class="line">...</span><br><span class="line">+--------------------+-----------+---------------------------+--------+</span><br></pre></td></tr></table></figure>
<h3 id="Derived-Tables"><a href="#Derived-Tables" class="headerlink" title="Derived Tables"></a>Derived Tables</h3><p>I used the <code>emp_no</code> column in the previous query to make sure we got distinct employees (I could not depend on the name). Yet I don’t want that <code>emp_no</code> in my report so I strip it out with the following query. Here’s where the <code>derived tables</code> come in handy. We use the <code>from</code> clause to create a <code>derived table</code> which requires an aliases, <code>a</code> in this case. Note the <code>outer query</code> can use the derived table alias. We’ll use it again in a minute.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  a.dept,</span><br><span class="line">  a.name,</span><br><span class="line">  a.salary</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line"></span><br><span class="line">    <span class="keyword">select</span></span><br><span class="line">      dept_name dept,</span><br><span class="line">      emp_no my_emp_no,</span><br><span class="line">      <span class="keyword">concat</span>(first_name, <span class="string">' '</span>, last_name) <span class="keyword">name</span>,</span><br><span class="line">      <span class="keyword">max</span>(salary) salary</span><br><span class="line"></span><br><span class="line">    <span class="keyword">from</span></span><br><span class="line">      departments</span><br><span class="line">      <span class="keyword">join</span> dept_emp <span class="keyword">using</span> (dept_no)</span><br><span class="line">      <span class="keyword">join</span> employees <span class="keyword">using</span> (emp_no)</span><br><span class="line">      <span class="keyword">join</span> salaries <span class="keyword">using</span> (emp_no)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">where</span></span><br><span class="line">      salary &gt; <span class="number">120000</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line">      my_emp_no,</span><br><span class="line">      dept</span><br><span class="line"></span><br><span class="line">) <span class="keyword">as</span> a</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">+--------------------+---------------------------+--------+</span><br><span class="line">| dept               | name                      | salary |</span><br><span class="line">+--------------------+---------------------------+--------+...</span><br><span class="line">| Production         | Manibrata Eterovic        | 121827 |</span><br><span class="line">| Production         | Adas Warwick              | 123415 |</span><br><span class="line">| Production         | Jessie Thiran             | 120910 |</span><br><span class="line">| Production         | Jeanna Ghalwash           | 124663 |</span><br><span class="line">| Production         | Shimshon Azuma            | 137563 |</span><br><span class="line">| Quality Management | Eberhardt Backhouse       | 122376 |</span><br><span class="line">| Quality Management | Yuping Heiserman          | 120459 |</span><br><span class="line">| Quality Management | Honglan Petereit          | 122965 |</span><br><span class="line">| Quality Management | Mandell Alencar           | 123566 |</span><br><span class="line">| Quality Management | Shin Luck                 | 132103 |</span><br><span class="line">| Research           | Mario Perfilyeva          | 124181 |</span><br><span class="line">| Research           | Jayesh Schrift            | 121363 |</span><br><span class="line">| Research           | Utz Menhardt              | 123530 |</span><br><span class="line">| Research           | Mitchel Furedi            | 122940 |</span><br><span class="line">| Research           | Barry Hofstetter          | 121864 |</span><br><span class="line">...</span><br><span class="line">+--------------------+---------------------------+--------+</span><br></pre></td></tr></table></figure>
<h3 id="Grouping-without-GROUP-BY"><a href="#Grouping-without-GROUP-BY" class="headerlink" title="Grouping without GROUP BY"></a>Grouping without GROUP BY</h3><p>We want to group the previous table by <code>department name</code> and <code>max(salary)</code>. Normally we would go to the <code>group by</code> command to group but it won’t work in this case because of the <code>employee name</code> preventing us from using <code>group by</code>.</p>
<p>To group we need the max(salary) for the department. Let’s start with a query that gets that done.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  dept_name dept,</span><br><span class="line">  <span class="keyword">max</span>(salary) salary</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  departments</span><br><span class="line">  <span class="keyword">join</span> dept_emp <span class="keyword">using</span> (dept_no)</span><br><span class="line">  <span class="keyword">join</span> employees <span class="keyword">using</span> (emp_no)</span><br><span class="line">  <span class="keyword">join</span> salaries <span class="keyword">using</span> (emp_no)</span><br><span class="line"></span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  salary &gt; <span class="number">120000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line">  dept</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">+--------------------+--------+</span><br><span class="line">| dept               | salary |</span><br><span class="line">+--------------------+--------+</span><br><span class="line">| Sales              | 158220 |</span><br><span class="line">| Marketing          | 145128 |</span><br><span class="line">| Production         | 138273 |</span><br><span class="line">| Customer Service   | 144866 |</span><br><span class="line">| Finance            | 142395 |</span><br><span class="line">| Development        | 144434 |</span><br><span class="line">| Research           | 130211 |</span><br><span class="line">| Human Resources    | 141953 |</span><br><span class="line">| Quality Management | 132103 |</span><br><span class="line">+--------------------+--------+</span><br></pre></td></tr></table></figure>
<h3 id="Joining-a-derived-table"><a href="#Joining-a-derived-table" class="headerlink" title="Joining a derived table"></a>Joining a derived table</h3><p>We will make that previous query which provide the max salary for the department and make it into a <code>derived table</code> using the <code>join</code> command like so. Note again we use an alias <code>b</code> for the new <code>derived table</code>. Then using the <code>on</code> section we filter the original table with repeat values to only show the lines that match both the <code>department-name</code> and the <code>max-salary</code>. Let’s add our <code>join</code> to the previous query to see the final query.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">join (</span><br><span class="line"></span><br><span class="line">    <span class="keyword">select</span></span><br><span class="line">      dept_name dept,</span><br><span class="line">      <span class="keyword">max</span>(salary) salary</span><br><span class="line"></span><br><span class="line">    <span class="keyword">from</span></span><br><span class="line">      departments</span><br><span class="line">      <span class="keyword">join</span> dept_emp <span class="keyword">using</span> (dept_no)</span><br><span class="line">      <span class="keyword">join</span> employees <span class="keyword">using</span> (emp_no)</span><br><span class="line">      <span class="keyword">join</span> salaries <span class="keyword">using</span> (emp_no)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">where</span></span><br><span class="line">      salary &gt; <span class="number">120000</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line">      dept</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">) <span class="keyword">as</span> b</span><br><span class="line"><span class="keyword">ON</span> a.dept = b.dept <span class="keyword">AND</span> a.salary = b.salary</span><br></pre></td></tr></table></figure>
<h3 id="The-first-draft"><a href="#The-first-draft" class="headerlink" title="The first draft"></a>The first draft</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  a.dept,</span><br><span class="line">  a.name,</span><br><span class="line">  a.salary</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line"></span><br><span class="line">    <span class="keyword">select</span></span><br><span class="line">      dept_name dept,</span><br><span class="line">      emp_no my_emp_no,</span><br><span class="line">      <span class="keyword">concat</span>(first_name, <span class="string">' '</span>, last_name) <span class="keyword">name</span>,</span><br><span class="line">      <span class="keyword">max</span>(salary) salary</span><br><span class="line"></span><br><span class="line">    <span class="keyword">from</span></span><br><span class="line">      departments</span><br><span class="line">      <span class="keyword">join</span> dept_emp <span class="keyword">using</span> (dept_no)</span><br><span class="line">      <span class="keyword">join</span> employees <span class="keyword">using</span> (emp_no)</span><br><span class="line">      <span class="keyword">join</span> salaries <span class="keyword">using</span> (emp_no)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line">      my_emp_no,</span><br><span class="line">      dept</span><br><span class="line"></span><br><span class="line">) <span class="keyword">as</span> a</span><br><span class="line"></span><br><span class="line"><span class="keyword">join</span> (</span><br><span class="line"></span><br><span class="line">    <span class="keyword">select</span></span><br><span class="line">      dept_name dept,</span><br><span class="line">      <span class="keyword">max</span>(salary) salary</span><br><span class="line"></span><br><span class="line">    <span class="keyword">from</span></span><br><span class="line">      departments</span><br><span class="line">      <span class="keyword">join</span> dept_emp <span class="keyword">using</span> (dept_no)</span><br><span class="line">      <span class="keyword">join</span> employees <span class="keyword">using</span> (emp_no)</span><br><span class="line">      <span class="keyword">join</span> salaries <span class="keyword">using</span> (emp_no)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line">      dept</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">) <span class="keyword">as</span> b</span><br><span class="line"><span class="keyword">ON</span> a.dept = b.dept <span class="keyword">AND</span> a.salary = b.salary</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">+--------------------+--------------------+--------+</span><br><span class="line">| dept               | name               | salary |</span><br><span class="line">+--------------------+--------------------+--------+</span><br><span class="line">| Marketing          | Akemi Warwick      | 145128 |</span><br><span class="line">| Finance            | Lunjin Swick       | 142395 |</span><br><span class="line">| Human Resources    | Yinlin Flowers     | 141953 |</span><br><span class="line">| Production         | Youjian Cronau     | 138273 |</span><br><span class="line">| Development        | Khosrow Sgarro     | 144434 |</span><br><span class="line">| Quality Management | Shin Luck          | 132103 |</span><br><span class="line">| Sales              | Tokuyasu Pesch     | 158220 |</span><br><span class="line">| Research           | Ramachenga Soicher | 130211 |</span><br><span class="line">| Customer Service   | Vidya Hanabata     | 144866 |</span><br><span class="line">+--------------------+--------------------+--------+</span><br><span class="line">9 rows in set (15.29 sec)</span><br></pre></td></tr></table></figure>
<h2 id="Optimizing-the-query"><a href="#Optimizing-the-query" class="headerlink" title="Optimizing the query"></a>Optimizing the query</h2><p>The first thing the DBA will ask is: <strong>Did you use the <code>explain</code> command to analyze the query?</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> ....</span><br></pre></td></tr></table></figure>
<p>When we run the <code>explain</code> command with our select query we get a wide result. So I broke it apart into pieces:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">LEFT</span><br><span class="line">+----+-------------+-------------+------------+--------+</span><br><span class="line">| id | select_type | table       | partitions | type   |</span><br><span class="line">+----+-------------+-------------+------------+--------+</span><br><span class="line">|  1 | PRIMARY     | &lt;derived2&gt;  | NULL       | ALL    |</span><br><span class="line">|  1 | PRIMARY     | &lt;derived3&gt;  | NULL       | ref    |</span><br><span class="line">|  3 | DERIVED     | employees   | NULL       | index  |</span><br><span class="line">|  3 | DERIVED     | dept_emp    | NULL       | ref    |</span><br><span class="line">|  3 | DERIVED     | departments | NULL       | eq_ref |</span><br><span class="line">|  3 | DERIVED     | salaries    | NULL       | ref    |</span><br><span class="line">|  2 | DERIVED     | employees   | NULL       | ALL    |</span><br><span class="line">|  2 | DERIVED     | dept_emp    | NULL       | ref    |</span><br><span class="line">|  2 | DERIVED     | departments | NULL       | eq_ref |</span><br><span class="line">|  2 | DERIVED     | salaries    | NULL       | ref    |</span><br><span class="line">+----+-------------+-------------+------------+--------+</span><br><span class="line"></span><br><span class="line">CENTER</span><br><span class="line">+-------------------+-------------+---------+</span><br><span class="line">| possible_keys     | key         | key_len |</span><br><span class="line">+-------------------+-------------+---------+</span><br><span class="line">| NULL              | NULL        | NULL    |</span><br><span class="line">| &lt;auto_key0&gt;       | &lt;auto_key0&gt; | 127     |</span><br><span class="line">| PRIMARY           | PRIMARY     | 4       |</span><br><span class="line">| PRIMARY,dept_no   | PRIMARY     | 4       |</span><br><span class="line">| PRIMARY,dept_name | PRIMARY     | 12      |</span><br><span class="line">| PRIMARY           | PRIMARY     | 4       |</span><br><span class="line">| PRIMARY           | NULL        | NULL    |</span><br><span class="line">| PRIMARY,dept_no   | PRIMARY     | 4       |</span><br><span class="line">| PRIMARY           | PRIMARY     | 12      |</span><br><span class="line">| PRIMARY           | PRIMARY     | 4       |</span><br><span class="line">+-------------------+-------------+---------+</span><br><span class="line"></span><br><span class="line">RIGHT</span><br><span class="line">+----------------------------+---------+----------+------------------------------+</span><br><span class="line">| ref                        | rows    | filtered | Extra                        |</span><br><span class="line">+----------------------------+---------+----------+------------------------------+</span><br><span class="line">| NULL                       | 1041451 |   100.00 | Using where; Using filesort  |</span><br><span class="line">| a.dept,a.salary            |      10 |   100.00 | Using index                  |</span><br><span class="line">| NULL                       |  299157 |   100.00 | Using index; Using temporary |</span><br><span class="line">| employees.employees.emp_no |       1 |   100.00 | Using index                  |</span><br><span class="line">| employees.dept_emp.dept_no |       1 |   100.00 | NULL                         |</span><br><span class="line">| employees.employees.emp_no |       9 |    33.33 | Using where                  |</span><br><span class="line">| NULL                       |  299157 |   100.00 | Using temporary              |</span><br><span class="line">| employees.employees.emp_no |       1 |   100.00 | Using index                  |</span><br><span class="line">| employees.dept_emp.dept_no |       1 |   100.00 | NULL                         |</span><br><span class="line">| employees.employees.emp_no |       9 |    33.33 | Using where                  |</span><br><span class="line">+----------------------------+---------+----------+------------------------------+</span><br></pre></td></tr></table></figure>
<h3 id="Understanding-the-explain-report"><a href="#Understanding-the-explain-report" class="headerlink" title="Understanding the explain report"></a>Understanding the <code>explain</code> report</h3><table>
<thead>
<tr>
<th>explain_column</th>
<th>column description</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>Identifies the order of the queries when you have nested subqueries</td>
</tr>
<tr>
<td>select_type</td>
<td>The select type: primary (outermost query), derived (select from <strong>from</strong> or <strong>join</strong> clause)</td>
</tr>
<tr>
<td>table</td>
<td>The table for the output row.   <strong><code>&lt;derivedN&gt;</code></strong> (<strong>N</strong> refers to the number in the <strong>id</strong> column)</td>
</tr>
<tr>
<td>partitions</td>
<td>The matching partitions.</td>
</tr>
<tr>
<td>type</td>
<td>The join type: <strong>all</strong> (scan entire table - worst), <strong>ref</strong> (column compared to index - see key column),  <strong>eq-ref</strong> (all parts of index used by the join), <strong>index</strong>  (entire index tree is scanned to find matching row)</td>
</tr>
<tr>
<td>possibe_keys</td>
<td>The possible indexes to choose.  <strong>NULL</strong>  (indicates no relevant indexes could be found)</td>
</tr>
<tr>
<td>key</td>
<td>The index actually chosen.</td>
</tr>
<tr>
<td>key_length</td>
<td>The length of the chosen key. Used to determine data storage requirements.</td>
</tr>
<tr>
<td>ref</td>
<td>The columns compared to the index.</td>
</tr>
<tr>
<td>rows</td>
<td>Estimate of rows to be examined.</td>
</tr>
<tr>
<td>filtered</td>
<td>Percentage of rows filtered by table condition</td>
</tr>
<tr>
<td>extra</td>
<td>Contains additional information regarding the query execution plan.</td>
</tr>
</tbody>
</table>
<h3 id="The-goal"><a href="#The-goal" class="headerlink" title="The goal"></a>The goal</h3><blockquote>
<p>The <strong>simplified goal</strong> of the optimization process comes down to one simple rule:</p>
<ul>
<li>shrink the numbers in the <code>rows</code> column.</li>
</ul>
</blockquote>
<h3 id="The-second-daft"><a href="#The-second-daft" class="headerlink" title="The second daft"></a>The second daft</h3><p>Well after scouring the net I could find nothing. Except devs saying how they played with it until it got faster. I stared at it and removed any joins that I could from the derived tables. That seemed to make a big difference.</p>
<figure class="highlight sql"><figcaption><span>round 2</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">  a.dept_name,</span><br><span class="line">  a.name,</span><br><span class="line">  a.salary</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span></span><br><span class="line">      dept_no,</span><br><span class="line">      dept_name,</span><br><span class="line">      salary,</span><br><span class="line">      <span class="keyword">concat</span>(first_name, <span class="string">' '</span>, last_name) <span class="keyword">name</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">from</span></span><br><span class="line">      employees</span><br><span class="line">      <span class="keyword">join</span> dept_emp <span class="keyword">using</span> (emp_no)</span><br><span class="line">      <span class="keyword">join</span> departments <span class="keyword">using</span> (dept_no)</span><br><span class="line">      <span class="keyword">join</span> salaries <span class="keyword">using</span> (emp_no)</span><br><span class="line"></span><br><span class="line">) a</span><br><span class="line"></span><br><span class="line"><span class="keyword">join</span> (</span><br><span class="line"></span><br><span class="line">    <span class="keyword">select</span></span><br><span class="line">      dept_no,</span><br><span class="line">      <span class="keyword">max</span>(salary) salary</span><br><span class="line"></span><br><span class="line">    <span class="keyword">from</span></span><br><span class="line">      dept_emp</span><br><span class="line">      <span class="keyword">join</span> salaries <span class="keyword">using</span> (emp_no)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line">      dept_no</span><br><span class="line"></span><br><span class="line">) b</span><br><span class="line"><span class="keyword">on</span> a.dept_no = b.dept_no <span class="keyword">AND</span> a.salary = b.salary</span><br><span class="line"></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  a.dept_name</span><br></pre></td></tr></table></figure>
<h3 id="So-what’s-different"><a href="#So-what’s-different" class="headerlink" title="So what’s different"></a>So what’s different</h3><blockquote>
<p><strong>Differences:</strong></p>
<ul>
<li>I avoid the <code>group by</code> in derived table <code>a</code>.  Before I was grouping on 2 columns.</li>
<li>I lowered the number of joins in derived table <code>b</code> from 3 to 1.</li>
<li>I use the <code>dept_no</code> column in the <code>join</code> clause instead of the <code>dept_name</code> column.</li>
</ul>
</blockquote>
<h3 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">LEFT</span><br><span class="line">+----+-------------+-------------+------------+--------+</span><br><span class="line">| id | select_type | table       | partitions | type   |</span><br><span class="line">+----+-------------+-------------+------------+--------+</span><br><span class="line">|  1 | PRIMARY     | departments | NULL       | index  |</span><br><span class="line">|  1 | PRIMARY     | &lt;derived3&gt;  | NULL       | ref    |</span><br><span class="line">|  1 | PRIMARY     | dept_emp    | NULL       | ref    |</span><br><span class="line">|  1 | PRIMARY     | salaries    | NULL       | ref    |</span><br><span class="line">|  1 | PRIMARY     | employees   | NULL       | eq_ref |</span><br><span class="line">|  3 | DERIVED     | dept_emp    | NULL       | index  |</span><br><span class="line">|  3 | DERIVED     | salaries    | NULL       | ref    |</span><br><span class="line">+----+-------------+-------------+------------+--------+</span><br><span class="line"></span><br><span class="line">CENTER</span><br><span class="line">+-----------------+-------------+---------+</span><br><span class="line">| possible_keys   | key         | key_len |</span><br><span class="line">+-----------------+-------------+---------+</span><br><span class="line">| PRIMARY         | dept_name   | 122     |</span><br><span class="line">| &lt;auto_key0&gt;     | &lt;auto_key0&gt; | 12      |</span><br><span class="line">| PRIMARY,dept_no | dept_no     | 12      |</span><br><span class="line">| PRIMARY         | PRIMARY     | 4       |</span><br><span class="line">| PRIMARY         | PRIMARY     | 4       |</span><br><span class="line">| PRIMARY,dept_no | dept_no     | 12      |</span><br><span class="line">| PRIMARY         | PRIMARY     | 4       |</span><br><span class="line">+-----------------+-------------+---------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">RIGHT</span><br><span class="line">+-------------------------------+--------+----------+-------------+</span><br><span class="line">| ref                           | rows   | filtered | Extra       |</span><br><span class="line">+-------------------------------+--------+----------+-------------+</span><br><span class="line">| NULL                          |      9 |   100.00 | Using index |</span><br><span class="line">| employees.departments.dept_no |  31305 |   100.00 | Using index |</span><br><span class="line">| employees.departments.dept_no |  41392 |   100.00 | Using index |</span><br><span class="line">| employees.dept_emp.emp_no     |      9 |    10.00 | Using where |</span><br><span class="line">| employees.dept_emp.emp_no     |      1 |   100.00 | NULL        |</span><br><span class="line">| NULL                          | 331143 |   100.00 | Using index |</span><br><span class="line">| employees.dept_emp.emp_no     |      9 |   100.00 | NULL        |</span><br><span class="line">+-------------------------------+--------+----------+-------------+</span><br></pre></td></tr></table></figure>
<h3 id="Result"><a href="#Result" class="headerlink" title="Result"></a>Result</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">+--------------------+--------------------+--------+</span><br><span class="line">| dept_name          | name               | salary |</span><br><span class="line">+--------------------+--------------------+--------+</span><br><span class="line">| Customer Service   | Vidya Hanabata     | 144866 |</span><br><span class="line">| Development        | Khosrow Sgarro     | 144434 |</span><br><span class="line">| Finance            | Lunjin Swick       | 142395 |</span><br><span class="line">| Human Resources    | Yinlin Flowers     | 141953 |</span><br><span class="line">| Marketing          | Akemi Warwick      | 145128 |</span><br><span class="line">| Production         | Youjian Cronau     | 138273 |</span><br><span class="line">| Quality Management | Shin Luck          | 132103 |</span><br><span class="line">| Research           | Ramachenga Soicher | 130211 |</span><br><span class="line">| Sales              | Tokuyasu Pesch     | 158220 |</span><br><span class="line">+--------------------+--------------------+--------+</span><br><span class="line">9 rows in set (3.62 sec)</span><br></pre></td></tr></table></figure>
<h3 id="How-much-of-a-difference"><a href="#How-much-of-a-difference" class="headerlink" title="How much of a difference"></a>How much of a difference</h3><blockquote>
<p><strong>We dropped sum of the row column 75% and that resulted in the query time dropping 75%.</strong></p>
<ul>
<li>the first draft query took 15.29 seconds.</li>
<li>the sum or the <code>rows</code> column in the <code>explain</code> report: 1,639,788</li>
<li>the second draft is down to 3.62 seconds.</li>
<li>the sum or the <code>rows</code> column in the <code>explain</code> report: 403,868</li>
</ul>
</blockquote>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><blockquote>
<p>Update:<br>I did find a mysql guru named Maximus on slack who reviewed my work and gave it his blessings.</p>
</blockquote>
<p>Well I never found a SQL guru to offer advice but that’s often how it goes. In the end I had to take a hard look at the query and remove what was not necessary.  The <code>query time</code> and the <code>explain</code> report confirmed if it was the right move.</p>
<p>Of course scouring the internet for clues is part of the program.</p>
<ul>
<li>stack overflow</li>
<li>google</li>
<li>youtube</li>
</ul>
<p>That’s all for today.</p>
<p><strong>Cheers!!</strong></p>

                
            </div>
        </article>
    
        <article class="post-abstract">
            <div class="post-title">
                <h2><a class="post-title-link" href="/2018/11/19/20181210-graphql-deep-dive/">graphQL deep dive</a></h2>
            </div>
            <div class="post-meta">
                <span class="post-time">2018-11-19</span>
                
            </div>
            <div class="post-content">
                
                    <h2 id="Introduction-to-GraphQL"><a href="#Introduction-to-GraphQL" class="headerlink" title="Introduction to GraphQL"></a>Introduction to GraphQL</h2><p><strong>Why GraphQL</strong></p>
<ul>
<li>allows for more flexible and efficient approach than rest</li>
<li>all rest endpoints reduced to one</li>
<li>many requests reduced to one request</li>
<li>get exactly the data you want</li>
<li>walking the graph of relationships via one supercharged enpoint</li>
</ul>
<p><strong>GraphQL is technology agnostic!</strong></p>
<ul>
<li>Angular or Vue</li>
<li>SQL or NoSQL</li>
<li>Express or Koa</li>
</ul>
<h2 id="The-Project"><a href="#The-Project" class="headerlink" title="The Project"></a>The Project</h2><p><strong>Requirements</strong></p>
<ul>
<li>node</li>
<li>visual-studio-code</li>
<li>project: <a href="https://github.com/.." target="_blank" rel="noopener">https://github.com/..</a>.</li>
</ul>
<p><strong>Project Stack</strong></p>
<ul>
<li>Server (node)<ul>
<li>express app</li>
<li>graphQL server</li>
</ul>
</li>
<li>Database<ul>
<li>MongoDB</li>
<li>mlab</li>
</ul>
</li>
<li>Client<ul>
<li>React App</li>
<li>Apollo</li>
</ul>
</li>
<li>Graphiql<ul>
<li>graphql tool</li>
</ul>
</li>
</ul>
<h2 id="Making-Queries"><a href="#Making-Queries" class="headerlink" title="Making Queries"></a>Making Queries</h2><p><strong>Using Graphiql</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    events&#123;</span><br><span class="line">        title</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Using JS</strong></p>
<figure class="highlight js"><figcaption><span>javascript query</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getBooks = gql<span class="string">`</span></span><br><span class="line"><span class="string">  &#123;</span></span><br><span class="line"><span class="string">    events &#123;</span></span><br><span class="line"><span class="string">      title</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>
<h2 id="Config-Setup"><a href="#Config-Setup" class="headerlink" title="Config Setup"></a>Config Setup</h2><ul>
<li><code>npm install dotenv</code></li>
</ul>
<figure class="highlight js"><figcaption><span>.env -- do not save this file in git --</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># mongoose database connection strings</span><br><span class="line">DEV_DB=<span class="string">"mongodb://name:password@ds019078.mlab.com:19078/event-booking"</span></span><br><span class="line">PROD_DB=<span class="string">"mongodb://name:password@ds019078.mlab.com:19078/event-booking"</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><figcaption><span>config.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">"dotenv"</span>).config();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dbUrl = process.env.NODE_ENV === <span class="string">"production"</span> ? process.env.PROD_DB : process.env.DEV_DB;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  port: process.env.PORT || <span class="number">4444</span>,</span><br><span class="line">  mongoConnectionParams: [dbUrl, &#123; <span class="attr">useNewUrlParser</span>: <span class="literal">true</span> &#125;]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="Express-Setup"><a href="#Express-Setup" class="headerlink" title="Express Setup"></a>Express Setup</h2><ul>
<li><code>npm install express body-parser graphql express-graphql mongoose</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">"./config"</span>);</span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">"express"</span>);</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">"body-parser"</span>);</span><br><span class="line"><span class="keyword">const</span> graphqlHTTP = <span class="built_in">require</span>(<span class="string">"express-graphql"</span>);</span><br><span class="line"><span class="keyword">const</span> schema = <span class="built_in">require</span>(<span class="string">"./graphql"</span>);</span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">"mongoose"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line">app.use(bodyParser.json());</span><br><span class="line"></span><br><span class="line">app.use(<span class="string">"/graphql"</span>, graphqlHTTP(schema));</span><br><span class="line"></span><br><span class="line">mongoose</span><br><span class="line">  .connect(...config.mongoConnectionParams)</span><br><span class="line">  .then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    app.listen(config.port, () =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`GraphQL Server listening on port <span class="subst">$&#123;config.port&#125;</span>`</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Create-a-Database"><a href="#Create-a-Database" class="headerlink" title="Create a Database"></a>Create a Database</h2><p><strong>Connecting to mLab</strong></p>
<p>setup mlab nosql database</p>
<ul>
<li><a href="mlab.com">mlab</a><ul>
<li>name: gql-event-bookung</li>
<li>user: username / test123</li>
<li>connection string:<ul>
<li><code>mongodb://&lt;dbuser&gt;:&lt;dbpassword&gt;@ds041327.mlab.com:41327/gql-ninja</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="Mongoose-Models"><a href="#Mongoose-Models" class="headerlink" title="Mongoose Models"></a>Mongoose Models</h2><figure class="highlight js"><figcaption><span>./models/event.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">"mongoose"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Schema = mongoose.Schema;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> eventSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">  title: &#123;</span><br><span class="line">    type: <span class="built_in">String</span>,</span><br><span class="line">    required: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  description: &#123;</span><br><span class="line">    type: <span class="built_in">String</span>,</span><br><span class="line">    required: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  price: &#123;</span><br><span class="line">    type: <span class="built_in">Number</span>,</span><br><span class="line">    required: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  date: &#123;</span><br><span class="line">    type: <span class="built_in">Date</span>,</span><br><span class="line">    required: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  creator: &#123;</span><br><span class="line">    type: Schema.Types.ObjectId,</span><br><span class="line">    ref: <span class="string">"User"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = mongoose.model(<span class="string">"Event"</span>, eventSchema);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><figcaption><span>./models/user.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">"mongoose"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Schema = mongoose.Schema;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> userSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">  email: &#123;</span><br><span class="line">    type: <span class="built_in">String</span>,</span><br><span class="line">    required: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  password: &#123;</span><br><span class="line">    type: <span class="built_in">String</span>,</span><br><span class="line">    required: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  createdEvents: [</span><br><span class="line">    &#123;</span><br><span class="line">      type: Schema.Types.ObjectId,</span><br><span class="line">      ref: <span class="string">"Event"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = mongoose.model(<span class="string">"User"</span>, userSchema);</span><br></pre></td></tr></table></figure>
<h2 id="Graphql-Schema"><a href="#Graphql-Schema" class="headerlink" title="Graphql Schema"></a>Graphql Schema</h2><figure class="highlight js"><figcaption><span>./graphql/index.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; buildSchema &#125; = <span class="built_in">require</span>(<span class="string">"graphql"</span>);</span><br><span class="line"><span class="keyword">const</span> schema = <span class="built_in">require</span>(<span class="string">"./schema.gql"</span>);</span><br><span class="line"><span class="keyword">const</span> reducers = <span class="built_in">require</span>(<span class="string">"./reducers"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// SCHEMA</span></span><br><span class="line">  schema: buildSchema(schema),</span><br><span class="line"></span><br><span class="line">  <span class="comment">// REDUCERS</span></span><br><span class="line">  rootValue: reducers,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// GRAPHIQL</span></span><br><span class="line">  graphiql: <span class="literal">true</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><figcaption><span>./graphql/schema.gql</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="string">`</span></span><br><span class="line"><span class="string">  type Event &#123;</span></span><br><span class="line"><span class="string">    _id: ID!</span></span><br><span class="line"><span class="string">    title: String!</span></span><br><span class="line"><span class="string">    description: String!</span></span><br><span class="line"><span class="string">    price: Float!</span></span><br><span class="line"><span class="string">    date: String!</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  input EventInput &#123;</span></span><br><span class="line"><span class="string">    title: String!</span></span><br><span class="line"><span class="string">    description: String!</span></span><br><span class="line"><span class="string">    price: Float!</span></span><br><span class="line"><span class="string">    date: String!</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  type User  &#123;</span></span><br><span class="line"><span class="string">    _id: ID!</span></span><br><span class="line"><span class="string">    email: String!</span></span><br><span class="line"><span class="string">    password: String</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  input UserInput &#123;</span></span><br><span class="line"><span class="string">    email: String!</span></span><br><span class="line"><span class="string">    password: String!</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  type RootQuery &#123;</span></span><br><span class="line"><span class="string">    events: [Event!]!</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  type RootMutation &#123;</span></span><br><span class="line"><span class="string">    createEvent(eventInput: EventInput): Event</span></span><br><span class="line"><span class="string">    createUser(userInput: UserInput): User</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  schema &#123;</span></span><br><span class="line"><span class="string">    query: RootQuery</span></span><br><span class="line"><span class="string">    mutation: RootMutation</span></span><br><span class="line"><span class="string">  &#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="Graphql-Reducers"><a href="#Graphql-Reducers" class="headerlink" title="Graphql Reducers"></a>Graphql Reducers</h2><ul>
<li><code>npm install bcryptjs</code></li>
</ul>
<figure class="highlight js"><figcaption><span>./graphql/reducers.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Event = <span class="built_in">require</span>(<span class="string">"../models/event"</span>);</span><br><span class="line"><span class="keyword">const</span> User = <span class="built_in">require</span>(<span class="string">"../models/user"</span>);</span><br><span class="line"><span class="keyword">const</span> bcrypt = <span class="built_in">require</span>(<span class="string">"bcryptjs"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// for dealing with ID fields</span></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">"mongoose"</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; ObjectId &#125; = mongoose.Types;</span><br><span class="line">ObjectId.prototype.valueOf = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.toString();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  events: <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> Event.find().then(<span class="function"><span class="params">events</span> =&gt;</span> events.map(<span class="function"><span class="params">event</span> =&gt;</span> (&#123; ...event.toJSON() &#125;)));</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  createEvent: <span class="keyword">async</span> args =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; title, description, price, date &#125; = args.eventInput;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> event = <span class="keyword">await</span> <span class="keyword">new</span> Event(&#123;</span><br><span class="line">      title,</span><br><span class="line">      description,</span><br><span class="line">      price: +price,</span><br><span class="line">      date: <span class="keyword">new</span> <span class="built_in">Date</span>(date),</span><br><span class="line">      creator: <span class="string">"5c18e30aa134ef8e0244271e"</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> user = <span class="keyword">await</span> User.findById(<span class="string">"5c18e30aa134ef8e0244271e"</span>);</span><br><span class="line">    <span class="keyword">if</span> (!user) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"User not found."</span>);</span><br><span class="line"></span><br><span class="line">    user.createdEvents.push(event._id);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Promise</span>.all(event.save(), user.save());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123; ...event.toJSON() &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  createUser: <span class="keyword">async</span> args =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; email, password &#125; = args.userInput;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> User.findOne(&#123; email &#125;).then(<span class="function"><span class="params">user</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (user) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"User exists already."</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> hashedPassword = <span class="keyword">await</span> bcrypt.hash(password, <span class="number">12</span>);</span><br><span class="line">    <span class="keyword">const</span> user = <span class="keyword">new</span> User(&#123;</span><br><span class="line">      email,</span><br><span class="line">      password: hashedPassword</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> user.save();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123; ...user.toJSON(), <span class="attr">password</span>: <span class="literal">null</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a href="https://goo.gl/3mNaKF" target="_blank" rel="noopener">Build a Project with GraphQL, Node, MongoDB</a></li>
<li><a href="https://goo.gl/wQPPNL" target="_blank" rel="noopener">GraphQL Full Course - Novice to Expert</a></li>
</ul>

                
            </div>
        </article>
    
        <article class="post-abstract">
            <div class="post-title">
                <h2><a class="post-title-link" href="/2018/11/19/20181119-intro-to-graphql/">intro to graphQL</a></h2>
            </div>
            <div class="post-meta">
                <span class="post-time">2018-11-19</span>
                
            </div>
            <div class="post-content">
                
                    <h2 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h2><p>The plan was to use <a href="https://goo.gl/kKqcy8" target="_blank" rel="noopener">styled-jsx</a> but it was not to be. It is not yet compatible with React 2.x. But <a href="https://goo.gl/pqGvoO" target="_blank" rel="noopener">styled-components</a> is so we’ll use that.</p>
<p>Our goal is to use cra to accomplish:</p>
<ul>
<li>Use create-react-app to build a SPA</li>
<li>Use GraphQL to query github’s API</li>
<li>Use Launchpad to prototype a GraphQL server</li>
<li>Use Express to create a local GraphQL server</li>
</ul>
<h2 id="Create-a-SPA"><a href="#Create-a-SPA" class="headerlink" title="Create a SPA"></a>Create a SPA</h2><p>This SPA will consist of <code>create-react-app</code> and <code>styled-components</code></p>
<ul>
<li>create a react app with style-components support<ul>
<li><code>npx create-react-app graphql-part1</code></li>
<li><code>cd graphql-part1</code></li>
<li><code>yarn add styled-components</code></li>
</ul>
</li>
</ul>
<figure class="highlight js"><figcaption><span>App.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> styled <span class="keyword">from</span> <span class="string">"styled-components"</span>;</span><br><span class="line"><span class="keyword">import</span> AppHeader <span class="keyword">from</span> <span class="string">"./AppHeader"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> AppWrapper = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">  text-align: center;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">  &lt;AppWrapper&gt;</span><br><span class="line">    &lt;AppHeader /&gt;</span><br><span class="line">  &lt;<span class="regexp">/AppWrapper&gt;</span></span><br><span class="line"><span class="regexp">);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default App;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><figcaption><span>AppHeader.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> logo <span class="keyword">from</span> <span class="string">"./logo.svg"</span>;</span><br><span class="line"><span class="keyword">import</span> styled, &#123; keyframes &#125; <span class="keyword">from</span> <span class="string">"styled-components"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rotate360 = keyframes<span class="string">`</span></span><br><span class="line"><span class="string">  from &#123;</span></span><br><span class="line"><span class="string">    transform: rotate(0deg);</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  to &#123;</span></span><br><span class="line"><span class="string">    transform: rotate(360deg);</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> AppLogo = styled.img<span class="string">`</span></span><br><span class="line"><span class="string">  animation: <span class="subst">$&#123;rotate360&#125;</span> infinite 120s linear;</span></span><br><span class="line"><span class="string">  height: 80px;</span></span><br><span class="line"><span class="string">  &amp;:hover &#123;</span></span><br><span class="line"><span class="string">    animation: <span class="subst">$&#123;rotate360&#125;</span> infinite 1.5s linear;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> AppHeader = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">  background-color: #222;</span></span><br><span class="line"><span class="string">  height: 150px;</span></span><br><span class="line"><span class="string">  padding: 20px;</span></span><br><span class="line"><span class="string">  color: white;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> AppTitle = styled.h1<span class="string">`</span></span><br><span class="line"><span class="string">  font-size: 1.3em;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">  &lt;AppHeader&gt;</span><br><span class="line">    &lt;AppLogo src=&#123;logo&#125; alt=<span class="string">"logo"</span> /&gt;</span><br><span class="line">    &lt;AppTitle&gt;Welcome to React&lt;<span class="regexp">/AppTitle&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>AppHeader&gt;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>
<ul>
<li>start the server<ul>
<li><code>npm run start</code></li>
</ul>
</li>
</ul>
<p>We good!!</p>
<h2 id="Query-Github’s-GraphQL-API"><a href="#Query-Github’s-GraphQL-API" class="headerlink" title="Query Github’s GraphQL API"></a>Query Github’s GraphQL API</h2><ul>
<li>get a Github access token -&gt; click <a href="https://goo.gl/ANZ9oz" target="_blank" rel="noopener">here</a><ul>
<li>follow the instructions to get a token</li>
</ul>
</li>
<li>install these packages required for graphQL:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">npm install --save \</span><br><span class="line">apollo-boost \</span><br><span class="line">react-apollo \</span><br><span class="line">graphql \</span><br><span class="line">apollo-cache-inmemory \</span><br><span class="line">graphql-tag \</span><br><span class="line">apollo-link-context</span><br></pre></td></tr></table></figure>
<ul>
<li>Setup these files:</li>
</ul>
<figure class="highlight bash"><figcaption><span>.env</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">REACT_APP_GITHUB_ACCESS_TOKEN=<span class="string">"***YOUR_TOKEN***"</span></span><br><span class="line">REACT_APP_GITHUB_GRAPHQL_URL=<span class="string">"***YOUR_GRAPHQL_URL***"</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><figcaption><span>src/config.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  githubAccessToken: process.env.REACT_APP_GITHUB_ACCESS_TOKEN,</span><br><span class="line">  githubGraphqlUrl: process.env.REACT_APP_GITHUB_GRAPHQL_URL</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><figcaption><span>src/index.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ApolloClient &#125; <span class="keyword">from</span> <span class="string">"apollo-client"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; HttpLink &#125; <span class="keyword">from</span> <span class="string">"apollo-link-http"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; InMemoryCache &#125; <span class="keyword">from</span> <span class="string">"apollo-cache-inmemory"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ApolloProvider &#125; <span class="keyword">from</span> <span class="string">"react-apollo"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; setContext &#125; <span class="keyword">from</span> <span class="string">"apollo-link-context"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> config <span class="keyword">from</span> <span class="string">"./config"</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">"./App"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> authLink = setContext(<span class="function">(<span class="params">_, &#123; headers &#125;</span>) =&gt;</span> (&#123;</span><br><span class="line">  headers: &#123;</span><br><span class="line">    ...headers,</span><br><span class="line">    authorization: <span class="string">`Bearer <span class="subst">$&#123;config.githubAccessToken&#125;</span>`</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> client = <span class="keyword">new</span> ApolloClient(&#123;</span><br><span class="line">  link: authLink.concat(<span class="keyword">new</span> HttpLink(&#123; <span class="attr">uri</span>: config.githubGraphqlUrl &#125;)),</span><br><span class="line">  cache: <span class="keyword">new</span> InMemoryCache()</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;ApolloProvider client=&#123;client&#125;&gt;</span><br><span class="line">    &lt;App /&gt;</span><br><span class="line">  &lt;<span class="regexp">/ApolloProvider&gt;,</span></span><br><span class="line"><span class="regexp">  document.getElementById("root")</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><figcaption><span>App.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> styled <span class="keyword">from</span> <span class="string">"styled-components"</span>;</span><br><span class="line"><span class="keyword">import</span> AppHeader <span class="keyword">from</span> <span class="string">"./AppHeader"</span>;</span><br><span class="line"><span class="keyword">import</span> TopRepos <span class="keyword">from</span> <span class="string">"./TopRepos"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> AppWrapper = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">  text-align: center;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">  &lt;AppWrapper&gt;</span><br><span class="line">    &lt;AppHeader /&gt;</span><br><span class="line">    &lt;TopRepos /&gt;</span><br><span class="line">  &lt;<span class="regexp">/AppWrapper&gt;</span></span><br><span class="line"><span class="regexp">);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default App;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><figcaption><span>TopRepos</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; graphql &#125; <span class="keyword">from</span> <span class="string">"react-apollo"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; gql &#125; <span class="keyword">from</span> <span class="string">"apollo-boost"</span>;</span><br><span class="line"><span class="keyword">import</span> styled <span class="keyword">from</span> <span class="string">"styled-components"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> TOP_REPOS = gql<span class="string">`</span></span><br><span class="line"><span class="string">  &#123;</span></span><br><span class="line"><span class="string">    search(query: "stars:&gt;50000", type: REPOSITORY, first: 10) &#123;</span></span><br><span class="line"><span class="string">      repositoryCount</span></span><br><span class="line"><span class="string">      edges &#123;</span></span><br><span class="line"><span class="string">        node &#123;</span></span><br><span class="line"><span class="string">          ... on Repository &#123;</span></span><br><span class="line"><span class="string">            name</span></span><br><span class="line"><span class="string">            owner &#123;</span></span><br><span class="line"><span class="string">              login</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            stargazers &#123;</span></span><br><span class="line"><span class="string">              totalCount</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> RepoTable = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">  margin: 50px 20px;</span></span><br><span class="line"><span class="string">  display: flex;</span></span><br><span class="line"><span class="string">  flex-direction: column;</span></span><br><span class="line"><span class="string">  border: 1px solid #efefef;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> RepoRow = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">  display: flex;</span></span><br><span class="line"><span class="string">  border-bottom: 1px solid #efefef;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  &amp;:nth-last-child(1) &#123;</span></span><br><span class="line"><span class="string">    border-bottom: none;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> RepoHead = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">  flex: 6;</span></span><br><span class="line"><span class="string">  padding: 10px 20px;</span></span><br><span class="line"><span class="string">  font-weight: 600;</span></span><br><span class="line"><span class="string">  text-align: left;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  &amp;:nth-last-child(1) &#123;</span></span><br><span class="line"><span class="string">    flex: 4;</span></span><br><span class="line"><span class="string">    text-align: right;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> RepoCell = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">  flex: 6;</span></span><br><span class="line"><span class="string">  padding: 10px 20px;</span></span><br><span class="line"><span class="string">  text-align: left;</span></span><br><span class="line"><span class="string">  white-space: nowrap;</span></span><br><span class="line"><span class="string">  overflow: hidden;</span></span><br><span class="line"><span class="string">  text-overflow: ellipsis;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  &amp;:nth-child(2) &#123;</span></span><br><span class="line"><span class="string">    font-weight: 600;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  &amp;:nth-last-child(1) &#123;</span></span><br><span class="line"><span class="string">    flex: 4;</span></span><br><span class="line"><span class="string">    text-align: right;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Loading = <span class="function"><span class="params">()</span> =&gt;</span> &lt;RepoTable&gt;Loading...&lt;<span class="regexp">/RepoTable&gt;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const Table = props =&gt; (</span></span><br><span class="line"><span class="regexp">  &lt;RepoTable&gt;</span></span><br><span class="line"><span class="regexp">    &lt;RepoRow&gt;</span></span><br><span class="line"><span class="regexp">      &lt;RepoHead&gt;Organization&lt;/</span>RepoHead&gt;</span><br><span class="line">      &lt;RepoHead&gt;Repo&lt;<span class="regexp">/RepoHead&gt;</span></span><br><span class="line"><span class="regexp">      &lt;RepoHead&gt;Stars&lt;/</span>RepoHead&gt;</span><br><span class="line">    &lt;<span class="regexp">/RepoRow&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    &#123;props.data.search.edges.map((row, i) =&gt; (</span></span><br><span class="line"><span class="regexp">      &lt;RepoRow key=&#123;i&#125;&gt;</span></span><br><span class="line"><span class="regexp">        &lt;RepoCell&gt;&#123;row.node.owner.login&#125;&lt;/</span>RepoCell&gt;</span><br><span class="line">        &lt;RepoCell&gt;&#123;row.node.name&#125;&lt;<span class="regexp">/RepoCell&gt;</span></span><br><span class="line"><span class="regexp">        &lt;RepoCell&gt;&#123;row.node.stargazers.totalCount&#125;&lt;/</span>RepoCell&gt;</span><br><span class="line">      &lt;<span class="regexp">/RepoRow&gt;</span></span><br><span class="line"><span class="regexp">    ))&#125;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>RepoTable&gt;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> TopRepos = graphql(TOP_REPOS)(<span class="function"><span class="params">props</span> =&gt;</span></span><br><span class="line">  props.data.loading ? &lt;Loading /&gt; : &lt;Table &#123;...props&#125; /&gt;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">export default TopRepos;</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/YTxgh1U.png" alt="create-react-app with graphql"></p>
<h2 id="Launchpad"><a href="#Launchpad" class="headerlink" title="Launchpad"></a>Launchpad</h2><ul>
<li><a href="https://launchpad.graphql.com/" target="_blank" rel="noopener">Launchpad</a> is like codepen for graphql.<ul>
<li>It allows you to design and try a graphql server.</li>
</ul>
</li>
<li>Every project is called a <code>pad</code> and provides a url:<ul>
<li><code>https://1jzxrj129.lp.gql.zone/graphql</code></li>
</ul>
</li>
<li>Launchpad give you the option to download your pad as a graphql server.<ul>
<li>It’s a node/express server consisting of two files:<ul>
<li>schema.js</li>
<li>server.js</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>What we learned:</p>
<ul>
<li><code>styled-jsx</code> is not compatible with React 2.x</li>
<li><code>styled-components</code> works with React 2.x<ul>
<li><code>styled-components</code> has a huge benefit that it allows you to create new tag names.</li>
<li><code>styled-components</code> has nested classes similar to sass.</li>
</ul>
</li>
<li><code>github</code> has a graphql API</li>
<li><code>graphql</code> has a lot of moving parts but it’s easy to setup</li>
<li><code>create-react-app</code> has <code>dotenv</code> built in. you must prefix your env vars with <code>REACT_APP</code></li>
<li><code>visual-studio-code</code> has extensions for graphql.</li>
<li><code>launchpad</code> allows you to quickly prototype graphql servers.</li>
</ul>

                
            </div>
        </article>
    
</div>
<div class="paginator">
    
        
        
        <a class="next" href="/page/2/">
            Next
            <i class="iconfont icon-next"></i>
        </a>
        
    
</div>

    </div>
</div>
<footer class="footer-social">
    
    <a class="social-link" target="_blank" href="https://github.com/dearfrankg">
        <i class="iconfont icon-github"></i>
    </a>
    

    

    

    <div class="footer-copyright">
        <p class="time-line">
            &copy;
            
            
            2018
            &nbsp;<i class="iconfont icon-heart"></i>&nbsp;
            <a target="_blank" href="https://github.com/dearfrankg">Frank Gutierrez</a>
        </p>
    </div>
</footer>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="/js/index.js"></script>
<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> -->
<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
<script>
    

</script>
</html>
