<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    <title>dev notes</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/gitment.css">
    <link rel="stylesheet" href="/css/font_859455_eaq7v6w8ktj.css">
</head>

<body>
<header class="header">
    <div class="header-inner">
        <div class="header-title">

        </div>
        <nav class="header-nav">
            
            <a href="/" class="header-nav-link">
                Home
            </a>
            

            
            <a href="/archives" class="header-nav-link">
                Archives
            </a>
            

            
            <a href="/tags" class="header-nav-link">
                Tags
            </a>
            

            
        </nav>
    </div>
</header>
<header class="mobile-header">
    <div class="mobile-nav">
        <div class="mobile-nav-icon">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <div class="mobile-nav-title">
            <a href="/" class="mobile-nav-title-link">Frank Gutierrez's Blog</a>
        </div>

    </div>
    <nav class="mobile-menu">
        <ul class="mobile-menu-list">
            <li class="mobile-menu-item">
                <i class="iconfont icon-home"></i>
                <a href="/" class="mobile-nav-link">Home</a>
            </li>
            <li class="mobile-menu-item">
                <i class="iconfont icon-archive"></i>
                <a href="/archives" class="mobile-nav-link">Archives</a>
            </li>
            <li class="mobile-menu-item">
                <i class="iconfont icon-tag"></i>
                <a href="/tags" class="mobile-nav-link">Tags</a>
            </li>
            <li class="mobile-menu-item">
                <i class="iconfont icon-about"></i>
                <a href="/about/" class="mobile-nav-link">About</a>
            </li>
        </ul>
    </nav>
</header>
<div class="main">
    <div class="content-inner">
        <div class="posts">
    
        <article class="post-abstract">
            <div class="post-title">
                <h2><a class="post-title-link" href="/2017/03/28/20170331-lionshare/">lionshare</a></h2>
            </div>
            <div class="post-meta">
                <span class="post-time">2017-03-28</span>
                
            </div>
            <div class="post-content">
                
                    <h1 id="lionshare-api"><a href="#lionshare-api" class="headerlink" title="lionshare-api"></a>lionshare-api</h1><h2 id="API-Summary"><a href="#API-Summary" class="headerlink" title="API Summary"></a>API Summary</h2><p>API that powers <a href="https://lionshare.capital" target="_blank" rel="noopener">Lionshare</a> by providing both historical (REST) and realtime time (websocket) cryptocurrency market data. The data is sourced from <a href="https://gdax.com" target="_blank" rel="noopener">GDAX</a>, <a href="https://poloniex.com/" target="_blank" rel="noopener">Poloniex</a>, and <a href="https://coinmarketcap.com/" target="_blank" rel="noopener">Coinmarketcap</a>.</p>
<h2 id="Environment"><a href="#Environment" class="headerlink" title="Environment"></a>Environment</h2><p>Let‚Äôs get a feel for what we‚Äôre working with:</p>
<p>Summary of packages:</p>
<ul>
<li>babel - transforming</li>
<li>koa ‚Äì server and middleware</li>
<li>websockets ‚Äì web socket collection</li>
<li>autobahn ‚Äì web application messaging protocol</li>
<li>redis ‚Äì redis client</li>
<li>utilities ‚Äì bluebird-promises, cross-env, dotenv, http-error, iso-fetch</li>
<li>utilities ‚Äì ms, now-logs, pm2, safestart, semver</li>
</ul>
<p>Directory Structure</p>
<pre><code>src
‚îú‚îÄ‚îÄ api           // api server
‚îú‚îÄ‚îÄ db            // redis
‚îú‚îÄ‚îÄ exchange      // exchange server
‚îú‚îÄ‚îÄ utils
‚îú‚îÄ‚îÄ ws            // web socket server
‚îú‚îÄ‚îÄ check.js
‚îú‚îÄ‚îÄ index.js
‚îî‚îÄ‚îÄ init.js
</code></pre><h2 id="API-Data"><a href="#API-Data" class="headerlink" title="API Data"></a>API Data</h2><h3 id="Prices"><a href="#Prices" class="headerlink" title="Prices"></a>Prices</h3><figure class="highlight json"><figcaption><span>'GET api.lionshare.capital/api/prices?period</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"data"</span>: &#123;</span><br><span class="line">    <span class="attr">"BTC"</span>: [<span class="number">924.2</span>, <span class="number">924.63</span>, <span class="number">923.82</span>, <span class="number">923.02</span>, <span class="number">924.82</span>, ...],</span><br><span class="line">    <span class="attr">"ETH"</span>: [<span class="number">10.74</span>, <span class="number">10.8</span>, <span class="number">10.79</span>, <span class="number">10.82</span>, <span class="number">10.82</span>, <span class="number">10.84</span>, <span class="number">10.78</span>, ...],</span><br><span class="line">    <span class="attr">"LTC"</span>: [<span class="number">3.88</span>, <span class="number">3.86</span>, <span class="number">3.85</span>, <span class="number">3.85</span>, <span class="number">3.86</span>, <span class="number">3.86</span>, <span class="number">3.84</span>, ...]</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Markets"><a href="#Markets" class="headerlink" title="Markets"></a>Markets</h3><figure class="highlight"><figcaption><span>'GET api.lionshare.capital/api/markets'</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"data"</span>: &#123;</span><br><span class="line">    <span class="attr">"BTC"</span>: <span class="number">14718750986</span>,</span><br><span class="line">    <span class="attr">"ETH"</span>: <span class="number">943628626</span>,</span><br><span class="line">    <span class="attr">"LTC"</span>: <span class="number">188560718</span>,</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Updates"><a href="#Updates" class="headerlink" title="Updates"></a>Updates</h3><figure class="highlight"><figcaption><span>'GET api/updates?v</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  url: "https://github.com/lionsharecapital/lionshare-desktop/releases/download/v1.1.0/Lionshare-1.1.0-mac.zip",</span><br><span class="line">  name: "Lionshare 1.1.0",</span><br><span class="line">  notes: "- üíµ New currencies: IOC, SC, SJCX and DCR - ‚å® Keyboard shortcuts for prices and portfolio (Cmd+1/2) - ÔºÑ Fixed formatting for non-US dollar currencies - üê≥ Fixed number formatting for whale users - üõ† Various bug fixes and improvements ",</span><br><span class="line">  pub_date: "2017-02-06T01:51:06Z"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

                
            </div>
        </article>
    
        <article class="post-abstract">
            <div class="post-title">
                <h2><a class="post-title-link" href="/2017/03/28/20170328-facebook-react-perf/">facebook on react performance</a></h2>
            </div>
            <div class="post-meta">
                <span class="post-time">2017-03-28</span>
                
            </div>
            <div class="post-content">
                
                    <h1 id="Facebook-React-Perfomance"><a href="#Facebook-React-Perfomance" class="headerlink" title="Facebook React Perfomance"></a>Facebook React Perfomance</h1><p>Internally, React uses several clever techniques to minimize the number of costly DOM operations required to update the UI. For many applications, using React will lead to a fast user interface without doing much work to specifically optimize for performance. Nevertheless, there are several ways you can speed up your React application.</p>
<p><strong>Use a production build</strong></p>
<p>This will perform much better</p>
<p><strong>Profiling Components with Chrome Timeline</strong></p>
<p>You can see how it performs</p>
<p><strong>Avoid Reconciliation</strong></p>
<p>React decides whether an actual DOM update is necessary by comparing the newly returned element with the previously rendered one. When they are not equal, React will update the DOM.</p>
<p><strong><code>shouldComponentUpdate</code> can be used to avoid updating te DOM</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CounterButton</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;<span class="attr">count</span>: <span class="number">1</span>&#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  shouldComponentUpdate(nextProps, nextState) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.props.color !== nextProps.color) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.state.count !== nextState.count) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;button</span><br><span class="line">        color=&#123;<span class="keyword">this</span>.props.color&#125;</span><br><span class="line">        onClick=&#123;() =&gt; <span class="keyword">this</span>.setState(<span class="function"><span class="params">state</span> =&gt;</span> (&#123;<span class="attr">count</span>: state.count + <span class="number">1</span>&#125;))&#125;&gt;</span><br><span class="line">        Count: &#123;<span class="keyword">this</span>.state.count&#125;</span><br><span class="line">      &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<p><strong><code>React.PureComponent</code> does a shallow-compare</strong></p>
<p>This does the same thing as the previous code.</p>
<p>Most of the time, you can use React.PureComponent instead of writing your own shouldComponentUpdate.  <strong>It only does a shallow comparison</strong></p>
<blockquote>
<p>you can‚Äôt use it if the props or state may have been mutated in a way that a shallow comparison would miss.</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GOOD: will only render when count or color changes</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CounterButton</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">PureComponent</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;<span class="attr">count</span>: <span class="number">1</span>&#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;button</span><br><span class="line">        color=&#123;<span class="keyword">this</span>.props.color&#125;</span><br><span class="line">        onClick=&#123;() =&gt; <span class="keyword">this</span>.setState(<span class="function"><span class="params">state</span> =&gt;</span> (&#123;<span class="attr">count</span>: state.count + <span class="number">1</span>&#125;))&#125;&gt;</span><br><span class="line">        Count: &#123;<span class="keyword">this</span>.state.count&#125;</span><br><span class="line">      &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<p>This can be a problem with more complex data structures. For example, this code does not work correctly:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// BROKEN: changing list of words does not render</span></span><br><span class="line"><span class="comment">// because the words array was mutated which </span></span><br><span class="line"><span class="comment">// React.PureComponent sees as equal.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ListOfWords</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">PureComponent</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> &lt;div&gt;&#123;this.props.words.join(',')&#125;&lt;/div&gt;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WordAdder</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      words: [<span class="string">'marklar'</span>]</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">this</span>.handleClick = <span class="keyword">this</span>.handleClick.bind(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleClick() &#123;</span><br><span class="line">    <span class="comment">// This section is bad style and causes a bug</span></span><br><span class="line">    <span class="keyword">const</span> words = <span class="keyword">this</span>.state.words;</span><br><span class="line">    words.push(<span class="string">'marklar'</span>);</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;<span class="attr">words</span>: words&#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;button onClick=&#123;<span class="keyword">this</span>.handleClick&#125; /&gt;</span><br><span class="line">        &lt;ListOfWords words=&#123;<span class="keyword">this</span>.state.words&#125; /&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<p>PureComponent will do a shallow comparison. Since this code mutates the words array, the old and new values of this.props.words will compare as equal, even though the actual words in the array have changed. The ListOfWords will thus not update even though it has new words that should be rendered.</p>
<p><strong>The Power Of Not Mutating Data</strong></p>
<p>Ways to avoid mutation</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateColorMap</span>(<span class="params">colormap</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Object</span>.assign(&#123;&#125;, colormap, &#123;<span class="attr">right</span>: <span class="string">'blue'</span>&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateColorMap</span>(<span class="params">colormap</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;...colormap, <span class="attr">right</span>: <span class="string">'blue'</span>&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="When-should-I-use-shouldComponentUpdate"><a href="#When-should-I-use-shouldComponentUpdate" class="headerlink" title="When should I use shouldComponentUpdate?"></a>When should I use <code>shouldComponentUpdate</code>?</h2><p>Will shouldComponentUpdate provide a measurable and perceivable performance improvement?</p>
<p>If not, don‚Äôt use it.</p>
<ul>
<li>Adding shouldComponentUpdate will often slow your component down</li>
<li>React is basically a very clever implementation of shouldComponentUpdate.</li>
<li>shouldComponentUpdate gains are often insignificant</li>
<li>Maintaining shouldComponentUpdate is hard</li>
</ul>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a href="https://goo.gl/wnrjbi" target="_blank" rel="noopener">Optimizing React Performance</a></li>
<li><a href="https://goo.gl/NBWYm3" target="_blank" rel="noopener">Should I use shouldComponentUpdate?</a></li>
</ul>

                
            </div>
        </article>
    
        <article class="post-abstract">
            <div class="post-title">
                <h2><a class="post-title-link" href="/2017/03/27/20170327-react-performance/">react performance</a></h2>
            </div>
            <div class="post-meta">
                <span class="post-time">2017-03-27</span>
                
            </div>
            <div class="post-content">
                
                    <h1 id="The-gist-of-performance-tuning"><a href="#The-gist-of-performance-tuning" class="headerlink" title="The gist of performance tuning"></a>The gist of performance tuning</h1><h2 id="Do-not-fix-what-isn‚Äôt-broken"><a href="#Do-not-fix-what-isn‚Äôt-broken" class="headerlink" title="Do not fix what isn‚Äôt broken"></a>Do not fix what isn‚Äôt broken</h2><p>Premature optimization is the root of all evil.</p>
<blockquote>
<p>Only work on optimizing if you can prove that a performance problem exists</p>
</blockquote>
<h2 id="Minimize-unnecessary-work"><a href="#Minimize-unnecessary-work" class="headerlink" title="Minimize unnecessary work"></a>Minimize unnecessary work</h2><p>re-rendering  </p>
<ul>
<li>sometimes react‚Äôs shallow-compare is not enough</li>
<li>re-rendering should only occur when props change</li>
</ul>
<p>shallow-compare</p>
<ul>
<li>why shallow-compare the 10k items in the list if you already know the result</li>
</ul>
<h2 id="Avoid-re-rendering-components-using-these-techniques"><a href="#Avoid-re-rendering-components-using-these-techniques" class="headerlink" title="Avoid re-rendering components using these techniques:"></a>Avoid re-rendering components using these techniques:</h2><ul>
<li>memoize from the lodash package</li>
<li>shouldComponentUpdate lifecycle method</li>
<li>HOCs from the recompose package</li>
<li>connect and createSelector from the redux and reselect packages</li>
</ul>
<h2 id="Pure-render-Anti-Patterns"><a href="#Pure-render-Anti-Patterns" class="headerlink" title="Pure render Anti-Patterns"></a>Pure render Anti-Patterns</h2><p>Avoid creating new refs in component props because they cause re-render.</p>
<p>Functions</p>
<ul>
<li><p>BAD: bind creates a new ref everytime  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;MyInput onChange=&#123;this.props.update.bind(this)&#125; /&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>BAD: anonymous creates a new ref everytime  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;MyInput onChange=&#123;() =&gt; this.props.update()&#125; /&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>GOOD: methods refs are constant  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;MyInput onChange=&#123;this.onChange&#125;/&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>Arrays</p>
<ul>
<li><p>BAD: a literal array creates a new ref everytime  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;SubComponent items=&#123;this.props.items || []&#125;/&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>GOOD: array constants refs are constant  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;SubComponent items=&#123;this.props.items || EMPTY_ARRAY&#125;/&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>Objects</p>
<ul>
<li><p>BAD: a literal object creates a new ref everytime  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;SubComponent style=&#123;&#123;display: &apos;block&apos;&#125;&#125; /&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>GOOD: object constants refs are constant  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;SubComponent style=&#123;MY_STYLES&#125; /&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="Avoid-re-rendering-pure-components"><a href="#Avoid-re-rendering-pure-components" class="headerlink" title="Avoid re-rendering pure components"></a>Avoid re-rendering pure components</h1><h2 id="Use-memoize-from-lodash"><a href="#Use-memoize-from-lodash" class="headerlink" title="Use memoize from lodash"></a>Use <code>memoize</code> from <code>lodash</code></h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> memoize <span class="keyword">from</span> <span class="string">'lodash/memoize'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  _render = memoize(<span class="function">(<span class="params">text</span>) =&gt;</span> &lt;div&gt;&#123;text&#125;&lt;<span class="regexp">/div&gt;)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  render() &#123; return _render(this.props.text) &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="Returning-false-from-shouldComponentUpdate"><a href="#Returning-false-from-shouldComponentUpdate" class="headerlink" title="Returning false from shouldComponentUpdate"></a>Returning false from <code>shouldComponentUpdate</code></h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">PureComponent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  shouldComponentUpdate() &#123; <span class="keyword">return</span> <span class="literal">false</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Use-the-HOCs-in-Recompose"><a href="#Use-the-HOCs-in-Recompose" class="headerlink" title="Use the HOCs in Recompose"></a>Use the HOCs in <a href="https://github.com/acdlite/recompose" target="_blank" rel="noopener">Recompose</a></h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// this component will re-render only when props change</span></span><br><span class="line">@pure</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">      <span class="comment">///...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// this component will re-render only when prop1/prop2 changes</span></span><br><span class="line"><span class="comment">// it will not re-render if prop3 changes</span></span><br><span class="line">@onlyUpdateForKeys([<span class="string">'prop1'</span>, <span class="string">'prop2'</span>])</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">      <span class="comment">///...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// if you don't like ES7 decorators you can use them like this:</span></span><br><span class="line">MyComponent = pure(MyComponent)</span><br><span class="line">MyComponent = onlyUpdateForKeys([<span class="string">'prop1'</span>, <span class="string">'prop2'</span>])(MyComponent)</span><br></pre></td></tr></table></figure>
<h2 id="Use-Redux-and-connect"><a href="#Use-Redux-and-connect" class="headerlink" title="Use Redux and connect"></a>Use <code>Redux</code> and <code>connect</code></h2><p>connect </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// only re-renders when prop1 changes</span></span><br><span class="line"><span class="comment">// comparison is also done using shallowCompare</span></span><br><span class="line">connect(<span class="function"><span class="params">state</span> =&gt;</span> (&#123;</span><br><span class="line">    prop1: state.prop1</span><br><span class="line">&#125;))(SomeComponent)</span><br></pre></td></tr></table></figure>
<p>connect‚Äôs <code>gotcha</code> is calculated values </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// this is ok</span></span><br><span class="line">connect(<span class="function"><span class="params">state</span> =&gt;</span> (&#123;</span><br><span class="line">    hasSomething: <span class="keyword">this</span>.prop1 === <span class="number">5</span> <span class="comment">// true===true</span></span><br><span class="line">&#125;))(SomeComponent)</span><br><span class="line"></span><br><span class="line"><span class="comment">// this is NOT OK</span></span><br><span class="line"><span class="comment">// computed data is a different object every-time even if props were un-changed</span></span><br><span class="line">connect(<span class="function"><span class="params">state</span> =&gt;</span> (&#123;</span><br><span class="line">    computedData: &#123;</span><br><span class="line">        height: state.height,</span><br><span class="line">        width: state.width</span><br><span class="line">    &#125;</span><br><span class="line">&#125;))(SomeComponent)</span><br></pre></td></tr></table></figure>
<p>Fixing connect‚Äôs gotcha with <a href="https://github.com/reactjs/reselect" target="_blank" rel="noopener">reselect</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createSelector&#125; <span class="keyword">from</span> <span class="string">'reselect'</span></span><br><span class="line"><span class="keyword">const</span> selectComputedData = createSelector(</span><br><span class="line">    state =&gt; state.height,</span><br><span class="line">    state =&gt; state.width,</span><br><span class="line">    (height, width) =&gt; (&#123;</span><br><span class="line">        height,</span><br><span class="line">        width</span><br><span class="line">    &#125;)</span><br><span class="line">)</span><br><span class="line">connect(<span class="function"><span class="params">state</span> =&gt;</span> (&#123;</span><br><span class="line">    computedData: selectComputedData(state)</span><br><span class="line">&#125;))(SomeComponent)</span><br></pre></td></tr></table></figure>
<h1 id="Pure-Render-Anti-Pattern"><a href="#Pure-Render-Anti-Pattern" class="headerlink" title="Pure Render Anti-Pattern"></a>Pure Render Anti-Pattern</h1><p>When using a pure component, pay special attention to arrays and functions. <code>Arrays and functions create new refs</code> so it‚Äôs up to you to create them only once and not during every render.</p>
<p>functions </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// BAD ‚Äì¬†renders everytime due to new fn ref</span></span><br><span class="line">render() &#123;</span><br><span class="line">  <span class="keyword">return</span> &lt;MyInput onChange=&#123;this.props.update.bind(this)&#125; /&gt;;</span><br><span class="line">&#125;</span><br><span class="line">// BAD ‚Äì¬†renders everytime due to new fn ref</span><br><span class="line">render() &#123;</span><br><span class="line">  return &lt;MyInput onChange=&#123;() =&gt; this.props.update()&#125; /&gt;;</span><br><span class="line">&#125;</span><br><span class="line">// GOOD</span><br><span class="line">onChange () &#123;</span><br><span class="line">  this.props.doUpdate()</span><br><span class="line">&#125;</span><br><span class="line">render() &#123;</span><br><span class="line">  return &lt;MyInput onChange=&#123;this.onChange&#125;/&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Arrays</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// BAD ‚Äì if there are no items, SubComponent will render every time!</span></span><br><span class="line">render() &#123;</span><br><span class="line">    <span class="keyword">return</span> &lt;SubComponent items=&#123;this.props.items || []&#125;/&gt;</span><br><span class="line">&#125;</span><br><span class="line">// GOOD ‚Äì¬†This will avoid re-rendering</span><br><span class="line">const EMPTY_ARRAY = []</span><br><span class="line">render() &#123;</span><br><span class="line">    return &lt;SubComponent items=&#123;this.props.items || EMPTY_ARRAY&#125;/&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Debugging"><a href="#Debugging" class="headerlink" title="Debugging"></a>Debugging</h1><p>This is a quick summary, but for more info and screen-shots read Benchling‚Äôs <a href="http://benchling.engineering/performance-engineering-with-react/" target="_blank" rel="noopener">part-1</a> and <a href="http://benchling.engineering/deep-dive-react-perf-debugging/" target="_blank" rel="noopener">part-2</a> blogs post about React performance engineering.</p>
<h2 id="Chrome-DevTools-Profiler"><a href="#Chrome-DevTools-Profiler" class="headerlink" title="Chrome DevTools Profiler"></a>Chrome DevTools Profiler</h2><p>Choose the Timeline tab in Chrome DevTools, and record while you perform an action in your application. The timeline will show you how much time the browser spent executing code, and how much time it spent rendering. Rendering here means the time that the browser itself takes to render the DOM on-screen‚Ää‚Äî‚ÄäReact render() calls are included in the JS execution time.</p>
<p>If you are doing Redux, use the slider in ReduxDevTools to repeat and record only the actions suspected to cause a slow re-render.</p>
<p>If you see that a React function like batchUpdates has a long total-time but short self-time, it means that there may be a performance issues with your React components, perhaps because they are rendering too often.<br>If this is the case we will use ReactPerf.</p>
<p><strong>React Perf</strong></p>
<p>Install the React Perf addon</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install react-addons-perf</span><br></pre></td></tr></table></figure>
<p>Import it into your project and expose it to the global context:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import Perf from &apos;react-addons-perf&apos;</span><br><span class="line">window.Perf = Perf</span><br></pre></td></tr></table></figure>
<p>Once installed in your project, you can use the <a href="https://chrome.google.com/webstore/detail/react-perf/hacmcodfllhbnekmghgdlplbdnahmhmm" target="_blank" rel="noopener">React Perf Chrome Extension</a> to call Perf functions, or issue calls directly from the console.</p>
<ol>
<li>Call Perf.start()</li>
<li>Take some actions in your application. This will be recorded by Perf (use ReduxDevTools slider if possible)</li>
<li>Call Perf.stop()</li>
<li>Now that the action has been recorded, you can call 3 useful functions:<br><strong>printInclusive()</strong>‚Ää‚Äî‚Ääprints how much time is spent in each component<br><strong>printExclusive()</strong>‚Ää‚Äî‚Ääprints how much time is spent doing rendering for each component (not including componentsWillMount, componentDidMount, props processing‚Ä¶)<br><strong>printWasted()</strong>‚Ää‚Äî‚Ääprints how much time was wasted rendering components that didn‚Äôt actually change (rendering was done only in the VirtualDOM layer, and no changes occurred in the browser DOM).This is the most important function, as it will bring up components that should be pure and instances of the anti-patterns described above.<br><strong>printOperations()</strong>‚Ää‚Äî‚Ääwill print the actual browser DOM manipulation, this is handy only when the browser spends too much time rendering.</li>
</ol>
<h2 id="Should-I-try-to-optimize"><a href="#Should-I-try-to-optimize" class="headerlink" title="Should I try to optimize?"></a>Should I try to optimize?</h2><p>react-dom is very fast by itself. You should only try to optimize once you have a problem that you can quantify with React Perf.</p>
<p>For example, consider a simple component like this:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Label = <span class="function">(<span class="params">&#123;text&#125;</span>) =&gt;</span> &lt;div className=<span class="string">'label'</span>&gt;&#123;text&#125;&lt;<span class="regexp">/div&gt;</span></span><br></pre></td></tr></table></figure>
<p>In this component, text probably never changes. Making it pure feels right, but this probably wont yield any noticeable improvement. Running shallowCompare will make about the same calculations as react-dom would, so by making the component pure you‚Äôve just moved the processing to a different place.</p>
<p>So in other words‚Ä¶<br>Don‚Äôt imagine a future problem, wait till react-dom is not good enough by itself, it usually is.</p>
<h2 id="Bonus-Tips"><a href="#Bonus-Tips" class="headerlink" title="Bonus Tips"></a>Bonus Tips</h2><ul>
<li>NODE_DEV=production</li>
<li>Remove PropType checking with <code>babel-plugin-transform-react-remove-prop-types</code></li>
</ul>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li>React/Redux Performance Tuning Tips ‚Äì <a href="https://goo.gl/6DC5A7" target="_blank" rel="noopener">part1</a> ‚Äì <a href="https://goo.gl/OHYN6E" target="_blank" rel="noopener">part2</a></li>
</ul>

                
            </div>
        </article>
    
</div>
<div class="paginator">
    
        
        <a class="prev" href="/page/6/">
            <i class="iconfont icon-prev"></i>
            Prev
        </a>
        
        
        <a class="next" href="/page/8/">
            Next
            <i class="iconfont icon-next"></i>
        </a>
        
    
</div>

    </div>
</div>
<footer class="footer-social">
    
    <a class="social-link" target="_blank" href="https://github.com/dearfrankg">
        <i class="iconfont icon-github"></i>
    </a>
    

    

    

    <div class="footer-copyright">
        <p class="time-line">
            &copy;
            
            
            2018
            &nbsp;<i class="iconfont icon-heart"></i>&nbsp;
            <a target="_blank" href="https://github.com/dearfrankg">Frank Gutierrez</a>
        </p>
    </div>
</footer>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="/js/index.js"></script>
<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> -->
<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
<script>
    
    var gitment = new Gitment({
        id: '',
        owner: 'dearfrankg',
        repo: 'blog-comments',
        oauth: {
            client_id: '1e06b3865efbfdedf5d0',
            client_secret: 'cd2f93735df5d8dfa8acda7897bcf8bae1559f9b'
        }
    });
    gitment.render('comment-container');
    

</script>
</html>
