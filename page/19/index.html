<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    <title>dev notes</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/gitment.css">
    <link rel="stylesheet" href="/css/font_859455_eaq7v6w8ktj.css">
</head>

<body>
<header class="header">
    <div class="header-inner">
        <div class="header-title">

        </div>
        <nav class="header-nav">
            
            <a href="/" class="header-nav-link">
                Home
            </a>
            

            
            <a href="/archives" class="header-nav-link">
                Archives
            </a>
            

            
            <a href="/tags" class="header-nav-link">
                Tags
            </a>
            

            
        </nav>
    </div>
</header>
<header class="mobile-header">
    <div class="mobile-nav">
        <div class="mobile-nav-icon">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <div class="mobile-nav-title">
            <a href="/" class="mobile-nav-title-link">Frank Gutierrez's Blog</a>
        </div>

    </div>
    <nav class="mobile-menu">
        <ul class="mobile-menu-list">
            <li class="mobile-menu-item">
                <i class="iconfont icon-home"></i>
                <a href="/" class="mobile-nav-link">Home</a>
            </li>
            <li class="mobile-menu-item">
                <i class="iconfont icon-archive"></i>
                <a href="/archives" class="mobile-nav-link">Archives</a>
            </li>
            <li class="mobile-menu-item">
                <i class="iconfont icon-tag"></i>
                <a href="/tags" class="mobile-nav-link">Tags</a>
            </li>
            <li class="mobile-menu-item">
                <i class="iconfont icon-about"></i>
                <a href="/about/" class="mobile-nav-link">About</a>
            </li>
        </ul>
    </nav>
</header>
<div class="main">
    <div class="content-inner">
        <div class="posts">
    
        <article class="post-abstract">
            <div class="post-title">
                <h2><a class="post-title-link" href="/2016/08/18/20160828-Using-Oauth2/">Using Oauth2</a></h2>
            </div>
            <div class="post-meta">
                <span class="post-time">2016-08-18</span>
                
            </div>
            <div class="post-content">
                
                    <h2 id="Auth-Examples"><a href="#Auth-Examples" class="headerlink" title="Auth Examples"></a>Auth Examples</h2><ol>
<li><p><a href="https://goo.gl/lm5PfF" target="_blank" rel="noopener">Login with password/social for react-native</a> (Auth0)</p>
</li>
<li><p><a href="https://goo.gl/XVqf72" target="_blank" rel="noopener">Login with password/social for react</a> (Auth0)</p>
</li>
<li><p><a href="https://goo.gl/lm5PfF" target="_blank" rel="noopener">Login with password for react, you manage accounts</a> (Auth0)</p>
</li>
<li><p><a href="https://goo.gl/MuUE0w" target="_blank" rel="noopener">Secure and authenticate users to your API</a> (Stormpath)</p>
</li>
</ol>
<h2 id="Mobile-Client"><a href="#Mobile-Client" class="headerlink" title="Mobile Client"></a>Mobile Client</h2><pre><code>// BUILD APP
react-native init cart
cd cart
npm i
npm install --save react-native-lock
react-native link react-native-lock

// START SERVER
react-native start

// START APP
react-native run-ios
</code></pre><h2 id="Web-Client"><a href="#Web-Client" class="headerlink" title="Web Client"></a>Web Client</h2><pre><code>// START DEVELOPMENT
npm start

// START PRODUCTION
npm run build
http-server -p 3000 dist
</code></pre><h2 id="API-Server"><a href="#API-Server" class="headerlink" title="API Server"></a>API Server</h2><pre><code>// START SERVER IN DEV MODE
nodemon server

// START SERVER IN PRODUCTION
node server

// TEST SERVER
curl localhost:8080/hello/dude
&quot;hello dude&quot;

// TEST PROTECTED ROUTE
export TOKEN=55
curl localhost:8080/protected   --header &quot;authorization: Bearer $TOKEN&quot;
{&quot;code&quot;:&quot;InvalidCredentials&quot;,&quot;message&quot;:&quot;&quot;}

// TEST PROTECTED ROUTE
export TOKEN=&quot;eyJ0eXAiOiJKV1...&quot;
curl localhost:8080/protected   --header &quot;authorization: Bearer $TOKEN&quot;
&quot;the secret is: apple pie&quot;
</code></pre>
                
            </div>
        </article>
    
        <article class="post-abstract">
            <div class="post-title">
                <h2><a class="post-title-link" href="/2016/08/10/20160831-guide-to-FP-part2/">Frisby&#39;s Mostly Adequate Guide to Functional Programming - Part 2</a></h2>
            </div>
            <div class="post-meta">
                <span class="post-time">2016-08-10</span>
                
            </div>
            <div class="post-content">
                
                    <!-- TOC depthFrom:1 depthTo:3 withLinks:1 updateOnSave:1 orderedList:0 -->
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#functors">Functors</a><ul>
<li><a href="#the-mighty-container">The Mighty Container</a></li>
<li><a href="#your-first-functor">Your First Functor</a></li>
<li><a href="#schr%C3%B6dingers-maybe">Schrödinger’s Maybe</a></li>
<li><a href="#maintaining-our-pointfree-style">maintaining our pointfree style</a></li>
<li><a href="#use-cases">Use Cases</a></li>
<li><a href="#releasing-the-value">Releasing the value</a></li>
<li><a href="#pure-error-handling">Pure Error Handling</a></li>
<li><a href="#lifting">Lifting</a></li>
<li><a href="#side-effects">side-effects</a></li>
<li><a href="#asynchronous-tasks">Asynchronous Tasks</a></li>
</ul>
</li>
</ul>
<!-- /TOC -->
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>This is Part 2 of a series on Functional Programming. See <a href="">Part 1</a></p>
<h2 id="Functors"><a href="#Functors" class="headerlink" title="Functors"></a>Functors</h2><p>To handle <code>control flow</code>, <code>error handling</code>, <code>asynchronous actions</code>, <code>state</code> and <code>effects</code>, we will discover the foundation upon which all of these helpful abstractions are built.</p>
<h3 id="The-Mighty-Container"><a href="#The-Mighty-Container" class="headerlink" title="The Mighty Container"></a>The Mighty Container</h3><ul>
<li>Container is an object with one property.</li>
<li>The <code>__value</code> cannot be one specific type.</li>
<li>Once data goes into the Container it stays there.</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Container = <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.__value = x;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Container.of = <span class="function"><span class="params">x</span> =&gt;</span> <span class="keyword">new</span> Container(x);</span><br><span class="line"></span><br><span class="line">Container.of(<span class="number">3</span>);</span><br><span class="line"><span class="comment">//=&gt; Container(3)</span></span><br></pre></td></tr></table></figure>
<h3 id="Your-First-Functor"><a href="#Your-First-Functor" class="headerlink" title="Your First Functor"></a>Your First Functor</h3><ul>
<li>We run functions on the data using a <code>map</code> method.</li>
</ul>
<blockquote>
<p>A Functor is a type that implements map and obeys some laws</p>
</blockquote>
<p>What we gain from asking our container to apply functions for us is, <code>abstraction of function application</code>. When we map a function, we ask the container type to run it for us.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// (a -&gt; b) -&gt; Container a -&gt; Container b</span></span><br><span class="line">Container.prototype.map = <span class="function"><span class="keyword">function</span>(<span class="params">f</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> Container.of(f(<span class="keyword">this</span>.__value));</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Container.of(<span class="string">"flamethrowers"</span>).map(<span class="function"><span class="params">s</span> =&gt;</span> s.toUpperCase());</span><br><span class="line"><span class="comment">//=&gt; Container("FLAMETHROWERS")</span></span><br></pre></td></tr></table></figure>
<p>Functors come from category theory and we’ll look at the maths in detail toward the end of the chapter.</p>
<h3 id="Schrodinger’s-Maybe"><a href="#Schrodinger’s-Maybe" class="headerlink" title="Schrödinger’s Maybe"></a>Schrödinger’s Maybe</h3><p>The <code>Maybe</code> functor checks to see if it has a value before calling the supplied function. This has the effect of side stepping those pesky nulls as we map (Note that this implementation is simplified for teaching).</p>
<figure class="highlight js"><figcaption><span>define and apply Maybe</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Maybe = <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123; <span class="keyword">this</span>.__value = x &#125;</span><br><span class="line"></span><br><span class="line">Maybe.of = <span class="function"><span class="keyword">function</span> (<span class="params">x</span>) =&gt; <span class="title">new</span> <span class="title">Maybe</span>(<span class="params">x</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">Maybe</span>.<span class="title">prototype</span>.<span class="title">isNothing</span> = <span class="title">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.__value === <span class="literal">null</span> || <span class="keyword">this</span>.__value === <span class="literal">undefined</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Maybe.prototype.map = <span class="function"><span class="keyword">function</span> (<span class="params">f</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.isNothing() ? Maybe.of(<span class="literal">null</span>) : Maybe.of(f(<span class="keyword">this</span>.__value)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Maybe.of(&#123; <span class="attr">name</span>: <span class="string">'Boris'</span> &#125;).map(_.prop(<span class="string">'age'</span>)).map(add(<span class="number">10</span>))</span><br><span class="line"><span class="comment">//=&gt; Maybe(null)</span></span><br><span class="line"></span><br><span class="line">Maybe.of(&#123; <span class="attr">name</span>: <span class="string">'Dinah'</span>, <span class="attr">age</span>: <span class="number">14</span>, &#125;).map(_.prop(<span class="string">'age'</span>)).map(add(<span class="number">10</span>))</span><br><span class="line"><span class="comment">//=&gt; Maybe(24)</span></span><br></pre></td></tr></table></figure>
<h3 id="maintaining-our-pointfree-style"><a href="#maintaining-our-pointfree-style" class="headerlink" title="maintaining our pointfree style"></a>maintaining our pointfree style</h3><p>This dot syntax is perfectly fine and functional, but we’d like to maintain our pointfree style. This <code>map</code> function is fully equipped to delegate to whatever functor it receives:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  map :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b</span></span><br><span class="line"><span class="keyword">var</span> map = curry(<span class="function"><span class="keyword">function</span>(<span class="params">f, any_functor_at_all</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> any_functor_at_all.map(f);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>This way we can carry on with composition per usual and map will work as expected. This is the case with <code>ramda</code>‘s map as well. We’ll use dot notation when it’s instructive and the pointfree version when it’s convenient. I’ve introduced extra notation into our type signature. In the signature, the <code>Functor f =&gt;</code> tells us that <code>f</code> must be a Functor.</p>
<h3 id="Use-Cases"><a href="#Use-Cases" class="headerlink" title="Use Cases"></a>Use Cases</h3><p><code>Maybe</code> can be used in functions that might otherwise fail to return a result.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  safeHead :: [a] -&gt; Maybe(a)</span></span><br><span class="line"><span class="keyword">var</span> safeHead = <span class="function"><span class="params">xs</span> =&gt;</span> Maybe.of(xs[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> streetName = compose(</span><br><span class="line">  map(_.prop(<span class="string">"street"</span>)),</span><br><span class="line">  safeHead,</span><br><span class="line">  _.prop(<span class="string">"addresses"</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">streetName(&#123; <span class="attr">addresses</span>: [] &#125;);</span><br><span class="line"><span class="comment">// Maybe(null)</span></span><br><span class="line"></span><br><span class="line">streetName(&#123;</span><br><span class="line">  addresses: [</span><br><span class="line">    &#123;</span><br><span class="line">      street: <span class="string">"Shady Ln."</span>,</span><br><span class="line">      number: <span class="number">4201</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// Maybe("Shady Ln.")</span></span><br></pre></td></tr></table></figure>
<p><code>Maybe</code> can be used to explicitly signal failure.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  withdraw :: Number -&gt; Account -&gt; Maybe(Account)</span></span><br><span class="line"><span class="keyword">const</span> withdraw = curry(<span class="function">(<span class="params">amount, account</span>) =&gt;</span></span><br><span class="line">   account.balance &gt;= amount</span><br><span class="line">    ? Maybe.of(&#123; <span class="attr">balance</span>: account.balance - amount &#125;)</span><br><span class="line">    : Maybe.of(<span class="literal">null</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//  finishTransaction :: Account -&gt; String</span></span><br><span class="line"><span class="keyword">const</span> finishTransaction = compose(remainingBalance, updateLedger)</span><br><span class="line"><span class="comment">// &lt;- these composed functions are hypothetical, not implemented here...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//  getTwenty :: Account -&gt; Maybe(String)</span></span><br><span class="line"><span class="keyword">const</span> getTwenty = compose(map(finishTransaction), withdraw(<span class="number">20</span>))</span><br><span class="line"></span><br><span class="line">getTwenty(&#123; <span class="attr">balance</span>: <span class="number">200.00</span> &#125;)</span><br><span class="line"><span class="comment">// Maybe("Your balance is $180.00")</span></span><br><span class="line"></span><br><span class="line">getTwenty(&#123; <span class="attr">balance</span>: <span class="number">10.00</span> &#125;)</span><br><span class="line"><span class="comment">// Maybe(null)</span></span><br></pre></td></tr></table></figure>
<p>It is important to note: if the <code>withdraw</code> fails, then <code>map</code> will sever the rest of our computation since it doesn’t ever run the mapped functions, namely <code>finishTransaction</code>. This is precisely the intended behavior as we’d prefer not to update our ledger or show a new balance if we hadn’t successfully withdrawn funds.</p>
<h3 id="Releasing-the-value"><a href="#Releasing-the-value" class="headerlink" title="Releasing the value"></a>Releasing the value</h3><p>One thing people often miss is that there will always be an end of the line some effecting function that sends JSON along, or prints to the screen, or alters our filesystem, or what have you. We cannot deliver the output with <code>return</code>, we must run some function or another to send it out into the world.</p>
<p>Our application’s job is to retrieve, transform, and carry that data along until it’s time to say goodbye and the function which does so may be mapped, thus the value needn’t leave the warm womb of its container. Indeed, a common error is to try to remove the value from our <code>Maybe</code> one way or another as if the possible value inside will suddenly materialize and all will be forgiven. We must understand it may be a branch of code where our value is not around to live up to its destiny. Our code, much like Schrödinger’s cat, is in two states at once and should maintain that fact until the final function. This gives our code a linear flow despite the logical branching.</p>
<p>There is a little helper called <code>maybe</code> that will return a custom value and continue on.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  maybe :: b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b</span></span><br><span class="line"><span class="keyword">var</span> maybe = curry(<span class="function"><span class="keyword">function</span>(<span class="params">x, f, m</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> m.isNothing() ? x : f(m.__value);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//  getTwenty :: Account -&gt; String</span></span><br><span class="line"><span class="keyword">var</span> getTwenty = compose(maybe(<span class="string">"You're broke!"</span>, finishTransaction, withdraw(<span class="number">20</span>)));</span><br><span class="line"></span><br><span class="line">getTwenty(&#123; <span class="attr">balance</span>: <span class="number">200.0</span> &#125;);</span><br><span class="line"><span class="comment">// "Your balance is $180.00"</span></span><br><span class="line"></span><br><span class="line">getTwenty(&#123; <span class="attr">balance</span>: <span class="number">10.0</span> &#125;);</span><br><span class="line"><span class="comment">// "You're broke!"</span></span><br></pre></td></tr></table></figure>
<p>With <code>maybe</code>, we are witnessing the equivalent of an <code>if/else</code> statement whereas with <code>map</code>, the imperative analog would be: <code>if (x !== null) { return f(x) }</code>.</p>
<p>When pushed to deal with null checks all the time most people can’t help, but feel it’s a tad laborious. However, with time, it will become second nature and you’ll likely appreciate the safety.</p>
<p>I’d be remiss if I didn’t mention that the “real” implementation will split <code>Maybe</code> into two types: one for <code>something</code> and the other for <code>nothing</code>. This allows us to obey parametricity in map so values like null and undefined can still be mapped over and the universal qualification of the value in a functor will be respected. You’ll often see types like <code>Some(x) / None</code> or <code>Just(x) / Nothing</code> instead of a <code>Maybe</code> that does a null check on its value.</p>
<h3 id="Pure-Error-Handling"><a href="#Pure-Error-Handling" class="headerlink" title="Pure Error Handling"></a>Pure Error Handling</h3><p>It may come as a shock, but <code>throw/catch</code> is not very pure. With our new friend <code>Either</code>, we can respond with a polite message.</p>
<p><code>Left</code> and <code>Right</code> are two subclasses of an abstract type we call <code>Either</code>. I’ve skipped the ceremony of creating the <code>Either</code> superclass as we won’t ever use it, but it’s good to be aware. Let’s see how they act:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Left = <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123; <span class="keyword">this</span>.__value = x &#125;</span><br><span class="line"></span><br><span class="line">Left.of = <span class="function">(<span class="params">x</span>) =&gt;</span> <span class="keyword">new</span> Left(x)</span><br><span class="line"></span><br><span class="line">Left.prototype.map = <span class="function"><span class="keyword">function</span> (<span class="params">f</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Right = <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123; <span class="keyword">this</span>.__value = x &#125;</span><br><span class="line"></span><br><span class="line">Right.of = <span class="function">(<span class="params">x</span>) =&gt;</span> <span class="keyword">new</span> Right(x)</span><br><span class="line"></span><br><span class="line">Right.prototype.map = <span class="function"><span class="keyword">function</span> (<span class="params">f</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> Right.of(f(<span class="keyword">this</span>.__value))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Right.of(<span class="string">'rain'</span>).map(<span class="function">(<span class="params">str</span>) =&gt;</span> <span class="string">'b'</span> + str)</span><br><span class="line"><span class="comment">// Right('brain')</span></span><br><span class="line"></span><br><span class="line">Left.of(<span class="string">'rain'</span>).map(<span class="function">(<span class="params">str</span>) =&gt;</span> <span class="string">'b'</span> + str</span><br><span class="line"><span class="comment">// Left('rain')</span></span><br><span class="line"></span><br><span class="line">Right.of(&#123;</span><br><span class="line">  host: <span class="string">'localhost'</span>,</span><br><span class="line">  port: <span class="number">80</span>,</span><br><span class="line">&#125;).map(_.prop(<span class="string">'host'</span>))</span><br><span class="line"><span class="comment">// Right('localhost')</span></span><br><span class="line"></span><br><span class="line">Left.of(<span class="string">'rolls eyes...'</span>).map(_.prop(<span class="string">'host'</span>))</span><br><span class="line"><span class="comment">// Left('rolls eyes...')</span></span><br></pre></td></tr></table></figure>
<p>Let’s use <code>Left</code> to find out more about a failure.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> moment = <span class="built_in">require</span>(<span class="string">"moment"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//  getAge :: Date -&gt; User -&gt; Either(String, Number)</span></span><br><span class="line"><span class="keyword">var</span> getAge = curry(<span class="function"><span class="keyword">function</span>(<span class="params">now, user</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> birthdate = moment(user.birthdate, <span class="string">"YYYY-MM-DD"</span>);</span><br><span class="line">  <span class="keyword">if</span> (!birthdate.isValid()) <span class="keyword">return</span> Left.of(<span class="string">"Birth date could not be parsed"</span>);</span><br><span class="line">  <span class="keyword">return</span> Right.of(now.diff(birthdate, <span class="string">"years"</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">getAge(moment(), &#123; <span class="attr">birthdate</span>: <span class="string">"2005-12-12"</span> &#125;);</span><br><span class="line"><span class="comment">// Right(9)</span></span><br><span class="line"></span><br><span class="line">getAge(moment(), &#123; <span class="attr">birthdate</span>: <span class="string">"20010704"</span> &#125;);</span><br><span class="line"><span class="comment">// Left('Birth date could not be parsed')</span></span><br></pre></td></tr></table></figure>
<p>Something to notice is that we return <code>Either(String, Number)</code>, which holds a String as its Left value and a Number as its Right. This type signature is a bit informal as we haven’t taken the time to define an actual Either superclass, however, we learn a lot from the type. It informs us that we’re either getting an error message or the age back.</p>
<p>In this example, we are logically branching our control flow depending on the validity of the birth date, yet it reads as one linear motion from right to left rather than climbing through the curly braces of a conditional statement.</p>
<blockquote>
<p>FYI In some browsers you have to use <code>console.log.bind(console)</code> to use it first class</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  fortune :: Number -&gt; String</span></span><br><span class="line"><span class="keyword">var</span> fortune = compose(</span><br><span class="line">  concat(<span class="string">"If you survive, you will be "</span>),</span><br><span class="line">  add(<span class="number">1</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">//  zoltar :: User -&gt; Either(String, _)</span></span><br><span class="line"><span class="keyword">var</span> zoltar = compose(</span><br><span class="line">  map(<span class="built_in">console</span>.log),</span><br><span class="line">  map(fortune),</span><br><span class="line">  getAge(moment())</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">zoltar(&#123; <span class="attr">birthdate</span>: <span class="string">"2005-12-12"</span> &#125;);</span><br><span class="line"><span class="comment">// 'If you survive, you will be 10'</span></span><br><span class="line"><span class="comment">// Right(undefined)</span></span><br><span class="line"></span><br><span class="line">zoltar(&#123; <span class="attr">birthdate</span>: <span class="string">"balloons!"</span> &#125;);</span><br><span class="line"><span class="comment">// Left('Birth date could not be parsed')</span></span><br></pre></td></tr></table></figure>
<h3 id="Lifting"><a href="#Lifting" class="headerlink" title="Lifting"></a>Lifting</h3><p>At the time of calling, a function can be surrounded by map, which transforms it from a <code>non-functory</code> function to a <code>functory</code> one, in informal terms. We call this process lifting. Functions tend to be better off working with normal data types rather than container types, then lifted into the right container as deemed necessary. This leads to simpler, more reusable functions that can be altered to work with any functor on demand.</p>
<blockquote>
<p><code>Lifting</code> transforms a non-functory function to a functory one by surrounding it with map</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MAP</span></span><br><span class="line"><span class="comment">// map :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b</span></span><br><span class="line"><span class="comment">// var map = curry(function(f, any_functor_at_all) &#123;</span></span><br><span class="line"><span class="comment">//   return any_functor_at_all.map(f)</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//  zoltar :: User -&gt; Either(String, _)</span></span><br><span class="line"><span class="keyword">var</span> zoltar = compose(</span><br><span class="line">  map(<span class="built_in">console</span>.log),</span><br><span class="line">  map(fortune),</span><br><span class="line">  getAge(moment())</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<ul>
<li><code>getAge(moment())</code> will return an <code>Either</code> resulting in a <code>Left</code> or <code>Right</code></li>
<li>onError: map(fortune) doesn’t process fortune function</li>
<li>onSuccess: map(fortune) does process fortune function</li>
<li>onError: map(console.log) does not print</li>
<li>onSuccess: map(console.log) prints <code>If you survive, you will be 10</code></li>
</ul>
<p><code>Either</code> is great for casual errors like validation as well as more serious, stop the show errors like missing files or broken sockets. Try replacing some of the <code>Maybe</code> examples with <code>Either</code> to give better feedback.</p>
<p>There are many things <code>Either</code> can be, but as a functor, it is used for its error handling.</p>
<p>Just like with <code>Maybe</code>, we have little <code>either</code>, which behaves similarly, but takes two functions instead of one and a static value. Each function should return the same type:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  either :: (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c</span></span><br><span class="line"><span class="keyword">var</span> either = curry(<span class="function"><span class="keyword">function</span>(<span class="params">f, g, e</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (e.constructor) &#123;</span><br><span class="line">    <span class="keyword">case</span> Left:</span><br><span class="line">      <span class="keyword">return</span> f(e.__value);</span><br><span class="line">    <span class="keyword">case</span> Right:</span><br><span class="line">      <span class="keyword">return</span> g(e.__value);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//  zoltar :: User -&gt; _</span></span><br><span class="line"><span class="keyword">var</span> zoltar = compose(</span><br><span class="line">  <span class="built_in">console</span>.log,</span><br><span class="line">  either(id, fortune),</span><br><span class="line">  getAge(moment())</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">zoltar(&#123; <span class="attr">birthdate</span>: <span class="string">"2005-12-12"</span> &#125;);</span><br><span class="line"><span class="comment">// "If you survive, you will be 10"</span></span><br><span class="line"><span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line">zoltar(&#123; <span class="attr">birthdate</span>: <span class="string">"balloons!"</span> &#125;);</span><br><span class="line"><span class="comment">// "Birth date could not be parsed"</span></span><br><span class="line"><span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>
<p>Finally, a use for that mysterious <code>id</code> function. It simply parrots back the value in the <code>Left</code> to pass the error message to console.log. We’ve made our fortune telling app more robust by enforcing error handling from within getAge.</p>
<h3 id="side-effects"><a href="#side-effects" class="headerlink" title="side-effects"></a>side-effects</h3><p>In our chapter about purity we saw a peculiar example of a pure function. This function contained a side-effect, but we dubbed it pure by wrapping its action in another function. Here’s another example of this:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  getFromStorage :: String -&gt; (_ -&gt; String)</span></span><br><span class="line"><span class="keyword">var</span> getFromStorage = <span class="function"><span class="keyword">function</span>(<span class="params">key</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> localStorage[key];</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Had we not surrounded its guts in another function, getFromStorage would vary its output depending on external circumstance. With the sturdy wrapper in place, we will always get the same output per input: a function that, when called, will retrieve a particular item from localStorage. And just like that (maybe throw in a few Hail Mary’s) we’ve cleared our conscience and all is forgiven.</p>
<p>Except, this isn’t particularly useful now is it. Like a collectible action figure in its original packaging, we can’t actually play with it. If only there were a way to reach inside of the container and get at its contents… Enter <code>IO</code>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> IO = <span class="function"><span class="keyword">function</span>(<span class="params">f</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.__value = f;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">IO.of = <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> IO(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">IO.prototype.map = <span class="function"><span class="keyword">function</span>(<span class="params">f</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> IO(</span><br><span class="line">    _.compose(</span><br><span class="line">      f,</span><br><span class="line">      <span class="keyword">this</span>.__value</span><br><span class="line">    )</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><code>IO</code> differs from the previous functors in that the <code>__value</code> is always a function. We don’t think of its <code>__value</code> as a function, however - that is an implementation detail and we best ignore it. What is happening is exactly what we saw with the <code>getFromStorage</code> example: <code>IO</code> delays the impure action by capturing it in a function wrapper. As such, we think of <code>IO</code> as containing the return value of the wrapped action and not the wrapper itself. This is apparent in the of function: we have an <code>IO(x)</code>, the <code>IO(function(){ return x })</code> is just necessary to avoid evaluation.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  io_window :: IO Window</span></span><br><span class="line"><span class="keyword">var</span> io_window = <span class="keyword">new</span> IO(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">window</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">io_window.map(<span class="function"><span class="keyword">function</span>(<span class="params">win</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> win.innerWidth;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// IO(1430)</span></span><br><span class="line"></span><br><span class="line">io_window</span><br><span class="line">  .map(_.prop(<span class="string">"location"</span>))</span><br><span class="line">  .map(_.prop(<span class="string">"href"</span>))</span><br><span class="line">  .map(_.split(<span class="string">"/"</span>));</span><br><span class="line"><span class="comment">// IO(["http:", "", "localhost:8000", "blog", "posts"])</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//  $ :: String -&gt; IO [DOM]</span></span><br><span class="line"><span class="keyword">var</span> $ = <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> IO(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">document</span>.querySelectorAll(selector);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">$(<span class="string">"#myDiv"</span>)</span><br><span class="line">  .map(head)</span><br><span class="line">  .map(<span class="function"><span class="keyword">function</span>(<span class="params">div</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> div.innerHTML;</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="comment">// IO('I am some inner html')</span></span><br></pre></td></tr></table></figure>
<p>Here, <code>io_window</code> is an actual <code>IO</code> that we can <code>map</code> over straight away, whereas <code>$</code> is a function that returns an <code>IO</code> after its called. I’ve written out the <em>conceptual</em> return values to better express the IO, though, in reality, it will always be <code>{ __value: [Function] }</code>. When we <code>map</code> over our <code>IO</code>, we stick that function at the end of a composition which, in turn, becomes the new <code>__value</code> and so on. Our mapped functions do not run, they get tacked on the end of a computation we’re building up, function by function, like carefully placing dominoes that we don’t dare tip over. The result is reminiscent of Gang of Four’s command pattern or a queue.</p>
<p>Take a moment to channel your functor intuition. If we see past the implementation details, we should feel right at home mapping over any container no matter its quirks or idiosyncrasies. We have the functor laws, which we will explore toward the end of the chapter, to thank for this pseudo-psychic power. At any rate, we can finally play with impure values without sacrificing our precious purity.</p>
<p>Mapping over our IO has built up a mighty impure computation and running it is surely going to disturb the peace. So where and when can we pull the trigger? If we put the onus on the calling code. Our pure code, despite the nefarious plotting and scheming, maintains its innocence and it’s the caller who gets burdened with the responsibility of actually running the effects. Let’s see an example to make this concrete.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">“<span class="comment">////// Our pure library: lib/params.js ///////</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//  url :: IO String</span></span><br><span class="line"><span class="keyword">var</span> url = <span class="keyword">new</span> IO(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">window</span>.location.href</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//  toPairs =  String -&gt; [[String]]</span></span><br><span class="line"><span class="keyword">var</span> toPairs = compose(map(split(<span class="string">'='</span>)), split(<span class="string">'&amp;'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">//  params :: String -&gt; [[String]]</span></span><br><span class="line"><span class="keyword">var</span> params = compose(toPairs, last, split(<span class="string">'?'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">//  findParam :: String -&gt; IO Maybe [String]</span></span><br><span class="line"><span class="keyword">var</span> findParam = <span class="function"><span class="keyword">function</span>(<span class="params">key</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> map(compose(Maybe.of, filter(compose(eq(key), head)), params), url)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">////// Impure calling code: main.js ///////</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// run it by calling __value()!</span></span><br><span class="line">findParam(<span class="string">"searchTerm"</span>).__value()</span><br><span class="line"><span class="comment">// Maybe([['searchTerm', 'wafflehouse']])</span></span><br></pre></td></tr></table></figure>
<p>Our library keeps its hands clean by wrapping url in an IO and passing the buck to the caller. You might have also noticed that we have stacked our containers it’s perfectly reasonable to have a IO(Maybe([x])), which is three functors deep (Array is most definitely a mappable container type) and exceptionally expressive.</p>
<p>There’s something that’s been bothering me and we should rectify it immediately: IO’s __value isn’t really its contained value, nor is it a private property as the underscore prefix suggests. It is the pin in the grenade and it is meant to be pulled by a caller in the most public of ways. Let’s rename this property to unsafePerformIO to remind our users of its volatility.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> IO = <span class="function"><span class="keyword">function</span>(<span class="params">f</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.unsafePerformIO = f;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">IO.prototype.map = <span class="function"><span class="keyword">function</span>(<span class="params">f</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> IO(</span><br><span class="line">    _.compose(</span><br><span class="line">      f,</span><br><span class="line">      <span class="keyword">this</span>.unsafePerformIO</span><br><span class="line">    )</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>There, much better. Now our calling code becomes findParam(“searchTerm”).unsafePerformIO(), which is clear as day to users (and readers) of the application.</p>
<p>IO will be a loyal companion, helping us tame those feral impure actions. Next, we’ll see a type similar in spirit, but has a drastically different use case.</p>
<h3 id="Asynchronous-Tasks"><a href="#Asynchronous-Tasks" class="headerlink" title="Asynchronous Tasks"></a>Asynchronous Tasks</h3><p>Callbacks are the narrowing spiral staircase to hell. They are control flow as designed by M.C. Escher. With each nested callback squeezed in between the jungle gym of curly braces and parenthesis, they feel like limbo in an oubliette(how low can we go!). I’m getting claustrophobic chills just thinking about them. Not to worry, we have a much better way of dealing with asynchronous code and it starts with an “F”.</p>
<p>The internals are a bit too complicated to spill out all over the page here so we will use Data.Task (previously Data.Future) from Quildreen Motta’s fantastic Folktale. Behold some example usage:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Node readfile example:</span></span><br><span class="line"><span class="comment">//=======================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//  readFile :: String -&gt; Task Error String</span></span><br><span class="line"><span class="keyword">var</span> readFile = <span class="function"><span class="keyword">function</span>(<span class="params">filename</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Task(<span class="function"><span class="keyword">function</span>(<span class="params">reject, result</span>) </span>&#123;</span><br><span class="line">    fs.readFile(filename, <span class="string">'utf-8'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">      err ? reject(err) : result(data);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">readFile(<span class="string">'metamorphosis'</span>).map(split(<span class="string">'\n'</span>)).map(head);</span><br><span class="line"><span class="comment">// Task("One morning, as Gregor Samsa was waking up from anxious dreams,</span></span><br><span class="line"><span class="comment">// he discovered that in bed he had been changed into a monstrous verminous bug.")</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// jQuery getJSON example:</span></span><br><span class="line"><span class="comment">//========================</span></span><br><span class="line"></span><br><span class="line">“<span class="comment">//  getJSON :: String -&gt; &#123;&#125; -&gt; Task Error JSON</span></span><br><span class="line"><span class="keyword">var</span> getJSON = curry(<span class="function"><span class="keyword">function</span>(<span class="params">url, params</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Task(<span class="function"><span class="keyword">function</span>(<span class="params">reject, result</span>) </span>&#123;</span><br><span class="line">    $.getJSON(url, params, result).fail(reject);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">getJSON(<span class="string">'/video'</span>, &#123;</span><br><span class="line">  id: <span class="number">10</span>,</span><br><span class="line">&#125;).map(_.prop(<span class="string">'title'</span>));</span><br><span class="line"><span class="comment">// Task("Family Matters ep 15")</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// We can put normal, non futuristic values inside as well</span></span><br><span class="line">Task.of(<span class="number">3</span>).map(<span class="function"><span class="keyword">function</span>(<span class="params">three</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> three + <span class="number">1</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// Task(4)</span></span><br></pre></td></tr></table></figure>
<p>The functions I’m calling reject and result are our error and success callbacks, respectively. As you can see, we simply map over the Task to work on the future value as if it was right there in our grasp. By now map should be old hat.</p>
<p>If you’re familiar with promises, you might recognize the function map as then with Task playing the role of our promise. Don’t fret if you aren’t familiar with promises, we won’t be using them anyhow because they are not pure, but the analogy holds nonetheless.</p>
<p>Like IO, Task will patiently wait for us to give it the green light before running. In fact, because it waits for our command, IO is effectively subsumed by Task for all things asynchronous; readFile and getJSON don’t require an extra IO container to be pure. What’s more, Task works in a similar fashion when we map over it: we’re placing instructions for the future like a chore chart in a time capsule - an act of sophisticated technological procrastination.</p>
<p>To run our Task, we must call the method fork. This works like unsafePerformIO, but as the name suggests, it will fork our process and evaluation continues on without blocking our thread. This can be implemented in numerous ways with threads and such, but here it acts as a normal async call would and the big wheel of the event loop keeps on turning. Let’s look at fork:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Pure application</span></span><br><span class="line"><span class="comment">//=====================</span></span><br><span class="line"><span class="comment">// blogTemplate :: String</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//  blogPage :: Posts -&gt; HTML</span></span><br><span class="line"><span class="keyword">var</span> blogPage = Handlebars.compile(blogTemplate);</span><br><span class="line"></span><br><span class="line"><span class="comment">//  renderPage :: Posts -&gt; HTML</span></span><br><span class="line"><span class="keyword">var</span> renderPage = compose(</span><br><span class="line">  blogPage,</span><br><span class="line">  sortBy(<span class="string">"date"</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">//  blog :: Params -&gt; Task Error HTML</span></span><br><span class="line"><span class="keyword">var</span> blog = compose(</span><br><span class="line">  map(renderPage),</span><br><span class="line">  getJSON(<span class="string">"/posts"</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Impure calling code</span></span><br><span class="line"><span class="comment">//=====================</span></span><br><span class="line">blog(&#123;&#125;).fork(</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">    $(<span class="string">"#error"</span>).html(error.message);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">page</span>) </span>&#123;</span><br><span class="line">    $(<span class="string">"#main"</span>).html(page);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">$(<span class="string">"#spinner"</span>).show();</span><br></pre></td></tr></table></figure>
<p>Upon calling fork, the Task hurries off to find some posts and render the page. Meanwhile, we show a spinner since fork does not wait for a response. Finally, we will either display an error or render the page onto the screen depending if the getJSON call succeeded or not.</p>
<p>Take a moment to consider how linear the control flow is here. We just read bottom to top, right to left even though the program will actually jump around a bit during execution. This makes reading and reasoning about our application simpler than having to bounce between callbacks and error handling blocks.</p>
<p>Goodness, would you look at that, Task has also swallowed up Either! It must do so in order to handle futuristic failures since our normal control flow does not apply in the async world. This is all well and good as it provides sufficient and pure error handling out of the box.</p>
<p>Even with Task, our IO and Either functors are not out of a job. Bear with me on a quick example that leans toward the more complex and hypothetical side, but is useful for illustrative purposes.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Postgres.connect :: Url -&gt; IO DbConnection</span></span><br><span class="line"><span class="comment">// runQuery :: DbConnection -&gt; ResultSet</span></span><br><span class="line"><span class="comment">// readFile :: String -&gt; Task Error String</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Pure application</span></span><br><span class="line"><span class="comment">//=====================</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//  dbUrl :: Config -&gt; Either Error Url</span></span><br><span class="line"><span class="keyword">var</span> dbUrl = <span class="function"><span class="keyword">function</span>(<span class="params">c</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> c.uname &amp;&amp; c.pass &amp;&amp; c.host &amp;&amp; c.db</span><br><span class="line">    ? Right.of(<span class="string">"db:pg://"</span> + c.uname + <span class="string">":"</span> + c.pass + <span class="string">"@"</span> + c.host + <span class="string">"5432/"</span> + c.db)</span><br><span class="line">    : Left.of(<span class="built_in">Error</span>(<span class="string">"Invalid config!"</span>));</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  connectDb :: Config -&gt; Either Error (IO DbConnection)</span></span><br><span class="line"><span class="keyword">var</span> connectDb = compose(</span><br><span class="line">  map(Postgres.connect),</span><br><span class="line">  dbUrl</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">//  getConfig :: Filename -&gt; Task Error (Either Error (IO DbConnection))</span></span><br><span class="line"><span class="keyword">var</span> getConfig = compose(</span><br><span class="line">  map(</span><br><span class="line">    compose(</span><br><span class="line">      connectDb,</span><br><span class="line">      <span class="built_in">JSON</span>.parse</span><br><span class="line">    )</span><br><span class="line">  ),</span><br><span class="line">  readFile</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Impure calling code</span></span><br><span class="line"><span class="comment">//=====================</span></span><br><span class="line">getConfig(<span class="string">"db.json"</span>).fork(logErr(<span class="string">"couldn't read file"</span>), either(<span class="built_in">console</span>.log, map(runQuery)));</span><br></pre></td></tr></table></figure>
<p>In this example, we still make use of Either and IO from within the success branch of readFile. Task takes care of the impurities of reading a file asynchronously, but we still deal with validating the config with Either and wrangling the db connection with IO. So you see, we’re still in business for all things synchronous.</p>
<p>I could go on, but that’s all there is to it. Simple as map.</p>
<p>In practice, you’ll likely have multiple asynchronous tasks in one workflow and we haven’t yet acquired the full container APIs to tackle this scenario. Not to worry, we’ll look at monads and such soon, but first, we must examine the maths that make this all possible.</p>

                
            </div>
        </article>
    
        <article class="post-abstract">
            <div class="post-title">
                <h2><a class="post-title-link" href="/2016/08/02/20160809-guide-to-FP-part1/">Frisby&#39;s Mostly Adequate Guide to Functional Programming - Part 1</a></h2>
            </div>
            <div class="post-meta">
                <span class="post-time">2016-08-02</span>
                
            </div>
            <div class="post-content">
                
                    <!-- TOC depthFrom:1 depthTo:1 withLinks:1 updateOnSave:0 orderedList:0 -->
<ul>
<li><a href="#Introduction">Introduction</a></li>
<li><a href="#First-Class-Functions">First Class Functions</a></li>
<li><a href="#Pure-Functions">Pure Functions</a></li>
<li><a href="#Currying">Currying</a></li>
<li><a href="#Composing">Composing</a></li>
<li><a href="#Example-Application">Example Application</a></li>
<li><a href="#Hindley-Milner-Type-Signatures">Hindley-Milner Type Signatures</a></li>
<li><a href="#Conclusion">Conclusion</a></li>
</ul>
<!-- /TOC -->
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>This will be Part 1 of a multi-part series on Functional Programming.  By the end of the series I think you’ll agree that Functional Programming (FP) requires less code and is easier to understand than other programming paradigms.</p>
<p>We will be using math properties to refactor programs:</p>
<pre><code>// associative
// add or multiply regardless of grouping
( a + b ) + c === a + ( b + c )
( a * b ) * c === a * ( b * c )

// commutative
// add or multiply regardless of order
a + b === b + a
a * b === b * a

// identity
// Any number multiplied by 1 is itself
a * 1 === a

// distributive
// multiply a single term and multiple terms inside parenthesis
a( b + c ) === a * b + a * c
</code></pre><p>Don’t worry more math to come.</p>
<h2 id="First-Class-Functions"><a href="#First-Class-Functions" class="headerlink" title="First Class Functions"></a>First Class Functions</h2><p>The term ‘first class’ is just a classification.  It refers to the fact that it is a fundamental component of the language.  Hence you can pass functions around just as you do strings and integers.</p>
<h3 id="Don’t-wrap-functions"><a href="#Don’t-wrap-functions" class="headerlink" title="Don’t wrap functions"></a>Don’t wrap functions</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> hi = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'Hi '</span> + name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** ignorant</span></span><br><span class="line"><span class="comment"> * unnecessarily wraps a function</span></span><br><span class="line"><span class="comment"> * forces a one argument signature</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> greeting = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> hi(name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// enlightened</span></span><br><span class="line"><span class="keyword">var</span> greeting = hi</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ignorant</span></span><br><span class="line"><span class="keyword">var</span> getServerStuff = <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> ajaxCall(<span class="function"><span class="keyword">function</span>(<span class="params">json</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> callback(json)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// enlightened</span></span><br><span class="line"><span class="keyword">var</span> getServerStuff = ajaxCall</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ignorant</span></span><br><span class="line"><span class="keyword">var</span> BlogController = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> create = <span class="function"><span class="keyword">function</span>(<span class="params">attrs</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Db.create(attrs)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    create: create</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// enlightened</span></span><br><span class="line"><span class="keyword">var</span> BlogController = &#123;</span><br><span class="line">  create: Db.create,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Don’t-tie-function-names-to-specific-data"><a href="#Don’t-tie-function-names-to-specific-data" class="headerlink" title="Don’t tie function names to specific data"></a>Don’t tie function names to specific data</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// specific to our current blog</span></span><br><span class="line"><span class="keyword">var</span> validArticles = <span class="function"><span class="keyword">function</span>(<span class="params">articles</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> articles.filter(<span class="function"><span class="keyword">function</span>(<span class="params">article</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> article !== <span class="literal">null</span> &amp;&amp; article !== <span class="literal">undefined</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// vastly more relevant for future projects</span></span><br><span class="line"><span class="keyword">var</span> compact = <span class="function"><span class="keyword">function</span>(<span class="params">xs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> xs.filter(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x !== <span class="literal">null</span> &amp;&amp; x !== <span class="literal">undefined</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Be-aware-of-JS-leaky-abstractions"><a href="#Be-aware-of-JS-leaky-abstractions" class="headerlink" title="Be aware of JS leaky abstractions"></a>Be aware of JS leaky abstractions</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// scary</span></span><br><span class="line">fs.readFile(<span class="string">'freaky_friday.txt'</span>, Db.save)</span><br><span class="line"></span><br><span class="line"><span class="comment">// less so</span></span><br><span class="line">fs.readFile(<span class="string">'freaky_friday.txt'</span>, Db.save.bind(Db))</span><br></pre></td></tr></table></figure>
<h3 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h3><ul>
<li>Reduce complexity by not wrapping functions unnecessarily.</li>
<li>Increase code reuse by trying to avoid function names that tie the name to specific data.</li>
<li>Be aware of <code>leaky abstractions</code> like <code>this</code> used by JS OOP.</li>
</ul>
<h2 id="Pure-Functions"><a href="#Pure-Functions" class="headerlink" title="Pure Functions"></a>Pure Functions</h2><blockquote>
<p>A pure function is a function that, given the same input, will always return the same output and does not have any observable side effect.</p>
</blockquote>
<h3 id="Don’t-mutate-data"><a href="#Don’t-mutate-data" class="headerlink" title="Don’t mutate data"></a>Don’t mutate data</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xs = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// pure</span></span><br><span class="line">xs.slice(<span class="number">0</span>, <span class="number">3</span>) <span class="comment">// =&gt; [1, 2, 3]</span></span><br><span class="line">xs.slice(<span class="number">0</span>, <span class="number">3</span>) <span class="comment">// =&gt; [1, 2, 3]</span></span><br><span class="line">xs.slice(<span class="number">0</span>, <span class="number">3</span>) <span class="comment">// =&gt; [1, 2, 3]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// impure</span></span><br><span class="line">xs.splice(<span class="number">0</span>, <span class="number">3</span>) <span class="comment">//=&gt; [1, 2, 3]</span></span><br><span class="line">xs.splice(<span class="number">0</span>, <span class="number">3</span>) <span class="comment">//=&gt; [4, 5]</span></span><br><span class="line">xs.splice(<span class="number">0</span>, <span class="number">3</span>) <span class="comment">//=&gt; []</span></span><br></pre></td></tr></table></figure>
<h3 id="Don’t-depend-on-mutable-data-or-system-state"><a href="#Don’t-depend-on-mutable-data-or-system-state" class="headerlink" title="Don’t depend on mutable data or system state"></a>Don’t depend on mutable data or system state</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// impure</span></span><br><span class="line"><span class="keyword">var</span> minimum = <span class="number">21</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> checkAge = <span class="function"><span class="keyword">function</span>(<span class="params">age</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> age &gt;= minimum</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// pure</span></span><br><span class="line"><span class="keyword">var</span> checkAge = <span class="function"><span class="keyword">function</span>(<span class="params">age</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> minimum = <span class="number">21</span></span><br><span class="line">  <span class="keyword">return</span> age &gt;= minimum</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>A side effect is a change of system state or observable interaction with the outside world that occurs during the calculation of a result.</p>
</blockquote>
<p>Side effects may include, but are not limited to:</p>
<ul>
<li>changing the file system</li>
<li>inserting a record into a database</li>
<li>making an http call</li>
<li>mutations</li>
<li>printing to the screen / logging</li>
<li>obtaining user input</li>
<li>querying the DOM</li>
<li>accessing system state</li>
</ul>
<p>Side effects disqualify a function from being pure. And it makes sense: pure functions, by definition, must always return the same output given the same input, which is not possible to guarantee when dealing with matters outside our local function.</p>
<blockquote>
<p>A function is a special relationship between values: Each of its input values gives back exactly one output value.</p>
</blockquote>
<p>Here comes the dramatic reveal: <code>Pure functions are mathematical functions</code> and they’re what functional programming is all about. Programming with these little angels can provide huge benefits. Let’s look at some reasons why we’re willing to go to great lengths to preserve purity.</p>
<h3 id="Cacheable"><a href="#Cacheable" class="headerlink" title="Cacheable"></a>Cacheable</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> squareNumber = memoize(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x * x</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">squareNumber(<span class="number">4</span>)</span><br><span class="line"><span class="comment">//=&gt; 16</span></span><br><span class="line"></span><br><span class="line">squareNumber(<span class="number">4</span>) <span class="comment">// returns cache for input 4</span></span><br><span class="line"><span class="comment">//=&gt; 16</span></span><br></pre></td></tr></table></figure>
<p>Transform impure to pure</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> pureHttpCall = memoize(<span class="function"><span class="keyword">function</span>(<span class="params">url, params</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $.getJSON(url, params)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Our memoize function works just fine, though it doesn’t cache the results of the http call, rather it caches the generated function.</p>
<p>This is not very useful yet, but we’ll soon learn some tricks that will make it so. The takeaway is that we can cache every function no matter how destructive they seem.</p>
<h3 id="Self-Documenting"><a href="#Self-Documenting" class="headerlink" title="Self-Documenting"></a>Self-Documenting</h3><p>A function’s dependencies are explicit and therefore easier to see and understand.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//impure</span></span><br><span class="line"><span class="keyword">var</span> signUp = <span class="function"><span class="keyword">function</span>(<span class="params">attrs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> user = saveUser(attrs)</span><br><span class="line">  welcomeUser(user)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> saveUser = <span class="function"><span class="keyword">function</span>(<span class="params">attrs</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> user = Db.save(attrs)</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> welcomeUser = <span class="function"><span class="keyword">function</span>(<span class="params">user</span>) </span>&#123;</span><br><span class="line">    Email(user, ...)</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//pure</span></span><br><span class="line"><span class="keyword">var</span> signUp = <span class="function"><span class="keyword">function</span>(<span class="params">Db, Email, attrs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> user = saveUser(Db, attrs)</span><br><span class="line">    welcomeUser(Email, user)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> saveUser = <span class="function"><span class="keyword">function</span>(<span class="params">Db, attrs</span>) </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> welcomeUser = <span class="function"><span class="keyword">function</span>(<span class="params">Email, user</span>) </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Portable"><a href="#Portable" class="headerlink" title="Portable"></a>Portable</h3><p>In a JavaScript setting, portability could mean serializing and sending functions over a socket. It could mean running all our app code in web workers. Portability is a powerful trait.</p>
<p>Contrary to “typical” methods and procedures in imperative programming rooted deep in their environment via state, dependencies, and available effects, pure functions can be run anywhere our hearts desire.</p>
<p>When was the last time you copied a method into a new app? One of my favorite quotes comes from Erlang creator, Joe Armstrong: “The problem with object-oriented languages is they’ve got all this implicit environment that they carry around with them. You wanted a banana but what you got was a gorilla holding the banana… and the entire jungle”.</p>
<h3 id="Testable"><a href="#Testable" class="headerlink" title="Testable"></a>Testable</h3><p>Next, we come to realize pure functions make testing much easier. We don’t have to mock a “real” payment gateway or setup and assert the state of the world after each test. We simply give the function input and assert output.</p>
<h3 id="Reasonable"><a href="#Reasonable" class="headerlink" title="Reasonable"></a>Reasonable</h3><p>Many believe the biggest win when working with pure functions is referential transparency. A spot of code is referentially transparent when it can be substituted for its evaluated value without changing the behavior of the program.</p>
<h3 id="Parallel-Code"><a href="#Parallel-Code" class="headerlink" title="Parallel Code"></a>Parallel Code</h3><p>We can run any pure function in parallel since it does not need access to shared memory and it cannot, by definition, have a race condition due to some side effect.</p>
<p>This is very much possible in a server side js environment with threads as well as in the browser with web workers though current culture seems to avoid it due to complexity when dealing with impure functions.</p>
<h3 id="Summary-1"><a href="#Summary-1" class="headerlink" title="Summary"></a>Summary</h3><p>We’ve seen what pure functions are and why we think they’re good. From this point on, we’ll strive to write all our functions in a pure way. We’ll require some extra tools to help us do so, but in the meantime, we’ll try to separate the impure functions from the rest of the pure code.</p>
<p>Writing programs with pure functions is a tad laborious without some extra tools in our belt. We have to juggle data by passing arguments all over the place, we’re forbidden to use state, not to mention effects. How does one go about writing these masochistic programs? Let’s acquire a new tool called curry.</p>
<h2 id="Currying"><a href="#Currying" class="headerlink" title="Currying"></a>Currying</h2><blockquote>
<p>The concept is simple: You can call a function with fewer arguments than it expects. It returns a function that takes the remaining arguments.</p>
</blockquote>
<p>Let’s set up a few curried functions…</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> curry = <span class="built_in">require</span>(<span class="string">'lodash/curry'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> match = curry(<span class="function"><span class="keyword">function</span>(<span class="params">what, str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> str.match(what)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> replace = curry(<span class="function"><span class="keyword">function</span>(<span class="params">what, replacement, str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> str.replace(what, replacement)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> filter = curry(<span class="function"><span class="keyword">function</span>(<span class="params">f, ary</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> ary.filter(f)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> map = curry(<span class="function"><span class="keyword">function</span>(<span class="params">f, ary</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> ary.map(f)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>The pattern I’ve followed is a simple, but important one. I’ve strategically positioned the data we’re operating on (String, Array) as the last argument. It will become clear as to why upon use.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">match(<span class="regexp">/\s+/g</span>, <span class="string">'hello world'</span>)</span><br><span class="line"><span class="comment">// [ ' ' ]</span></span><br><span class="line"></span><br><span class="line">match(<span class="regexp">/\s+/g</span>)(<span class="string">'hello world'</span>)</span><br><span class="line"><span class="comment">// [ ' ' ]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> hasSpaces = match(<span class="regexp">/\s+/g</span>)</span><br><span class="line"><span class="comment">// function(x) &#123; return x.match(/\s+/g) &#125;</span></span><br><span class="line"></span><br><span class="line">hasSpaces(<span class="string">'hello world'</span>)</span><br><span class="line"><span class="comment">// [ ' ' ]</span></span><br><span class="line"></span><br><span class="line">hasSpaces(<span class="string">'spaceless'</span>)</span><br><span class="line"><span class="comment">// null</span></span><br><span class="line"></span><br><span class="line">filter(hasSpaces, [<span class="string">'tori_spelling'</span>, <span class="string">'tori amos'</span>])</span><br><span class="line"><span class="comment">// ['tori amos']</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> findSpaces = filter(hasSpaces)</span><br><span class="line"><span class="comment">// function(xs) &#123; return xs.filter(function(x) &#123; return x.match(/\s+/g) &#125;) &#125;</span></span><br><span class="line"></span><br><span class="line">findSpaces([<span class="string">'tori_spelling'</span>, <span class="string">'tori amos'</span>])</span><br><span class="line"><span class="comment">// ['tori amos']</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> noVowels = replace(<span class="regexp">/[aeiouy]/ig</span>)</span><br><span class="line"><span class="comment">// function(replacement, x) &#123; return x.replace(/[aeiouy]/ig, replacement) &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> censored = noVowels(<span class="string">"*"</span>)</span><br><span class="line"><span class="comment">// function(x) &#123; return x.replace(/[aeiouy]/ig, '*') &#125;</span></span><br><span class="line"></span><br><span class="line">censored(<span class="string">'Chocolate Rain'</span>)</span><br><span class="line"><span class="comment">// 'Ch*c*l*t* R**n'</span></span><br></pre></td></tr></table></figure>
<p>Currying is useful for many things. We can make new functions just by giving our base functions some arguments as seen in <code>hasSpaces</code>, <code>findSpaces</code>, and <code>censored</code>.</p>
<p>We also have the ability to transform any function that works on single elements into a function that works on arrays simply by wrapping it with <code>map</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> getChildren = <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x.childNodes</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> allTheChildren = map(getChildren)</span><br></pre></td></tr></table></figure>
<p>Giving a function fewer arguments than it expects is typically called <code>partial application</code>. Partially applying a function can remove a lot of boiler plate code. Consider what the above allTheChildren function would be with the uncurried <code>map</code> from lodash (note the arguments are in a different order):</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> allTheChildren = <span class="function"><span class="keyword">function</span>(<span class="params">elements</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> _.map(elements, getChildren)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We typically don’t define functions that work on arrays, because we can just call <code>map(getChildren)</code> inline. Same with <code>sort</code>, <code>filter</code>, and other higher order functions.</p>
<blockquote>
<p>Higher order function: A function that takes or returns a function.</p>
</blockquote>
<p>When we spoke about pure functions, we said they take 1 input to 1 output. Currying does exactly this: each single argument returns a new function expecting the remaining arguments. That is 1 input to 1 output.</p>
<p>No matter if the output is another function - it qualifies as pure. We do allow more than one argument at a time, but this is seen as merely removing the extra ()’s for convenience.</p>
<h3 id="Summary-2"><a href="#Summary-2" class="headerlink" title="Summary"></a>Summary</h3><p>Currying is handy and is used on a daily basis. It is a tool for the belt that makes FP less verbose and tedious. We can make new, useful functions on the fly simply by passing in a few arguments and as a bonus, we’ve retained the mathematical function definition despite multiple arguments.</p>
<h3 id="Exercises"><a href="#Exercises" class="headerlink" title="Exercises"></a>Exercises</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _ = <span class="built_in">require</span>(<span class="string">'ramda'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Exercise 1</span></span><br><span class="line"><span class="comment">// Refactor to remove all arguments by partially applying the function.</span></span><br><span class="line"><span class="keyword">var</span> words = <span class="function"><span class="keyword">function</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> _.split(<span class="string">' '</span>, str)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Exercise 1a</span></span><br><span class="line"><span class="comment">// Use map to make a new words fn that works on an array of strings.</span></span><br><span class="line"><span class="keyword">var</span> sentences = <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Exercise 2</span></span><br><span class="line"><span class="comment">// Refactor to remove all arguments by partially applying the functions.</span></span><br><span class="line"><span class="keyword">var</span> filterQs = <span class="function"><span class="keyword">function</span>(<span class="params">xs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> _.filter(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> match(<span class="regexp">/q/i</span>, x)</span><br><span class="line">  &#125;, xs)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Exercise 3</span></span><br><span class="line"><span class="comment">// Refactor max to not reference any arguments.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// leave this</span></span><br><span class="line"><span class="keyword">var</span> _keepHighest = <span class="function"><span class="keyword">function</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x &gt;= y ? x : y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// REFACTOR</span></span><br><span class="line"><span class="keyword">var</span> max = <span class="function"><span class="keyword">function</span>(<span class="params">xs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> _.reduce(<span class="function"><span class="keyword">function</span>(<span class="params">acc, x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> _keepHighest(acc, x)</span><br><span class="line">  &#125;, -<span class="literal">Infinity</span>, xs)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Bonus 1:</span></span><br><span class="line"><span class="comment">// Wrap array's slice to be functional and curried.</span></span><br><span class="line"><span class="comment">// //[1, 2, 3].slice(0, 2)</span></span><br><span class="line"><span class="keyword">var</span> slice = <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Bonus 2:</span></span><br><span class="line"><span class="comment">// Use slice to define a function "take" that takes n elements from the</span></span><br><span class="line"><span class="comment">// beginning of the string. Make it curried.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Result for "Something" with n=4 should be "Some"</span></span><br><span class="line"><span class="keyword">var</span> take = <span class="literal">undefined</span></span><br></pre></td></tr></table></figure>
<h3 id="Answers"><a href="#Answers" class="headerlink" title="Answers"></a>Answers</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// import functional tools like curry, map, filter, etc.</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./support'</span></span><br><span class="line"><span class="keyword">var</span> words = split(<span class="string">' '</span>)</span><br><span class="line"><span class="keyword">var</span> sentences = map(words)</span><br><span class="line"><span class="keyword">var</span> filterQs = filter(match(<span class="regexp">/q/i</span>))</span><br><span class="line"><span class="keyword">var</span> max = reduce(_keepHighest, -<span class="literal">Infinity</span>)</span><br><span class="line"><span class="keyword">var</span> slice = curry(<span class="function">(<span class="params">start, end, xs</span>) =&gt;</span> xs.slice(start, end))</span><br><span class="line"><span class="keyword">var</span> take = slice(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">words(<span class="string">'a test'</span>)                               <span class="comment">// [ 'a', 'test' ]</span></span><br><span class="line">sentences([ <span class="string">'a test'</span>, <span class="string">'a test'</span>, <span class="string">'a test'</span>, ])  <span class="comment">// [ [ 'a', 'test' ], [ 'a', 'test' ], [ 'a', 'test' ] ]</span></span><br><span class="line">filterQs([<span class="string">'quiet'</span>, <span class="string">'now'</span>])                    <span class="comment">// [ 'quiet' ]</span></span><br><span class="line">max([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>])                                <span class="comment">// 4</span></span><br><span class="line">slice(<span class="number">0</span>, <span class="number">4</span>, <span class="string">'funkalicious'</span>)                   <span class="comment">// funk</span></span><br><span class="line">take(<span class="number">4</span>, <span class="string">'funkalicious'</span>)                       <span class="comment">// funk</span></span><br></pre></td></tr></table></figure>
<h2 id="Composing"><a href="#Composing" class="headerlink" title="Composing"></a>Composing</h2><blockquote>
<p>The composition of two functions returns a new function. This makes perfect sense: composing two units of some type (in this case function) should yield a new unit of that very type.</p>
</blockquote>
<h3 id="Simple-compose"><a href="#Simple-compose" class="headerlink" title="Simple compose"></a>Simple compose</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> compose = <span class="function"><span class="keyword">function</span>(<span class="params">f, g</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> f(g(x))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> toUpperCase = <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x.toUpperCase()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> exclaim = <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + <span class="string">'!'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ignorant</span></span><br><span class="line"><span class="comment">// less readable than the enlightened version</span></span><br><span class="line"><span class="keyword">var</span> shout = <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> exclaim(toUpperCase(x))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// enlightened</span></span><br><span class="line"><span class="keyword">var</span> shout = compose(exclaim, toUpperCase)</span><br><span class="line"></span><br><span class="line">shout(<span class="string">"send in the clowns"</span>)</span><br><span class="line"><span class="comment">//=&gt; "SEND IN THE CLOWNS!"</span></span><br></pre></td></tr></table></figure>
<h3 id="Associative"><a href="#Associative" class="headerlink" title="Associative"></a>Associative</h3><blockquote>
<p>Composition is associative, meaning it doesn’t matter how you group them. That allows us to write a <code>variadic compose</code>.  <br><br><code>compose(f, compose(g, h)) == compose(compose(f, g), h)</code></p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> head = <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x[<span class="number">0</span>]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> reverse = reduce(<span class="function"><span class="keyword">function</span>(<span class="params">acc, x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> [x].concat(acc)</span><br><span class="line">&#125;, [])</span><br><span class="line"><span class="keyword">var</span> last = compose(head, reverse)</span><br><span class="line"></span><br><span class="line">last([<span class="string">'jumpkick'</span>, <span class="string">'roundhouse'</span>, <span class="string">'uppercut'</span>])</span><br><span class="line"><span class="comment">//=&gt; 'uppercut'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// previously we'd have to write two composes, but since it's associative, we can</span></span><br><span class="line"><span class="comment">// give compose as many fn's as we like and let it decide how to group them.</span></span><br><span class="line"><span class="keyword">var</span> lastUpper = compose(toUpperCase, head, reverse)</span><br><span class="line"></span><br><span class="line">lastUpper([<span class="string">'jumpkick'</span>, <span class="string">'roundhouse'</span>, <span class="string">'uppercut'</span>])</span><br><span class="line"><span class="comment">//=&gt; 'UPPERCUT'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> loudLastUpper = compose(exclaim, toUpperCase, head, reverse)</span><br><span class="line"></span><br><span class="line">loudLastUpper([<span class="string">'jumpkick'</span>, <span class="string">'roundhouse'</span>, <span class="string">'uppercut'</span>])</span><br><span class="line"><span class="comment">//=&gt; 'UPPERCUT!'</span></span><br></pre></td></tr></table></figure>
<h3 id="Pointfree"><a href="#Pointfree" class="headerlink" title="Pointfree"></a>Pointfree</h3><blockquote>
<p>Pointfree style means never having to say your data. Excuse me. It means functions that never mention the data upon which they operate. First class functions, currying, and composition all play well together to create this style.</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//not pointfree because we mention the data: word</span></span><br><span class="line"><span class="keyword">var</span> snakeCase = <span class="function"><span class="keyword">function</span>(<span class="params">word</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> word.toLowerCase().replace(<span class="regexp">/\s+/ig</span>, <span class="string">'_'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//pointfree</span></span><br><span class="line"><span class="keyword">var</span> snakeCase = compose(replace(<span class="regexp">/\s+/ig</span>, <span class="string">'_'</span>), toLowerCase)</span><br></pre></td></tr></table></figure>
<p>See how we partially applied replace? What we’re doing is piping our data through each function of 1 argument. Currying allows us to prepare each function to just take its data, operate on it, and pass it along. Something else to notice is how we don’t need the data to construct our function in the pointfree version, whereas in the pointful one, we must have our <code>word</code> available before anything else.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//not pointfree because we mention the data: name</span></span><br><span class="line"><span class="keyword">var</span> initials = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> name.split(<span class="string">' '</span>).map(compose(toUpperCase, head)).join(<span class="string">'. '</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//pointfree</span></span><br><span class="line"><span class="keyword">var</span> initials = compose(join(<span class="string">'. '</span>), map(compose(toUpperCase, head)), split(<span class="string">' '</span>))</span><br><span class="line"></span><br><span class="line">initials(<span class="string">"hunter stockton thompson"</span>)</span><br><span class="line"><span class="comment">// 'H. S. T'</span></span><br></pre></td></tr></table></figure>
<p>Pointfree code can again, help us remove needless names and keep us concise and generic. Pointfree is a good litmus test for functional code as it lets us know we’ve got small functions that take input to output. One can’t compose a while loop, for instance. Be warned, however, pointfree is a double-edged sword and can sometimes obfuscate intention. Not all functional code is pointfree and that is O.K. We’ll shoot for it where we can and stick with normal functions otherwise.</p>
<h3 id="Debugging"><a href="#Debugging" class="headerlink" title="Debugging"></a>Debugging</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* THE UTILITY */</span></span><br><span class="line"><span class="keyword">var</span> trace = curry(<span class="function"><span class="keyword">function</span>(<span class="params">tag, x</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(tag, x)</span><br><span class="line">  <span class="keyword">return</span> x</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// BROKEN</span></span><br><span class="line"><span class="comment">// Cryptic Error: Cannot read property 'apply' of undefined</span></span><br><span class="line"><span class="keyword">var</span> dasherize = compose(</span><br><span class="line">  join(<span class="string">'-'</span>),</span><br><span class="line">  toLower,</span><br><span class="line">  split(<span class="string">' '</span>),</span><br><span class="line">  replace(<span class="regexp">/\s&#123;2,&#125;/ig</span>, <span class="string">' '</span>)</span><br><span class="line">)</span><br><span class="line">dasherize(<span class="string">'The world is a vampire'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// THE DEBUG</span></span><br><span class="line"><span class="comment">// trace utility shows that split is working</span></span><br><span class="line"><span class="comment">// PROBLEM: toLower cannot take an array</span></span><br><span class="line"><span class="keyword">var</span> dasherize = compose(</span><br><span class="line">  join(<span class="string">'-'</span>),</span><br><span class="line">  toLower,</span><br><span class="line">  trace(<span class="string">'after split'</span>),</span><br><span class="line">  split(<span class="string">' '</span>),</span><br><span class="line">  replace(<span class="regexp">/\s&#123;2,&#125;/ig</span>, <span class="string">' '</span>)</span><br><span class="line">)</span><br><span class="line"><span class="comment">// TRACE: after split [ 'The', 'world', 'is', 'a', 'vampire' ]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// THE FIX: put map around toLower</span></span><br><span class="line"><span class="keyword">var</span> dasherize = compose(join(<span class="string">'-'</span>), map(toLower), split(<span class="string">' '</span>), replace(<span class="regexp">/\s&#123;2,&#125;/ig</span>, <span class="string">' '</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// OUTPUT: 'the-world-is-a-vampire'</span></span><br></pre></td></tr></table></figure>
<h3 id="Category-Theory"><a href="#Category-Theory" class="headerlink" title="Category Theory"></a>Category Theory</h3><blockquote>
<p>Category theory is an abstract branch of mathematics that can formalize concepts from several different branches such as <code>set theory</code>, <code>type theory</code>, <code>group theory</code>, <code>logic</code>, and more. It primarily deals with <code>objects</code>, <code>morphisms</code>, and <code>transformations</code>, which mirrors programming quite closely.</p>
</blockquote>
<p>In category theory, we have something called… a category. It is defined as a collection with the following:</p>
<ul>
<li><p>A collection of objects<br>The objects will be data types. For instance, String, Boolean, Number, Object, etc. We often view data types as sets of all the possible values.</p>
</li>
<li><p>A collection of morphisms<br>pure fn</p>
</li>
<li><p>A notion of composition on the morphisms<br>compose</p>
</li>
<li><p>A distinguished morphism called identity<br>id = (x) =&gt; x</p>
</li>
</ul>
<p>I expect this to be a little fuzzy at this point it will become more clear later.  For now it provides a drop of wisdom regarding composition - namely, the associativity and identity properties. We have sufficiently skimmed the surface and must move on.</p>
<h3 id="Summary-3"><a href="#Summary-3" class="headerlink" title="Summary"></a>Summary</h3><p>Composition connects our functions together like a series of pipes.  We hold composition as a design principle above all others. This is because it keeps our app simple and reasonable. Category theory will play a big part in app architecture, modeling side effects, and ensuring correctness.</p>
<h3 id="Exercises-1"><a href="#Exercises-1" class="headerlink" title="Exercises"></a>Exercises</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Example Data</span></span><br><span class="line"><span class="keyword">var</span> CARS = [</span><br><span class="line">  &#123;<span class="attr">name</span>: <span class="string">"Ferrari FF"</span>, <span class="attr">horsepower</span>: <span class="number">660</span>, <span class="attr">dollar_value</span>: <span class="number">700000</span>, <span class="attr">in_stock</span>: <span class="literal">true</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">name</span>: <span class="string">"Spyker C12 Zagato"</span>, <span class="attr">horsepower</span>: <span class="number">650</span>, <span class="attr">dollar_value</span>: <span class="number">648000</span>, <span class="attr">in_stock</span>: <span class="literal">false</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">name</span>: <span class="string">"Jaguar XKR-S"</span>, <span class="attr">horsepower</span>: <span class="number">550</span>, <span class="attr">dollar_value</span>: <span class="number">132000</span>, <span class="attr">in_stock</span>: <span class="literal">false</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">name</span>: <span class="string">"Audi R8"</span>, <span class="attr">horsepower</span>: <span class="number">525</span>, <span class="attr">dollar_value</span>: <span class="number">114200</span>, <span class="attr">in_stock</span>: <span class="literal">false</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">name</span>: <span class="string">"Aston Martin One-77"</span>, <span class="attr">horsepower</span>: <span class="number">750</span>, <span class="attr">dollar_value</span>: <span class="number">1850000</span>, <span class="attr">in_stock</span>: <span class="literal">true</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">name</span>: <span class="string">"Pagani Huayra"</span>, <span class="attr">horsepower</span>: <span class="number">700</span>, <span class="attr">dollar_value</span>: <span class="number">1300000</span>, <span class="attr">in_stock</span>: <span class="literal">false</span>&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">// Exercise 1:</span></span><br><span class="line"><span class="comment">// Use _.compose() to rewrite the function below. Hint: _.prop() is curried.</span></span><br><span class="line"><span class="keyword">var</span> isLastInStock = <span class="function"><span class="keyword">function</span>(<span class="params">cars</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> last_car = _.last(cars)</span><br><span class="line">  <span class="keyword">return</span> _.prop(<span class="string">'in_stock'</span>, last_car)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Exercise 2:</span></span><br><span class="line"><span class="comment">// Use _.compose(), _.prop() and _.head() to retrieve the name of the first car.</span></span><br><span class="line"><span class="keyword">var</span> nameOfFirstCar = <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Exercise 3:</span></span><br><span class="line"><span class="comment">// Use the helper function _average to refactor averageDollarValue as a composition.</span></span><br><span class="line"><span class="keyword">var</span> _average = <span class="function"><span class="keyword">function</span>(<span class="params">xs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> _.reduce(_.add, <span class="number">0</span>, xs) / xs.length</span><br><span class="line">&#125; <span class="comment">// &lt;- leave be</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> averageDollarValue = <span class="function"><span class="keyword">function</span>(<span class="params">cars</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> dollar_values = _.map(<span class="function"><span class="keyword">function</span>(<span class="params">c</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> c.dollar_value</span><br><span class="line">  &#125;, cars)</span><br><span class="line">  <span class="keyword">return</span> _average(dollar_values)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Exercise 4:</span></span><br><span class="line"><span class="comment">// Write a function: sanitizeNames() using compose that returns a list of lowercase and underscored car's names: e.g: sanitizeNames([&#123;name: 'Ferrari FF', horsepower: 660, dollar_value: 700000, in_stock: true&#125;]) //=&gt; ['ferrari_ff'].</span></span><br><span class="line"><span class="keyword">var</span> _underscore = _.replace(<span class="regexp">/\W+/g</span>, <span class="string">'_'</span>) <span class="comment">//&lt;-- leave this alone and use to sanitize</span></span><br><span class="line"><span class="keyword">var</span> sanitizeNames = <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Bonus 1:</span></span><br><span class="line"><span class="comment">// Refactor availablePrices with compose.</span></span><br><span class="line"><span class="keyword">var</span> availablePrices = <span class="function"><span class="keyword">function</span>(<span class="params">cars</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> available_cars = _.filter(_.prop(<span class="string">'in_stock'</span>), cars)</span><br><span class="line">  <span class="keyword">return</span> available_cars.map(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> accounting.formatMoney(x.dollar_value)</span><br><span class="line">  &#125;).join(<span class="string">', '</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Bonus 2:</span></span><br><span class="line"><span class="comment">// Refactor to pointfree. Hint: you can use _.flip().</span></span><br><span class="line"><span class="keyword">var</span> fastestCar = <span class="function"><span class="keyword">function</span>(<span class="params">cars</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> sorted = _.sortBy(<span class="function"><span class="keyword">function</span>(<span class="params">car</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> car.horsepower</span><br><span class="line">  &#125;, cars)</span><br><span class="line">  <span class="keyword">var</span> fastest = _.last(sorted)</span><br><span class="line">  <span class="keyword">return</span> fastest.name + <span class="string">' is the fastest'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Answers-1"><a href="#Answers-1" class="headerlink" title="Answers"></a>Answers</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">'./support'</span>)</span><br><span class="line"><span class="keyword">const</span> _ = <span class="built_in">require</span>(<span class="string">'ramda'</span>)</span><br><span class="line"><span class="keyword">const</span> accounting = <span class="built_in">require</span>(<span class="string">'accounting'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> CARS = [</span><br><span class="line">  &#123;<span class="attr">name</span>: <span class="string">"Ferrari FF"</span>, <span class="attr">horsepower</span>: <span class="number">660</span>, <span class="attr">dollar_value</span>: <span class="number">700000</span>, <span class="attr">in_stock</span>: <span class="literal">true</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">name</span>: <span class="string">"Spyker C12 Zagato"</span>, <span class="attr">horsepower</span>: <span class="number">650</span>, <span class="attr">dollar_value</span>: <span class="number">648000</span>, <span class="attr">in_stock</span>: <span class="literal">false</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">name</span>: <span class="string">"Jaguar XKR-S"</span>, <span class="attr">horsepower</span>: <span class="number">550</span>, <span class="attr">dollar_value</span>: <span class="number">132000</span>, <span class="attr">in_stock</span>: <span class="literal">false</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">name</span>: <span class="string">"Audi R8"</span>, <span class="attr">horsepower</span>: <span class="number">525</span>, <span class="attr">dollar_value</span>: <span class="number">114200</span>, <span class="attr">in_stock</span>: <span class="literal">false</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">name</span>: <span class="string">"Aston Martin One-77"</span>, <span class="attr">horsepower</span>: <span class="number">750</span>, <span class="attr">dollar_value</span>: <span class="number">1850000</span>, <span class="attr">in_stock</span>: <span class="literal">true</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">name</span>: <span class="string">"Pagani Huayra"</span>, <span class="attr">horsepower</span>: <span class="number">700</span>, <span class="attr">dollar_value</span>: <span class="number">1300000</span>, <span class="attr">in_stock</span>: <span class="literal">false</span>&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> isLastInStock = compose(_.prop(<span class="string">'in_stock'</span>), _.last)</span><br><span class="line"><span class="keyword">var</span> nameOfFirstCar = compose(_.prop(<span class="string">'name'</span>), _.head)</span><br><span class="line"><span class="keyword">var</span> _average = <span class="function"><span class="keyword">function</span>(<span class="params">xs</span>) </span>&#123; <span class="keyword">return</span> reduce(add, <span class="number">0</span>, xs) / xs.length &#125;</span><br><span class="line"><span class="keyword">var</span> averageDollarValue = compose(_average, map(_.prop(<span class="string">'dollar_value'</span>)))</span><br><span class="line"><span class="keyword">var</span> _underscore = replace(<span class="regexp">/\W+/g</span>, <span class="string">'_'</span>)</span><br><span class="line"><span class="keyword">var</span> sanitizeNames = map(compose(_underscore, toLowerCase, _.prop(<span class="string">'name'</span>)))</span><br><span class="line"><span class="keyword">var</span> formatPrice = compose( accounting.formatMoney, _.prop(<span class="string">'dollar_value'</span>))</span><br><span class="line"><span class="keyword">var</span> availablePrices = compose( join(<span class="string">', '</span>), map(formatPrice), filter(_.prop(<span class="string">'in_stock'</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment">//+ fastestCar :: [Car] -&gt; String</span></span><br><span class="line"><span class="keyword">var</span> append = _.flip(_.concat)</span><br><span class="line"><span class="keyword">var</span> fastestCar = compose(append(<span class="string">' is the fastest'</span>),</span><br><span class="line">                           _.prop(<span class="string">'name'</span>),</span><br><span class="line">                           _.last,</span><br><span class="line">                           _.sortBy(_.prop(<span class="string">'horsepower'</span>)))</span><br><span class="line"></span><br><span class="line">isLastInStock(CARS)           <span class="comment">// false</span></span><br><span class="line">nameOfFirstCar(CARS)          <span class="comment">// Ferrari FF</span></span><br><span class="line">averageDollarValue(CARS)      <span class="comment">// 790700</span></span><br><span class="line">sanitizeNames(CARS)           <span class="comment">// [ 'ferrari_ff', ...</span></span><br><span class="line">availablePrices(CARS)         <span class="comment">// $700,000.00, $1,850,000.00</span></span><br><span class="line">fastestCar(CARS)              <span class="comment">// Aston Martin One-77 is the fastest</span></span><br></pre></td></tr></table></figure>
<h2 id="Example-Application"><a href="#Example-Application" class="headerlink" title="Example Application"></a>Example Application</h2><h3 id="Declarative-Coding"><a href="#Declarative-Coding" class="headerlink" title="Declarative Coding"></a>Declarative Coding</h3><p>We are going to switch our mindset. From here on out, we’ll stop telling the computer how to do its job and instead write a specification of what we’d like as a result. I’m sure you’ll find it much less stressful than trying to micromanage everything all the time.</p>
<blockquote>
<p>Declarative, as opposed to imperative, means that we will write expressions, as opposed to step by step instructions. Think of SQL. There is no “first do this, then do that”. There is one expression that specifies what we’d like from the database.</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// imperative</span></span><br><span class="line"><span class="keyword">var</span> makes = []</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span> i &lt; cars.length i++) &#123;</span><br><span class="line">  makes.push(cars[i].make)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// declarative</span></span><br><span class="line"><span class="keyword">var</span> makes = cars.map(<span class="function">(<span class="params">car</span>) =&gt;</span> car.make)</span><br></pre></td></tr></table></figure>
<p>It specifies what, not how. Thus, it wears the shiny declarative sash.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// imperative</span></span><br><span class="line"><span class="keyword">var</span> authenticate = <span class="function"><span class="keyword">function</span>(<span class="params">form</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> user = toUser(form)</span><br><span class="line">  <span class="keyword">return</span> logIn(user)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// declarative</span></span><br><span class="line"><span class="keyword">var</span> authenticate = compose(logIn, toUser)</span><br></pre></td></tr></table></figure>
<p>This leaves wiggle room for support code changes (different params for toUser) and results in our application code being a high level specification.</p>
<p>Because we are not encoding order of evaluation, declarative coding lends itself to parallel computing. This coupled with pure functions is why FP is a good option for the parallel future</p>
<h3 id="A-flickr-of-functional-programming"><a href="#A-flickr-of-functional-programming" class="headerlink" title="A flickr of functional programming"></a>A flickr of functional programming</h3><p>We will now build an example application in a declarative, composable way. We’ll still cheat and use side effects for now, but we’ll keep them minimal and separate from our pure codebase. We are going to build a browser widget that sucks in flickr images and displays them. Let’s start by scaffolding the app. Here’s the html:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.11/require.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"flickr.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">requirejs.config(&#123;</span><br><span class="line">  paths: &#123;</span><br><span class="line">    ramda: <span class="string">'https://cdnjs.cloudflare.com/ajax/libs/ramda/0.13.0/ramda.min'</span>,</span><br><span class="line">    jquery: <span class="string">'https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min'</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>([</span><br><span class="line">    <span class="string">'ramda'</span>,</span><br><span class="line">    <span class="string">'jquery'</span>,</span><br><span class="line">  ],</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">_, $</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> trace = _.curry(<span class="function"><span class="keyword">function</span>(<span class="params">tag, x</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(tag, x)</span><br><span class="line">      <span class="keyword">return</span> x</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// app goes here</span></span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<p>We’re pulling in <code>ramda</code> instead of <code>lodash</code> or some other utility library. It includes <code>compose</code>, <code>curry</code>, and more. I’ve used <code>requirejs</code>, which may seem like overkill, but we’ll be using it throughout and consistency is key. Also, I’ve started us off with our nice <code>trace</code> function for easy debugging.</p>
<p>Now that that’s out of the way, on to the spec. Our app will do 4 things.</p>
<ul>
<li>Construct a url for our particular search term</li>
<li>Make the flickr api call</li>
<li>Transform the resulting json into html images</li>
<li>Place them on the screen</li>
</ul>
<p>There are 2 impure actions mentioned above. Do you see them? Those bits about getting data from the flickr api and placing it on the screen. Let’s define those first so we can quarantine them.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Impure = &#123;</span><br><span class="line">  getJSON: _.curry(<span class="function"><span class="keyword">function</span>(<span class="params">callback, url</span>) </span>&#123;</span><br><span class="line">    $.getJSON(url, callback)</span><br><span class="line">  &#125;),</span><br><span class="line"></span><br><span class="line">  setHtml: _.curry(<span class="function"><span class="keyword">function</span>(<span class="params">sel, html</span>) </span>&#123;</span><br><span class="line">    $(sel).html(html)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Here we’ve simply wrapped jQuery’s methods to be curried and we’ve swapped the arguments to a more favorable position. I’ve namespaced them with Impure so we know these are dangerous functions. In a future example, we will make these two functions pure.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> url = <span class="function"><span class="keyword">function</span>(<span class="params">term</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'https://api.flickr.com/services/feeds/photos_public.gne?tags='</span> +</span><br><span class="line">    term + <span class="string">'&amp;format=json&amp;jsoncallback=?'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>There are fancy and overly complex ways of writing url pointfree using monoids(we’ll learn about these later) or combinators. We’ve chosen to stick with a readable version and assemble this string in the normal pointful fashion.</p>
<p>Let’s write an app function that makes the call and places the contents on the screen.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = _.compose(Impure.getJSON(trace(<span class="string">'response'</span>)), url)</span><br><span class="line"></span><br><span class="line">app(<span class="string">'picasso'</span>)</span><br></pre></td></tr></table></figure>
<p>Loading the app will show the response from the api call in the console.</p>
<figure class="highlight json"><figcaption><span>json response</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"title"</span>: <span class="string">"Recent Uploads tagged cats"</span>,</span><br><span class="line">  <span class="attr">"link"</span>: <span class="string">"https://www.flickr.com/photos/tags/cats/"</span>,</span><br><span class="line">  <span class="attr">"description"</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="attr">"modified"</span>: <span class="string">"2016-08-09T16:18:19Z"</span>,</span><br><span class="line">  <span class="attr">"generator"</span>: <span class="string">"https://www.flickr.com/"</span>,</span><br><span class="line">  <span class="attr">"items"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="attr">"title"</span>: <span class="string">"This little one followed our friend home and now she’s ours we just need a name! via http://ift.tt/29KELz0"</span>,</span><br><span class="line">    <span class="attr">"link"</span>: <span class="string">"https://www.flickr.com/photos/dozhub/28873505605/"</span>,</span><br><span class="line">    <span class="attr">"media"</span>: &#123;<span class="attr">"m"</span>:<span class="string">"https://farm8.staticflickr.com/7571/28873505605_0f1bf96d9d_m.jpg"</span>&#125;,</span><br><span class="line">    <span class="attr">"date_taken"</span>: <span class="string">"2016-08-09T09:18:19-08:00"</span>,</span><br><span class="line">    <span class="attr">"description"</span>: <span class="string">" &lt;p&gt;&lt;a href=\"https://www.flickr.com/people/dozhub/\"&gt;dozhub&lt;\/a&gt; posted a photo:&lt;\/p&gt; &lt;p&gt;&lt;a href=\"https://www.flickr.com/photos/dozhub/28873505605/\" title=\"This little one followed our friend home and now she’s ours we just need a name! via http://ift.tt/29KELz0\"&gt;&lt;img src=\"https://farm8.staticflickr.com/7571/28873505605_0f1bf96d9d_m.jpg\" width=\"240\" height=\"126\" alt=\"This little one followed our friend home and now she’s ours we just need a name! via http://ift.tt/29KELz0\" /&gt;&lt;\/a&gt;&lt;\/p&gt; &lt;p&gt;This little one followed our friend home and now she’s ours we just need a name! -&lt;br /&gt; &lt;br /&gt; This little one followed our friend home and now she’s ours we just need a name! – Cats, kittens and kittys, cute and adorable! Aww! (via &lt;a href=\"http://ift.tt/29KELz0\" rel=\"nofollow\"&gt;ift.tt/29KELz0&lt;\/a&gt;)&lt;br /&gt; &lt;br /&gt; - via &lt;a href=\"http://ift.tt/29KELz0\" rel=\"nofollow\"&gt;ift.tt/29KELz0&lt;\/a&gt;. Cats, kittens and kittys, cute and adorable! Aww!&lt;\/p&gt;"</span>,</span><br><span class="line">    <span class="attr">"published"</span>: <span class="string">"2016-08-09T16:18:19Z"</span>,</span><br><span class="line">    <span class="attr">"author"</span>: <span class="string">"nobody@flickr.com (dozhub)"</span>,</span><br><span class="line">    <span class="attr">"author_id"</span>: <span class="string">"143919671@N07"</span>,</span><br><span class="line">    <span class="attr">"tags"</span>: <span class="string">"cat kitty kitten cute funny aww adorable cats"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    ...</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We’d like to construct images out of this json. It looks like the srcs are buried in <code>items</code> then each <code>media</code>‘s <code>m</code> property. To get at these nested properties we can use a nice universal getter function from <code>ramda</code> called <code>_.prop()</code>. Let’s use this to get at our srcs.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mediaUrl = _.compose(_.prop(<span class="string">'m'</span>), _.prop(<span class="string">'media'</span>))</span><br><span class="line"><span class="keyword">var</span> srcs = _.compose(_.map(mediaUrl), _.prop(<span class="string">'items'</span>))</span><br></pre></td></tr></table></figure>
<p>Once we gather the items, we must map over them to extract each media url.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> renderImages = _.compose(Impure.setHtml(<span class="string">'body'</span>), srcs)</span><br><span class="line"><span class="keyword">var</span> app = _.compose(Impure.getJSON(renderImages), url)</span><br></pre></td></tr></table></figure>
<p>All we’ve done is make a new composition that will call our srcs and set the body html with them. We’ve replaced the trace call with renderImages. This will crudely display our srcs directly in the body.</p>
<p>Our final step is to turn these srcs into bonafide images. In a bigger application, we’d use a template/dom library like Handlebars or React. For this application though, we only need an img tag so let’s stick with jQuery.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> img = <span class="function"><span class="keyword">function</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> $(<span class="string">'&lt;img /&gt;'</span>, &#123;</span><br><span class="line">    src: url</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>jQuery’s html() method will accept an array of tags. We only have to transform our srcs into images and send them along to setHtml.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> images = _.compose(_.map(img), srcs)</span><br><span class="line"><span class="keyword">var</span> renderImages = _.compose(Impure.setHtml(<span class="string">'body'</span>), images)</span><br><span class="line"><span class="keyword">var</span> app = _.compose(Impure.getJSON(renderImages), url)</span><br><span class="line"></span><br><span class="line">app(<span class="string">'picasso'</span>)</span><br></pre></td></tr></table></figure>
<p>And we’re done!  Here’s the finished script.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">requirejs.config(&#123;</span><br><span class="line">  paths: &#123;</span><br><span class="line">    ramda: <span class="string">'https://cdnjs.cloudflare.com/ajax/libs/ramda/0.13.0/ramda.min'</span>,</span><br><span class="line">    jquery: <span class="string">'https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min'</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">require</span>([</span><br><span class="line">    <span class="string">'ramda'</span>,</span><br><span class="line">    <span class="string">'jquery'</span>,</span><br><span class="line">  ],</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">_, $</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> trace = _.curry(<span class="function"><span class="keyword">function</span>(<span class="params">tag, x</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(tag, x)</span><br><span class="line">      <span class="keyword">return</span> x</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> Impure = &#123;</span><br><span class="line">      getJSON: _.curry(<span class="function"><span class="keyword">function</span>(<span class="params">callback, url</span>) </span>&#123;</span><br><span class="line">        $.getJSON(url, callback)</span><br><span class="line">      &#125;),</span><br><span class="line">      setHtml: _.curry(<span class="function"><span class="keyword">function</span>(<span class="params">sel, html</span>) </span>&#123;</span><br><span class="line">        $(sel).html(html)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> url = <span class="function"><span class="keyword">function</span>(<span class="params">term</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">'https://api.flickr.com/services/feeds/photos_public.gne?tags='</span> +</span><br><span class="line">        term + <span class="string">'&amp;format=json&amp;jsoncallback=?'</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> mediaUrl = _.compose(_.prop(<span class="string">'m'</span>), _.prop(<span class="string">'media'</span>))</span><br><span class="line">    <span class="keyword">var</span> srcs = _.compose(_.map(mediaUrl), _.prop(<span class="string">'items'</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> img = <span class="function"><span class="keyword">function</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> $(<span class="string">'&lt;img /&gt;'</span>, &#123;</span><br><span class="line">        src: url</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> images = _.compose(_.map(img), srcs)</span><br><span class="line">    <span class="keyword">var</span> renderImages = _.compose(Impure.setHtml(<span class="string">'body'</span>), images)</span><br><span class="line">    <span class="keyword">var</span> app = _.compose(Impure.getJSON(renderImages), url)</span><br><span class="line"></span><br><span class="line">    app(<span class="string">'picasso'</span>)</span><br><span class="line"></span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<h3 id="A-Principled-Refactor"><a href="#A-Principled-Refactor" class="headerlink" title="A Principled Refactor"></a>A Principled Refactor</h3><p>There is an optimization available - we map over each item to turn it into a media url, then we map again over those srcs to turn them into img tags. There is a law regarding map and composition:</p>
<blockquote>
<p>map’s composition law<br><code>var law = compose(map(f), map(g)) === map(compose(f, g))</code></p>
</blockquote>
<p>Let’s refactor from original</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// original code</span></span><br><span class="line"><span class="keyword">var</span> mediaUrl = _.compose(_.prop(<span class="string">'m'</span>), _.prop(<span class="string">'media'</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> srcs = _.compose(_.map(mediaUrl), _.prop(<span class="string">'items'</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> images = _.compose(_.map(img), srcs)</span><br></pre></td></tr></table></figure>
<p>to this</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mediaUrl = _.compose(_.prop(<span class="string">'m'</span>), _.prop(<span class="string">'media'</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> images = _.compose(_.map(img), _.map(mediaUrl), _.prop(<span class="string">'items'</span>))</span><br></pre></td></tr></table></figure>
<p>to this</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mediaUrl = _.compose(_.prop(<span class="string">'m'</span>), _.prop(<span class="string">'media'</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> images = _.compose(_.map(_.compose(img, mediaUrl)), _.prop(<span class="string">'items'</span>))</span><br></pre></td></tr></table></figure>
<p>Let’s just make it a little more readable by extracting the function out.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mediaUrl = _.compose(_.prop(<span class="string">'m'</span>), _.prop(<span class="string">'media'</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mediaToImg = _.compose(img, mediaUrl)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> images = _.compose(_.map(mediaToImg), _.prop(<span class="string">'items'</span>))</span><br></pre></td></tr></table></figure>
<p>Now the bugger will only loop once while turning each item into an img.</p>
<h3 id="Summary-4"><a href="#Summary-4" class="headerlink" title="Summary"></a>Summary</h3><p>We have seen how to put our new skills into use with a small, but real world app. We’ve also used our mathematical framework to reason about and refactor our code.</p>
<h2 id="Hindley-Milner-Type-Signatures"><a href="#Hindley-Milner-Type-Signatures" class="headerlink" title="Hindley-Milner Type Signatures"></a>Hindley-Milner Type Signatures</h2><blockquote>
<p>Hindley-Milner Type Signatures: a comment that documents a function with type data</p>
</blockquote>
<p>Takes a string and returns a string.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  capitalize :: String -&gt; String</span></span><br><span class="line"><span class="keyword">var</span> capitalize = <span class="function"><span class="keyword">function</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> toUpperCase(head(s)) + toLowerCase(tail(s))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">capitalize(<span class="string">"smurf"</span>)</span><br><span class="line"><span class="comment">//=&gt; "Smurf"</span></span><br></pre></td></tr></table></figure>
<p>An example of handling arrays and currying.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  strLength :: String -&gt; Number</span></span><br><span class="line"><span class="keyword">var</span> strLength = <span class="function"><span class="keyword">function</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> s.length</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  join :: String -&gt; [String] -&gt; String</span></span><br><span class="line"><span class="keyword">var</span> join = curry(<span class="function"><span class="keyword">function</span>(<span class="params">what, xs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> xs.join(what)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//  match :: Regex -&gt; String -&gt; [String]</span></span><br><span class="line"><span class="keyword">var</span> match = curry(<span class="function"><span class="keyword">function</span>(<span class="params">reg, s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> s.match(reg)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//  replace :: Regex -&gt; String -&gt; String -&gt; String</span></span><br><span class="line"><span class="keyword">var</span> replace = curry(<span class="function"><span class="keyword">function</span>(<span class="params">reg, sub, s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> s.replace(reg, sub)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>An example of handling function parameters.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  id :: a -&gt; a</span></span><br><span class="line"><span class="keyword">var</span> id = <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  map :: (a -&gt; b) -&gt; [a] -&gt; [b]</span></span><br><span class="line"><span class="keyword">var</span> map = curry(<span class="function"><span class="keyword">function</span>(<span class="params">f, xs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> xs.map(f)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Let’s dissect the Hindley-Milner Type Signature of the <code>map</code> function:</p>
<table>
<thead>
<tr>
<th>about the map function</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>function name</td>
<td>// <code>map</code> :: (a -&gt; b) -&gt; [a] -&gt; [b]</td>
</tr>
<tr>
<td>2 parameters</td>
<td>// map :: <code>(a -&gt; b) -&gt; [a]</code> -&gt; [b]</td>
</tr>
<tr>
<td>return value</td>
<td>// map :: (a -&gt; b) -&gt; [a] -&gt; <code>[b]</code></td>
</tr>
</tbody>
</table>
<p>What else can we infer about that function parameter?</p>
<table>
<thead>
<tr>
<th>about the function parameter</th>
<th>// map :: <code>(a -&gt; b)</code> -&gt; [a] -&gt; [b]</th>
</tr>
</thead>
<tbody>
<tr>
<td>only parameter <code>a</code></td>
<td>is the same type as <code>[a]</code> items</td>
</tr>
<tr>
<td>return value <code>b</code></td>
<td>is the same type as <code>[b]</code> items</td>
</tr>
</tbody>
</table>
<p>A few more…</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  head :: [a] -&gt; a</span></span><br><span class="line"><span class="keyword">var</span> head = <span class="function"><span class="keyword">function</span>(<span class="params">xs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> xs[<span class="number">0</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  filter :: (a -&gt; Bool) -&gt; [a] -&gt; [a]</span></span><br><span class="line"><span class="keyword">var</span> filter = curry(<span class="function"><span class="keyword">function</span>(<span class="params">f, xs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> xs.filter(f)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//  reduce :: (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b</span></span><br><span class="line"><span class="keyword">var</span> reduce = curry(<span class="function"><span class="keyword">function</span>(<span class="params">f, x, xs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> xs.reduce(f, x)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Let’s dissect the Hindley-Milner Type Signature of the <code>reduce</code> function:</p>
<table>
<thead>
<tr>
<th>about the reduce function</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>function name</td>
<td>// <code>reduce</code> :: (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b</td>
</tr>
<tr>
<td>3 parameters</td>
<td>// reduce :: <code>(b -&gt; a -&gt; b) -&gt; b -&gt; [a]</code> -&gt; b</td>
</tr>
<tr>
<td>return value</td>
<td>// reduce :: (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; <code>b</code></td>
</tr>
</tbody>
</table>
<p>What else can we deduce about that function parameter?</p>
<table>
<thead>
<tr>
<th>about the function parameter</th>
<th>// reduce :: <code>(b -&gt; a -&gt; b)</code> -&gt; b -&gt; [a] -&gt; b</th>
</tr>
</thead>
<tbody>
<tr>
<td>1<sup>st</sup> parameter <code>b</code></td>
<td>is the same type as the initializer</td>
</tr>
<tr>
<td>2<sup>nd</sup> parameter <code>a</code></td>
<td>is the same type as <code>[a]</code> items</td>
</tr>
<tr>
<td>return value <code>b</code></td>
<td>is the same type as the initializer</td>
</tr>
</tbody>
</table>
<h3 id="Parametricity"><a href="#Parametricity" class="headerlink" title="Parametricity"></a>Parametricity</h3><p>Once a <code>type variable</code> is introduced, there emerges a curious property called <code>parametricity</code>.</p>
<blockquote>
<p>parametricity states that a function will act on all types in a uniform manner.</p>
</blockquote>
<p>Let’s investigate:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// head :: [a] -&gt; a</span></span><br></pre></td></tr></table></figure>
<p>Looking at head, we see that it takes <code>[a]</code> to <code>a</code>. Besides the concrete type array, it has no other information available and, therefore, its functionality is limited to working on the array alone. The return value <code>a</code> says it cannot be a specific type, which means it can be any type, which leaves us with a function that must work uniformly for every conceivable type. This is what parametricity is all about.</p>
<p>We can deduce that the function cannot change the type, narrowing the possible actions the function can take.</p>
<h3 id="Theorems"><a href="#Theorems" class="headerlink" title="Theorems"></a>Theorems</h3><p>A few random example theorems lifted directly from Wadler’s paper on the subject.</p>
<pre><code>// head :: [a] -&gt; a
compose(f, head) == compose(head, map(f))

// filter :: (a -&gt; Bool) -&gt; [a] -&gt; [a]
compose(map(f), filter(compose(p, f))) === compose(filter(p), map(f))
</code></pre><p>The <code>head</code> theorem says that if we get the <code>head</code> of our array, then run some function <code>f</code> on it, that is equivalent to, and incidentally, much faster than, if we first <code>map(f)</code> over every element then take the <code>head</code> of the result.</p>
<p>You might think, well that’s just common sense. But last I checked, computers don’t have common sense. Indeed, they must have a formal way to automate these kind of code optimizations. Maths has a way of formalizing the intuitive, which is helpful amidst the rigid terrain of computer logic.</p>
<p>The <code>filter</code> theorem is similar. It says that if we compose <code>f</code> and <code>p</code> to check which should be filtered, then actually apply the <code>f</code> via <code>map</code> (remember filter, will not transform the elements - its signature enforces that a will not be touched), it will always be equivalent to mapping our <code>f</code> then filtering the result with the <code>p</code> predicate.</p>
<p>These are just two examples, but you can apply this reasoning to any <code>polymorphic type signature</code> and it will always hold. In JavaScript, there are some tools available to declare rewrite rules. One might also do this via the <code>compose</code> function itself. The fruit is low hanging and the possibilities are endless.</p>
<h3 id="Constraints"><a href="#Constraints" class="headerlink" title="Constraints"></a>Constraints</h3><p>One last thing to note is that we can constrain types to an interface.</p>
<pre><code>// sort :: Ord a =&gt; [a] -&gt; [a]
</code></pre><p>What we see on the left side of our fat arrow here is the statement of a fact: <code>a</code> must be an <code>Ord</code>. Or in other words, <code>a</code> must implement the <code>Ord interface</code>. What is Ord and where did it come from? In a typed language it would be a <code>defined interface</code> that says we can order the values. This not only tells us more about the <code>a</code> and what our sort function is up to, but also restricts the domain. We call these interface declarations <code>type constraints</code>.</p>
<pre><code>// assertEqual :: (Eq a, Show a) =&gt; a -&gt; a -&gt; Assertion
</code></pre><p>Here, we have two constraints: <code>Eq</code> and <code>Show</code>. Those will ensure that we can check equality of our as and print the difference if they are not equal.</p>
<h3 id="Summary-5"><a href="#Summary-5" class="headerlink" title="Summary"></a>Summary</h3><p>Hindley-Milner type signatures are ubiquitous in the functional world. Though they are simple to read and write, it takes time to master the technique of understanding programs through signatures alone. We will add type signatures to each line of code from here on out.</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>For this post we’ve covered the first 7 chapters of the book, but there is more to learn.  In the next post we will learn about error handling, code branching, how can we make the whole application pure instead of merely namespacing destructive functions, and how can we make our app safer and more expressive.</p>

                
            </div>
        </article>
    
</div>
<div class="paginator">
    
        
        <a class="prev" href="/page/18/">
            <i class="iconfont icon-prev"></i>
            Prev
        </a>
        
        
        <a class="next" href="/page/20/">
            Next
            <i class="iconfont icon-next"></i>
        </a>
        
    
</div>

    </div>
</div>
<footer class="footer-social">
    
    <a class="social-link" target="_blank" href="https://github.com/dearfrankg">
        <i class="iconfont icon-github"></i>
    </a>
    

    

    

    <div class="footer-copyright">
        <p class="time-line">
            &copy;
            
            
            2018
            &nbsp;<i class="iconfont icon-heart"></i>&nbsp;
            <a target="_blank" href="https://github.com/iJinxin">Frank Gutierrez</a>
        </p>
        <p class="theme-info">
            Powered by <a target="_blank" href="https://hexo.io">Hexo</a>  |  Theme -
            <a target="_blank" href="https://github.com/iJinxin/hexo-theme-sky">Sky</a>
        </p>
    </div>
</footer>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="/js/index.js"></script>
<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> -->
<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
<script>
    

</script>
</html>
