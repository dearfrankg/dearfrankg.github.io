<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    <title>dev notes</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/gitment.css">
    <link rel="stylesheet" href="/css/font_859455_eaq7v6w8ktj.css">
</head>

<body>
<header class="header">
    <div class="header-inner">
        <div class="header-title">

        </div>
        <nav class="header-nav">
            
            <a href="/" class="header-nav-link">
                Home
            </a>
            

            
            <a href="/archives" class="header-nav-link">
                Archives
            </a>
            

            
            <a href="/tags" class="header-nav-link">
                Tags
            </a>
            

            
        </nav>
    </div>
</header>
<header class="mobile-header">
    <div class="mobile-nav">
        <div class="mobile-nav-icon">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <div class="mobile-nav-title">
            <a href="/" class="mobile-nav-title-link">Frank Gutierrez's Blog</a>
        </div>

    </div>
    <nav class="mobile-menu">
        <ul class="mobile-menu-list">
            <li class="mobile-menu-item">
                <i class="iconfont icon-home"></i>
                <a href="/" class="mobile-nav-link">Home</a>
            </li>
            <li class="mobile-menu-item">
                <i class="iconfont icon-archive"></i>
                <a href="/archives" class="mobile-nav-link">Archives</a>
            </li>
            <li class="mobile-menu-item">
                <i class="iconfont icon-tag"></i>
                <a href="/tags" class="mobile-nav-link">Tags</a>
            </li>
            <li class="mobile-menu-item">
                <i class="iconfont icon-about"></i>
                <a href="/about/" class="mobile-nav-link">About</a>
            </li>
        </ul>
    </nav>
</header>
<div class="main">
    <div class="content-inner">
        <div class="posts">
    <article class="post-whole">
        <div class="post-title">
            <h2 class="title">Frisby&#39;s Mostly Adequate Guide to Functional Programming - Part 1</h2>
            <div class="post-meta">
                <span class="post-time">2016-08-02</span>
                
                <span class="post-visit"> visited：<span id="busuanzi_value_page_pv"></span></span>
            </div>
        </div>
        <div class="post-toc" id="post-toc">
    <strong class="post-toc-title">TOC</strong>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Introduction"><span class="toc-text">Introduction</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#First-Class-Functions"><span class="toc-text">First Class Functions</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Don’t-wrap-functions"><span class="toc-text">Don’t wrap functions</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Don’t-tie-function-names-to-specific-data"><span class="toc-text">Don’t tie function names to specific data</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Be-aware-of-JS-leaky-abstractions"><span class="toc-text">Be aware of JS leaky abstractions</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Summary"><span class="toc-text">Summary</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pure-Functions"><span class="toc-text">Pure Functions</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Don’t-mutate-data"><span class="toc-text">Don’t mutate data</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Don’t-depend-on-mutable-data-or-system-state"><span class="toc-text">Don’t depend on mutable data or system state</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cacheable"><span class="toc-text">Cacheable</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Self-Documenting"><span class="toc-text">Self-Documenting</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Portable"><span class="toc-text">Portable</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Testable"><span class="toc-text">Testable</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Reasonable"><span class="toc-text">Reasonable</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Parallel-Code"><span class="toc-text">Parallel Code</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Summary-1"><span class="toc-text">Summary</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Currying"><span class="toc-text">Currying</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Summary-2"><span class="toc-text">Summary</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Exercises"><span class="toc-text">Exercises</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Answers"><span class="toc-text">Answers</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Composing"><span class="toc-text">Composing</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Simple-compose"><span class="toc-text">Simple compose</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Associative"><span class="toc-text">Associative</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pointfree"><span class="toc-text">Pointfree</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Debugging"><span class="toc-text">Debugging</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Category-Theory"><span class="toc-text">Category Theory</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Summary-3"><span class="toc-text">Summary</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Exercises-1"><span class="toc-text">Exercises</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Answers-1"><span class="toc-text">Answers</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-Application"><span class="toc-text">Example Application</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Declarative-Coding"><span class="toc-text">Declarative Coding</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#A-flickr-of-functional-programming"><span class="toc-text">A flickr of functional programming</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#A-Principled-Refactor"><span class="toc-text">A Principled Refactor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Summary-4"><span class="toc-text">Summary</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hindley-Milner-Type-Signatures"><span class="toc-text">Hindley-Milner Type Signatures</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Parametricity"><span class="toc-text">Parametricity</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Theorems"><span class="toc-text">Theorems</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Constraints"><span class="toc-text">Constraints</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Summary-5"><span class="toc-text">Summary</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Conclusion"><span class="toc-text">Conclusion</span></a></li></ol>
    <div class="back-to-top" id="back-to-top">
        <a href="javascript:void(0);">back to top</a>
    </div>
</div>

        <div class="post-content">
            <!-- TOC depthFrom:1 depthTo:1 withLinks:1 updateOnSave:0 orderedList:0 -->
<ul>
<li><a href="#Introduction">Introduction</a></li>
<li><a href="#First-Class-Functions">First Class Functions</a></li>
<li><a href="#Pure-Functions">Pure Functions</a></li>
<li><a href="#Currying">Currying</a></li>
<li><a href="#Composing">Composing</a></li>
<li><a href="#Example-Application">Example Application</a></li>
<li><a href="#Hindley-Milner-Type-Signatures">Hindley-Milner Type Signatures</a></li>
<li><a href="#Conclusion">Conclusion</a></li>
</ul>
<!-- /TOC -->
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>This will be Part 1 of a multi-part series on Functional Programming.  By the end of the series I think you’ll agree that Functional Programming (FP) requires less code and is easier to understand than other programming paradigms.</p>
<p>We will be using math properties to refactor programs:</p>
<pre><code>// associative
// add or multiply regardless of grouping
( a + b ) + c === a + ( b + c )
( a * b ) * c === a * ( b * c )

// commutative
// add or multiply regardless of order
a + b === b + a
a * b === b * a

// identity
// Any number multiplied by 1 is itself
a * 1 === a

// distributive
// multiply a single term and multiple terms inside parenthesis
a( b + c ) === a * b + a * c
</code></pre><p>Don’t worry more math to come.</p>
<h2 id="First-Class-Functions"><a href="#First-Class-Functions" class="headerlink" title="First Class Functions"></a>First Class Functions</h2><p>The term ‘first class’ is just a classification.  It refers to the fact that it is a fundamental component of the language.  Hence you can pass functions around just as you do strings and integers.</p>
<h3 id="Don’t-wrap-functions"><a href="#Don’t-wrap-functions" class="headerlink" title="Don’t wrap functions"></a>Don’t wrap functions</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> hi = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'Hi '</span> + name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** ignorant</span></span><br><span class="line"><span class="comment"> * unnecessarily wraps a function</span></span><br><span class="line"><span class="comment"> * forces a one argument signature</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> greeting = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> hi(name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// enlightened</span></span><br><span class="line"><span class="keyword">var</span> greeting = hi</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ignorant</span></span><br><span class="line"><span class="keyword">var</span> getServerStuff = <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> ajaxCall(<span class="function"><span class="keyword">function</span>(<span class="params">json</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> callback(json)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// enlightened</span></span><br><span class="line"><span class="keyword">var</span> getServerStuff = ajaxCall</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ignorant</span></span><br><span class="line"><span class="keyword">var</span> BlogController = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> create = <span class="function"><span class="keyword">function</span>(<span class="params">attrs</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Db.create(attrs)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    create: create</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// enlightened</span></span><br><span class="line"><span class="keyword">var</span> BlogController = &#123;</span><br><span class="line">  create: Db.create,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Don’t-tie-function-names-to-specific-data"><a href="#Don’t-tie-function-names-to-specific-data" class="headerlink" title="Don’t tie function names to specific data"></a>Don’t tie function names to specific data</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// specific to our current blog</span></span><br><span class="line"><span class="keyword">var</span> validArticles = <span class="function"><span class="keyword">function</span>(<span class="params">articles</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> articles.filter(<span class="function"><span class="keyword">function</span>(<span class="params">article</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> article !== <span class="literal">null</span> &amp;&amp; article !== <span class="literal">undefined</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// vastly more relevant for future projects</span></span><br><span class="line"><span class="keyword">var</span> compact = <span class="function"><span class="keyword">function</span>(<span class="params">xs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> xs.filter(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x !== <span class="literal">null</span> &amp;&amp; x !== <span class="literal">undefined</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Be-aware-of-JS-leaky-abstractions"><a href="#Be-aware-of-JS-leaky-abstractions" class="headerlink" title="Be aware of JS leaky abstractions"></a>Be aware of JS leaky abstractions</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// scary</span></span><br><span class="line">fs.readFile(<span class="string">'freaky_friday.txt'</span>, Db.save)</span><br><span class="line"></span><br><span class="line"><span class="comment">// less so</span></span><br><span class="line">fs.readFile(<span class="string">'freaky_friday.txt'</span>, Db.save.bind(Db))</span><br></pre></td></tr></table></figure>
<h3 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h3><ul>
<li>Reduce complexity by not wrapping functions unnecessarily.</li>
<li>Increase code reuse by trying to avoid function names that tie the name to specific data.</li>
<li>Be aware of <code>leaky abstractions</code> like <code>this</code> used by JS OOP.</li>
</ul>
<h2 id="Pure-Functions"><a href="#Pure-Functions" class="headerlink" title="Pure Functions"></a>Pure Functions</h2><blockquote>
<p>A pure function is a function that, given the same input, will always return the same output and does not have any observable side effect.</p>
</blockquote>
<h3 id="Don’t-mutate-data"><a href="#Don’t-mutate-data" class="headerlink" title="Don’t mutate data"></a>Don’t mutate data</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xs = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// pure</span></span><br><span class="line">xs.slice(<span class="number">0</span>, <span class="number">3</span>) <span class="comment">// =&gt; [1, 2, 3]</span></span><br><span class="line">xs.slice(<span class="number">0</span>, <span class="number">3</span>) <span class="comment">// =&gt; [1, 2, 3]</span></span><br><span class="line">xs.slice(<span class="number">0</span>, <span class="number">3</span>) <span class="comment">// =&gt; [1, 2, 3]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// impure</span></span><br><span class="line">xs.splice(<span class="number">0</span>, <span class="number">3</span>) <span class="comment">//=&gt; [1, 2, 3]</span></span><br><span class="line">xs.splice(<span class="number">0</span>, <span class="number">3</span>) <span class="comment">//=&gt; [4, 5]</span></span><br><span class="line">xs.splice(<span class="number">0</span>, <span class="number">3</span>) <span class="comment">//=&gt; []</span></span><br></pre></td></tr></table></figure>
<h3 id="Don’t-depend-on-mutable-data-or-system-state"><a href="#Don’t-depend-on-mutable-data-or-system-state" class="headerlink" title="Don’t depend on mutable data or system state"></a>Don’t depend on mutable data or system state</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// impure</span></span><br><span class="line"><span class="keyword">var</span> minimum = <span class="number">21</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> checkAge = <span class="function"><span class="keyword">function</span>(<span class="params">age</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> age &gt;= minimum</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// pure</span></span><br><span class="line"><span class="keyword">var</span> checkAge = <span class="function"><span class="keyword">function</span>(<span class="params">age</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> minimum = <span class="number">21</span></span><br><span class="line">  <span class="keyword">return</span> age &gt;= minimum</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>A side effect is a change of system state or observable interaction with the outside world that occurs during the calculation of a result.</p>
</blockquote>
<p>Side effects may include, but are not limited to:</p>
<ul>
<li>changing the file system</li>
<li>inserting a record into a database</li>
<li>making an http call</li>
<li>mutations</li>
<li>printing to the screen / logging</li>
<li>obtaining user input</li>
<li>querying the DOM</li>
<li>accessing system state</li>
</ul>
<p>Side effects disqualify a function from being pure. And it makes sense: pure functions, by definition, must always return the same output given the same input, which is not possible to guarantee when dealing with matters outside our local function.</p>
<blockquote>
<p>A function is a special relationship between values: Each of its input values gives back exactly one output value.</p>
</blockquote>
<p>Here comes the dramatic reveal: <code>Pure functions are mathematical functions</code> and they’re what functional programming is all about. Programming with these little angels can provide huge benefits. Let’s look at some reasons why we’re willing to go to great lengths to preserve purity.</p>
<h3 id="Cacheable"><a href="#Cacheable" class="headerlink" title="Cacheable"></a>Cacheable</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> squareNumber = memoize(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x * x</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">squareNumber(<span class="number">4</span>)</span><br><span class="line"><span class="comment">//=&gt; 16</span></span><br><span class="line"></span><br><span class="line">squareNumber(<span class="number">4</span>) <span class="comment">// returns cache for input 4</span></span><br><span class="line"><span class="comment">//=&gt; 16</span></span><br></pre></td></tr></table></figure>
<p>Transform impure to pure</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> pureHttpCall = memoize(<span class="function"><span class="keyword">function</span>(<span class="params">url, params</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $.getJSON(url, params)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Our memoize function works just fine, though it doesn’t cache the results of the http call, rather it caches the generated function.</p>
<p>This is not very useful yet, but we’ll soon learn some tricks that will make it so. The takeaway is that we can cache every function no matter how destructive they seem.</p>
<h3 id="Self-Documenting"><a href="#Self-Documenting" class="headerlink" title="Self-Documenting"></a>Self-Documenting</h3><p>A function’s dependencies are explicit and therefore easier to see and understand.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//impure</span></span><br><span class="line"><span class="keyword">var</span> signUp = <span class="function"><span class="keyword">function</span>(<span class="params">attrs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> user = saveUser(attrs)</span><br><span class="line">  welcomeUser(user)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> saveUser = <span class="function"><span class="keyword">function</span>(<span class="params">attrs</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> user = Db.save(attrs)</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> welcomeUser = <span class="function"><span class="keyword">function</span>(<span class="params">user</span>) </span>&#123;</span><br><span class="line">    Email(user, ...)</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//pure</span></span><br><span class="line"><span class="keyword">var</span> signUp = <span class="function"><span class="keyword">function</span>(<span class="params">Db, Email, attrs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> user = saveUser(Db, attrs)</span><br><span class="line">    welcomeUser(Email, user)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> saveUser = <span class="function"><span class="keyword">function</span>(<span class="params">Db, attrs</span>) </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> welcomeUser = <span class="function"><span class="keyword">function</span>(<span class="params">Email, user</span>) </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Portable"><a href="#Portable" class="headerlink" title="Portable"></a>Portable</h3><p>In a JavaScript setting, portability could mean serializing and sending functions over a socket. It could mean running all our app code in web workers. Portability is a powerful trait.</p>
<p>Contrary to “typical” methods and procedures in imperative programming rooted deep in their environment via state, dependencies, and available effects, pure functions can be run anywhere our hearts desire.</p>
<p>When was the last time you copied a method into a new app? One of my favorite quotes comes from Erlang creator, Joe Armstrong: “The problem with object-oriented languages is they’ve got all this implicit environment that they carry around with them. You wanted a banana but what you got was a gorilla holding the banana… and the entire jungle”.</p>
<h3 id="Testable"><a href="#Testable" class="headerlink" title="Testable"></a>Testable</h3><p>Next, we come to realize pure functions make testing much easier. We don’t have to mock a “real” payment gateway or setup and assert the state of the world after each test. We simply give the function input and assert output.</p>
<h3 id="Reasonable"><a href="#Reasonable" class="headerlink" title="Reasonable"></a>Reasonable</h3><p>Many believe the biggest win when working with pure functions is referential transparency. A spot of code is referentially transparent when it can be substituted for its evaluated value without changing the behavior of the program.</p>
<h3 id="Parallel-Code"><a href="#Parallel-Code" class="headerlink" title="Parallel Code"></a>Parallel Code</h3><p>We can run any pure function in parallel since it does not need access to shared memory and it cannot, by definition, have a race condition due to some side effect.</p>
<p>This is very much possible in a server side js environment with threads as well as in the browser with web workers though current culture seems to avoid it due to complexity when dealing with impure functions.</p>
<h3 id="Summary-1"><a href="#Summary-1" class="headerlink" title="Summary"></a>Summary</h3><p>We’ve seen what pure functions are and why we think they’re good. From this point on, we’ll strive to write all our functions in a pure way. We’ll require some extra tools to help us do so, but in the meantime, we’ll try to separate the impure functions from the rest of the pure code.</p>
<p>Writing programs with pure functions is a tad laborious without some extra tools in our belt. We have to juggle data by passing arguments all over the place, we’re forbidden to use state, not to mention effects. How does one go about writing these masochistic programs? Let’s acquire a new tool called curry.</p>
<h2 id="Currying"><a href="#Currying" class="headerlink" title="Currying"></a>Currying</h2><blockquote>
<p>The concept is simple: You can call a function with fewer arguments than it expects. It returns a function that takes the remaining arguments.</p>
</blockquote>
<p>Let’s set up a few curried functions…</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> curry = <span class="built_in">require</span>(<span class="string">'lodash/curry'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> match = curry(<span class="function"><span class="keyword">function</span>(<span class="params">what, str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> str.match(what)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> replace = curry(<span class="function"><span class="keyword">function</span>(<span class="params">what, replacement, str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> str.replace(what, replacement)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> filter = curry(<span class="function"><span class="keyword">function</span>(<span class="params">f, ary</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> ary.filter(f)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> map = curry(<span class="function"><span class="keyword">function</span>(<span class="params">f, ary</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> ary.map(f)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>The pattern I’ve followed is a simple, but important one. I’ve strategically positioned the data we’re operating on (String, Array) as the last argument. It will become clear as to why upon use.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">match(<span class="regexp">/\s+/g</span>, <span class="string">'hello world'</span>)</span><br><span class="line"><span class="comment">// [ ' ' ]</span></span><br><span class="line"></span><br><span class="line">match(<span class="regexp">/\s+/g</span>)(<span class="string">'hello world'</span>)</span><br><span class="line"><span class="comment">// [ ' ' ]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> hasSpaces = match(<span class="regexp">/\s+/g</span>)</span><br><span class="line"><span class="comment">// function(x) &#123; return x.match(/\s+/g) &#125;</span></span><br><span class="line"></span><br><span class="line">hasSpaces(<span class="string">'hello world'</span>)</span><br><span class="line"><span class="comment">// [ ' ' ]</span></span><br><span class="line"></span><br><span class="line">hasSpaces(<span class="string">'spaceless'</span>)</span><br><span class="line"><span class="comment">// null</span></span><br><span class="line"></span><br><span class="line">filter(hasSpaces, [<span class="string">'tori_spelling'</span>, <span class="string">'tori amos'</span>])</span><br><span class="line"><span class="comment">// ['tori amos']</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> findSpaces = filter(hasSpaces)</span><br><span class="line"><span class="comment">// function(xs) &#123; return xs.filter(function(x) &#123; return x.match(/\s+/g) &#125;) &#125;</span></span><br><span class="line"></span><br><span class="line">findSpaces([<span class="string">'tori_spelling'</span>, <span class="string">'tori amos'</span>])</span><br><span class="line"><span class="comment">// ['tori amos']</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> noVowels = replace(<span class="regexp">/[aeiouy]/ig</span>)</span><br><span class="line"><span class="comment">// function(replacement, x) &#123; return x.replace(/[aeiouy]/ig, replacement) &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> censored = noVowels(<span class="string">"*"</span>)</span><br><span class="line"><span class="comment">// function(x) &#123; return x.replace(/[aeiouy]/ig, '*') &#125;</span></span><br><span class="line"></span><br><span class="line">censored(<span class="string">'Chocolate Rain'</span>)</span><br><span class="line"><span class="comment">// 'Ch*c*l*t* R**n'</span></span><br></pre></td></tr></table></figure>
<p>Currying is useful for many things. We can make new functions just by giving our base functions some arguments as seen in <code>hasSpaces</code>, <code>findSpaces</code>, and <code>censored</code>.</p>
<p>We also have the ability to transform any function that works on single elements into a function that works on arrays simply by wrapping it with <code>map</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> getChildren = <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x.childNodes</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> allTheChildren = map(getChildren)</span><br></pre></td></tr></table></figure>
<p>Giving a function fewer arguments than it expects is typically called <code>partial application</code>. Partially applying a function can remove a lot of boiler plate code. Consider what the above allTheChildren function would be with the uncurried <code>map</code> from lodash (note the arguments are in a different order):</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> allTheChildren = <span class="function"><span class="keyword">function</span>(<span class="params">elements</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> _.map(elements, getChildren)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We typically don’t define functions that work on arrays, because we can just call <code>map(getChildren)</code> inline. Same with <code>sort</code>, <code>filter</code>, and other higher order functions.</p>
<blockquote>
<p>Higher order function: A function that takes or returns a function.</p>
</blockquote>
<p>When we spoke about pure functions, we said they take 1 input to 1 output. Currying does exactly this: each single argument returns a new function expecting the remaining arguments. That is 1 input to 1 output.</p>
<p>No matter if the output is another function - it qualifies as pure. We do allow more than one argument at a time, but this is seen as merely removing the extra ()’s for convenience.</p>
<h3 id="Summary-2"><a href="#Summary-2" class="headerlink" title="Summary"></a>Summary</h3><p>Currying is handy and is used on a daily basis. It is a tool for the belt that makes FP less verbose and tedious. We can make new, useful functions on the fly simply by passing in a few arguments and as a bonus, we’ve retained the mathematical function definition despite multiple arguments.</p>
<h3 id="Exercises"><a href="#Exercises" class="headerlink" title="Exercises"></a>Exercises</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _ = <span class="built_in">require</span>(<span class="string">'ramda'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Exercise 1</span></span><br><span class="line"><span class="comment">// Refactor to remove all arguments by partially applying the function.</span></span><br><span class="line"><span class="keyword">var</span> words = <span class="function"><span class="keyword">function</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> _.split(<span class="string">' '</span>, str)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Exercise 1a</span></span><br><span class="line"><span class="comment">// Use map to make a new words fn that works on an array of strings.</span></span><br><span class="line"><span class="keyword">var</span> sentences = <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Exercise 2</span></span><br><span class="line"><span class="comment">// Refactor to remove all arguments by partially applying the functions.</span></span><br><span class="line"><span class="keyword">var</span> filterQs = <span class="function"><span class="keyword">function</span>(<span class="params">xs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> _.filter(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> match(<span class="regexp">/q/i</span>, x)</span><br><span class="line">  &#125;, xs)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Exercise 3</span></span><br><span class="line"><span class="comment">// Refactor max to not reference any arguments.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// leave this</span></span><br><span class="line"><span class="keyword">var</span> _keepHighest = <span class="function"><span class="keyword">function</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x &gt;= y ? x : y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// REFACTOR</span></span><br><span class="line"><span class="keyword">var</span> max = <span class="function"><span class="keyword">function</span>(<span class="params">xs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> _.reduce(<span class="function"><span class="keyword">function</span>(<span class="params">acc, x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> _keepHighest(acc, x)</span><br><span class="line">  &#125;, -<span class="literal">Infinity</span>, xs)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Bonus 1:</span></span><br><span class="line"><span class="comment">// Wrap array's slice to be functional and curried.</span></span><br><span class="line"><span class="comment">// //[1, 2, 3].slice(0, 2)</span></span><br><span class="line"><span class="keyword">var</span> slice = <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Bonus 2:</span></span><br><span class="line"><span class="comment">// Use slice to define a function "take" that takes n elements from the</span></span><br><span class="line"><span class="comment">// beginning of the string. Make it curried.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Result for "Something" with n=4 should be "Some"</span></span><br><span class="line"><span class="keyword">var</span> take = <span class="literal">undefined</span></span><br></pre></td></tr></table></figure>
<h3 id="Answers"><a href="#Answers" class="headerlink" title="Answers"></a>Answers</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// import functional tools like curry, map, filter, etc.</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./support'</span></span><br><span class="line"><span class="keyword">var</span> words = split(<span class="string">' '</span>)</span><br><span class="line"><span class="keyword">var</span> sentences = map(words)</span><br><span class="line"><span class="keyword">var</span> filterQs = filter(match(<span class="regexp">/q/i</span>))</span><br><span class="line"><span class="keyword">var</span> max = reduce(_keepHighest, -<span class="literal">Infinity</span>)</span><br><span class="line"><span class="keyword">var</span> slice = curry(<span class="function">(<span class="params">start, end, xs</span>) =&gt;</span> xs.slice(start, end))</span><br><span class="line"><span class="keyword">var</span> take = slice(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">words(<span class="string">'a test'</span>)                               <span class="comment">// [ 'a', 'test' ]</span></span><br><span class="line">sentences([ <span class="string">'a test'</span>, <span class="string">'a test'</span>, <span class="string">'a test'</span>, ])  <span class="comment">// [ [ 'a', 'test' ], [ 'a', 'test' ], [ 'a', 'test' ] ]</span></span><br><span class="line">filterQs([<span class="string">'quiet'</span>, <span class="string">'now'</span>])                    <span class="comment">// [ 'quiet' ]</span></span><br><span class="line">max([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>])                                <span class="comment">// 4</span></span><br><span class="line">slice(<span class="number">0</span>, <span class="number">4</span>, <span class="string">'funkalicious'</span>)                   <span class="comment">// funk</span></span><br><span class="line">take(<span class="number">4</span>, <span class="string">'funkalicious'</span>)                       <span class="comment">// funk</span></span><br></pre></td></tr></table></figure>
<h2 id="Composing"><a href="#Composing" class="headerlink" title="Composing"></a>Composing</h2><blockquote>
<p>The composition of two functions returns a new function. This makes perfect sense: composing two units of some type (in this case function) should yield a new unit of that very type.</p>
</blockquote>
<h3 id="Simple-compose"><a href="#Simple-compose" class="headerlink" title="Simple compose"></a>Simple compose</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> compose = <span class="function"><span class="keyword">function</span>(<span class="params">f, g</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> f(g(x))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> toUpperCase = <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x.toUpperCase()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> exclaim = <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + <span class="string">'!'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ignorant</span></span><br><span class="line"><span class="comment">// less readable than the enlightened version</span></span><br><span class="line"><span class="keyword">var</span> shout = <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> exclaim(toUpperCase(x))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// enlightened</span></span><br><span class="line"><span class="keyword">var</span> shout = compose(exclaim, toUpperCase)</span><br><span class="line"></span><br><span class="line">shout(<span class="string">"send in the clowns"</span>)</span><br><span class="line"><span class="comment">//=&gt; "SEND IN THE CLOWNS!"</span></span><br></pre></td></tr></table></figure>
<h3 id="Associative"><a href="#Associative" class="headerlink" title="Associative"></a>Associative</h3><blockquote>
<p>Composition is associative, meaning it doesn’t matter how you group them. That allows us to write a <code>variadic compose</code>.  <br><br><code>compose(f, compose(g, h)) == compose(compose(f, g), h)</code></p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> head = <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x[<span class="number">0</span>]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> reverse = reduce(<span class="function"><span class="keyword">function</span>(<span class="params">acc, x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> [x].concat(acc)</span><br><span class="line">&#125;, [])</span><br><span class="line"><span class="keyword">var</span> last = compose(head, reverse)</span><br><span class="line"></span><br><span class="line">last([<span class="string">'jumpkick'</span>, <span class="string">'roundhouse'</span>, <span class="string">'uppercut'</span>])</span><br><span class="line"><span class="comment">//=&gt; 'uppercut'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// previously we'd have to write two composes, but since it's associative, we can</span></span><br><span class="line"><span class="comment">// give compose as many fn's as we like and let it decide how to group them.</span></span><br><span class="line"><span class="keyword">var</span> lastUpper = compose(toUpperCase, head, reverse)</span><br><span class="line"></span><br><span class="line">lastUpper([<span class="string">'jumpkick'</span>, <span class="string">'roundhouse'</span>, <span class="string">'uppercut'</span>])</span><br><span class="line"><span class="comment">//=&gt; 'UPPERCUT'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> loudLastUpper = compose(exclaim, toUpperCase, head, reverse)</span><br><span class="line"></span><br><span class="line">loudLastUpper([<span class="string">'jumpkick'</span>, <span class="string">'roundhouse'</span>, <span class="string">'uppercut'</span>])</span><br><span class="line"><span class="comment">//=&gt; 'UPPERCUT!'</span></span><br></pre></td></tr></table></figure>
<h3 id="Pointfree"><a href="#Pointfree" class="headerlink" title="Pointfree"></a>Pointfree</h3><blockquote>
<p>Pointfree style means never having to say your data. Excuse me. It means functions that never mention the data upon which they operate. First class functions, currying, and composition all play well together to create this style.</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//not pointfree because we mention the data: word</span></span><br><span class="line"><span class="keyword">var</span> snakeCase = <span class="function"><span class="keyword">function</span>(<span class="params">word</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> word.toLowerCase().replace(<span class="regexp">/\s+/ig</span>, <span class="string">'_'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//pointfree</span></span><br><span class="line"><span class="keyword">var</span> snakeCase = compose(replace(<span class="regexp">/\s+/ig</span>, <span class="string">'_'</span>), toLowerCase)</span><br></pre></td></tr></table></figure>
<p>See how we partially applied replace? What we’re doing is piping our data through each function of 1 argument. Currying allows us to prepare each function to just take its data, operate on it, and pass it along. Something else to notice is how we don’t need the data to construct our function in the pointfree version, whereas in the pointful one, we must have our <code>word</code> available before anything else.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//not pointfree because we mention the data: name</span></span><br><span class="line"><span class="keyword">var</span> initials = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> name.split(<span class="string">' '</span>).map(compose(toUpperCase, head)).join(<span class="string">'. '</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//pointfree</span></span><br><span class="line"><span class="keyword">var</span> initials = compose(join(<span class="string">'. '</span>), map(compose(toUpperCase, head)), split(<span class="string">' '</span>))</span><br><span class="line"></span><br><span class="line">initials(<span class="string">"hunter stockton thompson"</span>)</span><br><span class="line"><span class="comment">// 'H. S. T'</span></span><br></pre></td></tr></table></figure>
<p>Pointfree code can again, help us remove needless names and keep us concise and generic. Pointfree is a good litmus test for functional code as it lets us know we’ve got small functions that take input to output. One can’t compose a while loop, for instance. Be warned, however, pointfree is a double-edged sword and can sometimes obfuscate intention. Not all functional code is pointfree and that is O.K. We’ll shoot for it where we can and stick with normal functions otherwise.</p>
<h3 id="Debugging"><a href="#Debugging" class="headerlink" title="Debugging"></a>Debugging</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* THE UTILITY */</span></span><br><span class="line"><span class="keyword">var</span> trace = curry(<span class="function"><span class="keyword">function</span>(<span class="params">tag, x</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(tag, x)</span><br><span class="line">  <span class="keyword">return</span> x</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// BROKEN</span></span><br><span class="line"><span class="comment">// Cryptic Error: Cannot read property 'apply' of undefined</span></span><br><span class="line"><span class="keyword">var</span> dasherize = compose(</span><br><span class="line">  join(<span class="string">'-'</span>),</span><br><span class="line">  toLower,</span><br><span class="line">  split(<span class="string">' '</span>),</span><br><span class="line">  replace(<span class="regexp">/\s&#123;2,&#125;/ig</span>, <span class="string">' '</span>)</span><br><span class="line">)</span><br><span class="line">dasherize(<span class="string">'The world is a vampire'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// THE DEBUG</span></span><br><span class="line"><span class="comment">// trace utility shows that split is working</span></span><br><span class="line"><span class="comment">// PROBLEM: toLower cannot take an array</span></span><br><span class="line"><span class="keyword">var</span> dasherize = compose(</span><br><span class="line">  join(<span class="string">'-'</span>),</span><br><span class="line">  toLower,</span><br><span class="line">  trace(<span class="string">'after split'</span>),</span><br><span class="line">  split(<span class="string">' '</span>),</span><br><span class="line">  replace(<span class="regexp">/\s&#123;2,&#125;/ig</span>, <span class="string">' '</span>)</span><br><span class="line">)</span><br><span class="line"><span class="comment">// TRACE: after split [ 'The', 'world', 'is', 'a', 'vampire' ]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// THE FIX: put map around toLower</span></span><br><span class="line"><span class="keyword">var</span> dasherize = compose(join(<span class="string">'-'</span>), map(toLower), split(<span class="string">' '</span>), replace(<span class="regexp">/\s&#123;2,&#125;/ig</span>, <span class="string">' '</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// OUTPUT: 'the-world-is-a-vampire'</span></span><br></pre></td></tr></table></figure>
<h3 id="Category-Theory"><a href="#Category-Theory" class="headerlink" title="Category Theory"></a>Category Theory</h3><blockquote>
<p>Category theory is an abstract branch of mathematics that can formalize concepts from several different branches such as <code>set theory</code>, <code>type theory</code>, <code>group theory</code>, <code>logic</code>, and more. It primarily deals with <code>objects</code>, <code>morphisms</code>, and <code>transformations</code>, which mirrors programming quite closely.</p>
</blockquote>
<p>In category theory, we have something called… a category. It is defined as a collection with the following:</p>
<ul>
<li><p>A collection of objects<br>The objects will be data types. For instance, String, Boolean, Number, Object, etc. We often view data types as sets of all the possible values.</p>
</li>
<li><p>A collection of morphisms<br>pure fn</p>
</li>
<li><p>A notion of composition on the morphisms<br>compose</p>
</li>
<li><p>A distinguished morphism called identity<br>id = (x) =&gt; x</p>
</li>
</ul>
<p>I expect this to be a little fuzzy at this point it will become more clear later.  For now it provides a drop of wisdom regarding composition - namely, the associativity and identity properties. We have sufficiently skimmed the surface and must move on.</p>
<h3 id="Summary-3"><a href="#Summary-3" class="headerlink" title="Summary"></a>Summary</h3><p>Composition connects our functions together like a series of pipes.  We hold composition as a design principle above all others. This is because it keeps our app simple and reasonable. Category theory will play a big part in app architecture, modeling side effects, and ensuring correctness.</p>
<h3 id="Exercises-1"><a href="#Exercises-1" class="headerlink" title="Exercises"></a>Exercises</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Example Data</span></span><br><span class="line"><span class="keyword">var</span> CARS = [</span><br><span class="line">  &#123;<span class="attr">name</span>: <span class="string">"Ferrari FF"</span>, <span class="attr">horsepower</span>: <span class="number">660</span>, <span class="attr">dollar_value</span>: <span class="number">700000</span>, <span class="attr">in_stock</span>: <span class="literal">true</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">name</span>: <span class="string">"Spyker C12 Zagato"</span>, <span class="attr">horsepower</span>: <span class="number">650</span>, <span class="attr">dollar_value</span>: <span class="number">648000</span>, <span class="attr">in_stock</span>: <span class="literal">false</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">name</span>: <span class="string">"Jaguar XKR-S"</span>, <span class="attr">horsepower</span>: <span class="number">550</span>, <span class="attr">dollar_value</span>: <span class="number">132000</span>, <span class="attr">in_stock</span>: <span class="literal">false</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">name</span>: <span class="string">"Audi R8"</span>, <span class="attr">horsepower</span>: <span class="number">525</span>, <span class="attr">dollar_value</span>: <span class="number">114200</span>, <span class="attr">in_stock</span>: <span class="literal">false</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">name</span>: <span class="string">"Aston Martin One-77"</span>, <span class="attr">horsepower</span>: <span class="number">750</span>, <span class="attr">dollar_value</span>: <span class="number">1850000</span>, <span class="attr">in_stock</span>: <span class="literal">true</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">name</span>: <span class="string">"Pagani Huayra"</span>, <span class="attr">horsepower</span>: <span class="number">700</span>, <span class="attr">dollar_value</span>: <span class="number">1300000</span>, <span class="attr">in_stock</span>: <span class="literal">false</span>&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">// Exercise 1:</span></span><br><span class="line"><span class="comment">// Use _.compose() to rewrite the function below. Hint: _.prop() is curried.</span></span><br><span class="line"><span class="keyword">var</span> isLastInStock = <span class="function"><span class="keyword">function</span>(<span class="params">cars</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> last_car = _.last(cars)</span><br><span class="line">  <span class="keyword">return</span> _.prop(<span class="string">'in_stock'</span>, last_car)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Exercise 2:</span></span><br><span class="line"><span class="comment">// Use _.compose(), _.prop() and _.head() to retrieve the name of the first car.</span></span><br><span class="line"><span class="keyword">var</span> nameOfFirstCar = <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Exercise 3:</span></span><br><span class="line"><span class="comment">// Use the helper function _average to refactor averageDollarValue as a composition.</span></span><br><span class="line"><span class="keyword">var</span> _average = <span class="function"><span class="keyword">function</span>(<span class="params">xs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> _.reduce(_.add, <span class="number">0</span>, xs) / xs.length</span><br><span class="line">&#125; <span class="comment">// &lt;- leave be</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> averageDollarValue = <span class="function"><span class="keyword">function</span>(<span class="params">cars</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> dollar_values = _.map(<span class="function"><span class="keyword">function</span>(<span class="params">c</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> c.dollar_value</span><br><span class="line">  &#125;, cars)</span><br><span class="line">  <span class="keyword">return</span> _average(dollar_values)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Exercise 4:</span></span><br><span class="line"><span class="comment">// Write a function: sanitizeNames() using compose that returns a list of lowercase and underscored car's names: e.g: sanitizeNames([&#123;name: 'Ferrari FF', horsepower: 660, dollar_value: 700000, in_stock: true&#125;]) //=&gt; ['ferrari_ff'].</span></span><br><span class="line"><span class="keyword">var</span> _underscore = _.replace(<span class="regexp">/\W+/g</span>, <span class="string">'_'</span>) <span class="comment">//&lt;-- leave this alone and use to sanitize</span></span><br><span class="line"><span class="keyword">var</span> sanitizeNames = <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Bonus 1:</span></span><br><span class="line"><span class="comment">// Refactor availablePrices with compose.</span></span><br><span class="line"><span class="keyword">var</span> availablePrices = <span class="function"><span class="keyword">function</span>(<span class="params">cars</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> available_cars = _.filter(_.prop(<span class="string">'in_stock'</span>), cars)</span><br><span class="line">  <span class="keyword">return</span> available_cars.map(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> accounting.formatMoney(x.dollar_value)</span><br><span class="line">  &#125;).join(<span class="string">', '</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Bonus 2:</span></span><br><span class="line"><span class="comment">// Refactor to pointfree. Hint: you can use _.flip().</span></span><br><span class="line"><span class="keyword">var</span> fastestCar = <span class="function"><span class="keyword">function</span>(<span class="params">cars</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> sorted = _.sortBy(<span class="function"><span class="keyword">function</span>(<span class="params">car</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> car.horsepower</span><br><span class="line">  &#125;, cars)</span><br><span class="line">  <span class="keyword">var</span> fastest = _.last(sorted)</span><br><span class="line">  <span class="keyword">return</span> fastest.name + <span class="string">' is the fastest'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Answers-1"><a href="#Answers-1" class="headerlink" title="Answers"></a>Answers</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">'./support'</span>)</span><br><span class="line"><span class="keyword">const</span> _ = <span class="built_in">require</span>(<span class="string">'ramda'</span>)</span><br><span class="line"><span class="keyword">const</span> accounting = <span class="built_in">require</span>(<span class="string">'accounting'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> CARS = [</span><br><span class="line">  &#123;<span class="attr">name</span>: <span class="string">"Ferrari FF"</span>, <span class="attr">horsepower</span>: <span class="number">660</span>, <span class="attr">dollar_value</span>: <span class="number">700000</span>, <span class="attr">in_stock</span>: <span class="literal">true</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">name</span>: <span class="string">"Spyker C12 Zagato"</span>, <span class="attr">horsepower</span>: <span class="number">650</span>, <span class="attr">dollar_value</span>: <span class="number">648000</span>, <span class="attr">in_stock</span>: <span class="literal">false</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">name</span>: <span class="string">"Jaguar XKR-S"</span>, <span class="attr">horsepower</span>: <span class="number">550</span>, <span class="attr">dollar_value</span>: <span class="number">132000</span>, <span class="attr">in_stock</span>: <span class="literal">false</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">name</span>: <span class="string">"Audi R8"</span>, <span class="attr">horsepower</span>: <span class="number">525</span>, <span class="attr">dollar_value</span>: <span class="number">114200</span>, <span class="attr">in_stock</span>: <span class="literal">false</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">name</span>: <span class="string">"Aston Martin One-77"</span>, <span class="attr">horsepower</span>: <span class="number">750</span>, <span class="attr">dollar_value</span>: <span class="number">1850000</span>, <span class="attr">in_stock</span>: <span class="literal">true</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">name</span>: <span class="string">"Pagani Huayra"</span>, <span class="attr">horsepower</span>: <span class="number">700</span>, <span class="attr">dollar_value</span>: <span class="number">1300000</span>, <span class="attr">in_stock</span>: <span class="literal">false</span>&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> isLastInStock = compose(_.prop(<span class="string">'in_stock'</span>), _.last)</span><br><span class="line"><span class="keyword">var</span> nameOfFirstCar = compose(_.prop(<span class="string">'name'</span>), _.head)</span><br><span class="line"><span class="keyword">var</span> _average = <span class="function"><span class="keyword">function</span>(<span class="params">xs</span>) </span>&#123; <span class="keyword">return</span> reduce(add, <span class="number">0</span>, xs) / xs.length &#125;</span><br><span class="line"><span class="keyword">var</span> averageDollarValue = compose(_average, map(_.prop(<span class="string">'dollar_value'</span>)))</span><br><span class="line"><span class="keyword">var</span> _underscore = replace(<span class="regexp">/\W+/g</span>, <span class="string">'_'</span>)</span><br><span class="line"><span class="keyword">var</span> sanitizeNames = map(compose(_underscore, toLowerCase, _.prop(<span class="string">'name'</span>)))</span><br><span class="line"><span class="keyword">var</span> formatPrice = compose( accounting.formatMoney, _.prop(<span class="string">'dollar_value'</span>))</span><br><span class="line"><span class="keyword">var</span> availablePrices = compose( join(<span class="string">', '</span>), map(formatPrice), filter(_.prop(<span class="string">'in_stock'</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment">//+ fastestCar :: [Car] -&gt; String</span></span><br><span class="line"><span class="keyword">var</span> append = _.flip(_.concat)</span><br><span class="line"><span class="keyword">var</span> fastestCar = compose(append(<span class="string">' is the fastest'</span>),</span><br><span class="line">                           _.prop(<span class="string">'name'</span>),</span><br><span class="line">                           _.last,</span><br><span class="line">                           _.sortBy(_.prop(<span class="string">'horsepower'</span>)))</span><br><span class="line"></span><br><span class="line">isLastInStock(CARS)           <span class="comment">// false</span></span><br><span class="line">nameOfFirstCar(CARS)          <span class="comment">// Ferrari FF</span></span><br><span class="line">averageDollarValue(CARS)      <span class="comment">// 790700</span></span><br><span class="line">sanitizeNames(CARS)           <span class="comment">// [ 'ferrari_ff', ...</span></span><br><span class="line">availablePrices(CARS)         <span class="comment">// $700,000.00, $1,850,000.00</span></span><br><span class="line">fastestCar(CARS)              <span class="comment">// Aston Martin One-77 is the fastest</span></span><br></pre></td></tr></table></figure>
<h2 id="Example-Application"><a href="#Example-Application" class="headerlink" title="Example Application"></a>Example Application</h2><h3 id="Declarative-Coding"><a href="#Declarative-Coding" class="headerlink" title="Declarative Coding"></a>Declarative Coding</h3><p>We are going to switch our mindset. From here on out, we’ll stop telling the computer how to do its job and instead write a specification of what we’d like as a result. I’m sure you’ll find it much less stressful than trying to micromanage everything all the time.</p>
<blockquote>
<p>Declarative, as opposed to imperative, means that we will write expressions, as opposed to step by step instructions. Think of SQL. There is no “first do this, then do that”. There is one expression that specifies what we’d like from the database.</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// imperative</span></span><br><span class="line"><span class="keyword">var</span> makes = []</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span> i &lt; cars.length i++) &#123;</span><br><span class="line">  makes.push(cars[i].make)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// declarative</span></span><br><span class="line"><span class="keyword">var</span> makes = cars.map(<span class="function">(<span class="params">car</span>) =&gt;</span> car.make)</span><br></pre></td></tr></table></figure>
<p>It specifies what, not how. Thus, it wears the shiny declarative sash.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// imperative</span></span><br><span class="line"><span class="keyword">var</span> authenticate = <span class="function"><span class="keyword">function</span>(<span class="params">form</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> user = toUser(form)</span><br><span class="line">  <span class="keyword">return</span> logIn(user)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// declarative</span></span><br><span class="line"><span class="keyword">var</span> authenticate = compose(logIn, toUser)</span><br></pre></td></tr></table></figure>
<p>This leaves wiggle room for support code changes (different params for toUser) and results in our application code being a high level specification.</p>
<p>Because we are not encoding order of evaluation, declarative coding lends itself to parallel computing. This coupled with pure functions is why FP is a good option for the parallel future</p>
<h3 id="A-flickr-of-functional-programming"><a href="#A-flickr-of-functional-programming" class="headerlink" title="A flickr of functional programming"></a>A flickr of functional programming</h3><p>We will now build an example application in a declarative, composable way. We’ll still cheat and use side effects for now, but we’ll keep them minimal and separate from our pure codebase. We are going to build a browser widget that sucks in flickr images and displays them. Let’s start by scaffolding the app. Here’s the html:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.11/require.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"flickr.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">requirejs.config(&#123;</span><br><span class="line">  paths: &#123;</span><br><span class="line">    ramda: <span class="string">'https://cdnjs.cloudflare.com/ajax/libs/ramda/0.13.0/ramda.min'</span>,</span><br><span class="line">    jquery: <span class="string">'https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min'</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>([</span><br><span class="line">    <span class="string">'ramda'</span>,</span><br><span class="line">    <span class="string">'jquery'</span>,</span><br><span class="line">  ],</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">_, $</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> trace = _.curry(<span class="function"><span class="keyword">function</span>(<span class="params">tag, x</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(tag, x)</span><br><span class="line">      <span class="keyword">return</span> x</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// app goes here</span></span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<p>We’re pulling in <code>ramda</code> instead of <code>lodash</code> or some other utility library. It includes <code>compose</code>, <code>curry</code>, and more. I’ve used <code>requirejs</code>, which may seem like overkill, but we’ll be using it throughout and consistency is key. Also, I’ve started us off with our nice <code>trace</code> function for easy debugging.</p>
<p>Now that that’s out of the way, on to the spec. Our app will do 4 things.</p>
<ul>
<li>Construct a url for our particular search term</li>
<li>Make the flickr api call</li>
<li>Transform the resulting json into html images</li>
<li>Place them on the screen</li>
</ul>
<p>There are 2 impure actions mentioned above. Do you see them? Those bits about getting data from the flickr api and placing it on the screen. Let’s define those first so we can quarantine them.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Impure = &#123;</span><br><span class="line">  getJSON: _.curry(<span class="function"><span class="keyword">function</span>(<span class="params">callback, url</span>) </span>&#123;</span><br><span class="line">    $.getJSON(url, callback)</span><br><span class="line">  &#125;),</span><br><span class="line"></span><br><span class="line">  setHtml: _.curry(<span class="function"><span class="keyword">function</span>(<span class="params">sel, html</span>) </span>&#123;</span><br><span class="line">    $(sel).html(html)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Here we’ve simply wrapped jQuery’s methods to be curried and we’ve swapped the arguments to a more favorable position. I’ve namespaced them with Impure so we know these are dangerous functions. In a future example, we will make these two functions pure.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> url = <span class="function"><span class="keyword">function</span>(<span class="params">term</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'https://api.flickr.com/services/feeds/photos_public.gne?tags='</span> +</span><br><span class="line">    term + <span class="string">'&amp;format=json&amp;jsoncallback=?'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>There are fancy and overly complex ways of writing url pointfree using monoids(we’ll learn about these later) or combinators. We’ve chosen to stick with a readable version and assemble this string in the normal pointful fashion.</p>
<p>Let’s write an app function that makes the call and places the contents on the screen.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = _.compose(Impure.getJSON(trace(<span class="string">'response'</span>)), url)</span><br><span class="line"></span><br><span class="line">app(<span class="string">'picasso'</span>)</span><br></pre></td></tr></table></figure>
<p>Loading the app will show the response from the api call in the console.</p>
<figure class="highlight json"><figcaption><span>json response</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"title"</span>: <span class="string">"Recent Uploads tagged cats"</span>,</span><br><span class="line">  <span class="attr">"link"</span>: <span class="string">"https://www.flickr.com/photos/tags/cats/"</span>,</span><br><span class="line">  <span class="attr">"description"</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="attr">"modified"</span>: <span class="string">"2016-08-09T16:18:19Z"</span>,</span><br><span class="line">  <span class="attr">"generator"</span>: <span class="string">"https://www.flickr.com/"</span>,</span><br><span class="line">  <span class="attr">"items"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="attr">"title"</span>: <span class="string">"This little one followed our friend home and now she’s ours we just need a name! via http://ift.tt/29KELz0"</span>,</span><br><span class="line">    <span class="attr">"link"</span>: <span class="string">"https://www.flickr.com/photos/dozhub/28873505605/"</span>,</span><br><span class="line">    <span class="attr">"media"</span>: &#123;<span class="attr">"m"</span>:<span class="string">"https://farm8.staticflickr.com/7571/28873505605_0f1bf96d9d_m.jpg"</span>&#125;,</span><br><span class="line">    <span class="attr">"date_taken"</span>: <span class="string">"2016-08-09T09:18:19-08:00"</span>,</span><br><span class="line">    <span class="attr">"description"</span>: <span class="string">" &lt;p&gt;&lt;a href=\"https://www.flickr.com/people/dozhub/\"&gt;dozhub&lt;\/a&gt; posted a photo:&lt;\/p&gt; &lt;p&gt;&lt;a href=\"https://www.flickr.com/photos/dozhub/28873505605/\" title=\"This little one followed our friend home and now she’s ours we just need a name! via http://ift.tt/29KELz0\"&gt;&lt;img src=\"https://farm8.staticflickr.com/7571/28873505605_0f1bf96d9d_m.jpg\" width=\"240\" height=\"126\" alt=\"This little one followed our friend home and now she’s ours we just need a name! via http://ift.tt/29KELz0\" /&gt;&lt;\/a&gt;&lt;\/p&gt; &lt;p&gt;This little one followed our friend home and now she’s ours we just need a name! -&lt;br /&gt; &lt;br /&gt; This little one followed our friend home and now she’s ours we just need a name! – Cats, kittens and kittys, cute and adorable! Aww! (via &lt;a href=\"http://ift.tt/29KELz0\" rel=\"nofollow\"&gt;ift.tt/29KELz0&lt;\/a&gt;)&lt;br /&gt; &lt;br /&gt; - via &lt;a href=\"http://ift.tt/29KELz0\" rel=\"nofollow\"&gt;ift.tt/29KELz0&lt;\/a&gt;. Cats, kittens and kittys, cute and adorable! Aww!&lt;\/p&gt;"</span>,</span><br><span class="line">    <span class="attr">"published"</span>: <span class="string">"2016-08-09T16:18:19Z"</span>,</span><br><span class="line">    <span class="attr">"author"</span>: <span class="string">"nobody@flickr.com (dozhub)"</span>,</span><br><span class="line">    <span class="attr">"author_id"</span>: <span class="string">"143919671@N07"</span>,</span><br><span class="line">    <span class="attr">"tags"</span>: <span class="string">"cat kitty kitten cute funny aww adorable cats"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    ...</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We’d like to construct images out of this json. It looks like the srcs are buried in <code>items</code> then each <code>media</code>‘s <code>m</code> property. To get at these nested properties we can use a nice universal getter function from <code>ramda</code> called <code>_.prop()</code>. Let’s use this to get at our srcs.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mediaUrl = _.compose(_.prop(<span class="string">'m'</span>), _.prop(<span class="string">'media'</span>))</span><br><span class="line"><span class="keyword">var</span> srcs = _.compose(_.map(mediaUrl), _.prop(<span class="string">'items'</span>))</span><br></pre></td></tr></table></figure>
<p>Once we gather the items, we must map over them to extract each media url.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> renderImages = _.compose(Impure.setHtml(<span class="string">'body'</span>), srcs)</span><br><span class="line"><span class="keyword">var</span> app = _.compose(Impure.getJSON(renderImages), url)</span><br></pre></td></tr></table></figure>
<p>All we’ve done is make a new composition that will call our srcs and set the body html with them. We’ve replaced the trace call with renderImages. This will crudely display our srcs directly in the body.</p>
<p>Our final step is to turn these srcs into bonafide images. In a bigger application, we’d use a template/dom library like Handlebars or React. For this application though, we only need an img tag so let’s stick with jQuery.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> img = <span class="function"><span class="keyword">function</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> $(<span class="string">'&lt;img /&gt;'</span>, &#123;</span><br><span class="line">    src: url</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>jQuery’s html() method will accept an array of tags. We only have to transform our srcs into images and send them along to setHtml.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> images = _.compose(_.map(img), srcs)</span><br><span class="line"><span class="keyword">var</span> renderImages = _.compose(Impure.setHtml(<span class="string">'body'</span>), images)</span><br><span class="line"><span class="keyword">var</span> app = _.compose(Impure.getJSON(renderImages), url)</span><br><span class="line"></span><br><span class="line">app(<span class="string">'picasso'</span>)</span><br></pre></td></tr></table></figure>
<p>And we’re done!  Here’s the finished script.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">requirejs.config(&#123;</span><br><span class="line">  paths: &#123;</span><br><span class="line">    ramda: <span class="string">'https://cdnjs.cloudflare.com/ajax/libs/ramda/0.13.0/ramda.min'</span>,</span><br><span class="line">    jquery: <span class="string">'https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min'</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">require</span>([</span><br><span class="line">    <span class="string">'ramda'</span>,</span><br><span class="line">    <span class="string">'jquery'</span>,</span><br><span class="line">  ],</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">_, $</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> trace = _.curry(<span class="function"><span class="keyword">function</span>(<span class="params">tag, x</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(tag, x)</span><br><span class="line">      <span class="keyword">return</span> x</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> Impure = &#123;</span><br><span class="line">      getJSON: _.curry(<span class="function"><span class="keyword">function</span>(<span class="params">callback, url</span>) </span>&#123;</span><br><span class="line">        $.getJSON(url, callback)</span><br><span class="line">      &#125;),</span><br><span class="line">      setHtml: _.curry(<span class="function"><span class="keyword">function</span>(<span class="params">sel, html</span>) </span>&#123;</span><br><span class="line">        $(sel).html(html)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> url = <span class="function"><span class="keyword">function</span>(<span class="params">term</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">'https://api.flickr.com/services/feeds/photos_public.gne?tags='</span> +</span><br><span class="line">        term + <span class="string">'&amp;format=json&amp;jsoncallback=?'</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> mediaUrl = _.compose(_.prop(<span class="string">'m'</span>), _.prop(<span class="string">'media'</span>))</span><br><span class="line">    <span class="keyword">var</span> srcs = _.compose(_.map(mediaUrl), _.prop(<span class="string">'items'</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> img = <span class="function"><span class="keyword">function</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> $(<span class="string">'&lt;img /&gt;'</span>, &#123;</span><br><span class="line">        src: url</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> images = _.compose(_.map(img), srcs)</span><br><span class="line">    <span class="keyword">var</span> renderImages = _.compose(Impure.setHtml(<span class="string">'body'</span>), images)</span><br><span class="line">    <span class="keyword">var</span> app = _.compose(Impure.getJSON(renderImages), url)</span><br><span class="line"></span><br><span class="line">    app(<span class="string">'picasso'</span>)</span><br><span class="line"></span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<h3 id="A-Principled-Refactor"><a href="#A-Principled-Refactor" class="headerlink" title="A Principled Refactor"></a>A Principled Refactor</h3><p>There is an optimization available - we map over each item to turn it into a media url, then we map again over those srcs to turn them into img tags. There is a law regarding map and composition:</p>
<blockquote>
<p>map’s composition law<br><code>var law = compose(map(f), map(g)) === map(compose(f, g))</code></p>
</blockquote>
<p>Let’s refactor from original</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// original code</span></span><br><span class="line"><span class="keyword">var</span> mediaUrl = _.compose(_.prop(<span class="string">'m'</span>), _.prop(<span class="string">'media'</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> srcs = _.compose(_.map(mediaUrl), _.prop(<span class="string">'items'</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> images = _.compose(_.map(img), srcs)</span><br></pre></td></tr></table></figure>
<p>to this</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mediaUrl = _.compose(_.prop(<span class="string">'m'</span>), _.prop(<span class="string">'media'</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> images = _.compose(_.map(img), _.map(mediaUrl), _.prop(<span class="string">'items'</span>))</span><br></pre></td></tr></table></figure>
<p>to this</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mediaUrl = _.compose(_.prop(<span class="string">'m'</span>), _.prop(<span class="string">'media'</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> images = _.compose(_.map(_.compose(img, mediaUrl)), _.prop(<span class="string">'items'</span>))</span><br></pre></td></tr></table></figure>
<p>Let’s just make it a little more readable by extracting the function out.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mediaUrl = _.compose(_.prop(<span class="string">'m'</span>), _.prop(<span class="string">'media'</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mediaToImg = _.compose(img, mediaUrl)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> images = _.compose(_.map(mediaToImg), _.prop(<span class="string">'items'</span>))</span><br></pre></td></tr></table></figure>
<p>Now the bugger will only loop once while turning each item into an img.</p>
<h3 id="Summary-4"><a href="#Summary-4" class="headerlink" title="Summary"></a>Summary</h3><p>We have seen how to put our new skills into use with a small, but real world app. We’ve also used our mathematical framework to reason about and refactor our code.</p>
<h2 id="Hindley-Milner-Type-Signatures"><a href="#Hindley-Milner-Type-Signatures" class="headerlink" title="Hindley-Milner Type Signatures"></a>Hindley-Milner Type Signatures</h2><blockquote>
<p>Hindley-Milner Type Signatures: a comment that documents a function with type data</p>
</blockquote>
<p>Takes a string and returns a string.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  capitalize :: String -&gt; String</span></span><br><span class="line"><span class="keyword">var</span> capitalize = <span class="function"><span class="keyword">function</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> toUpperCase(head(s)) + toLowerCase(tail(s))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">capitalize(<span class="string">"smurf"</span>)</span><br><span class="line"><span class="comment">//=&gt; "Smurf"</span></span><br></pre></td></tr></table></figure>
<p>An example of handling arrays and currying.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  strLength :: String -&gt; Number</span></span><br><span class="line"><span class="keyword">var</span> strLength = <span class="function"><span class="keyword">function</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> s.length</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  join :: String -&gt; [String] -&gt; String</span></span><br><span class="line"><span class="keyword">var</span> join = curry(<span class="function"><span class="keyword">function</span>(<span class="params">what, xs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> xs.join(what)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//  match :: Regex -&gt; String -&gt; [String]</span></span><br><span class="line"><span class="keyword">var</span> match = curry(<span class="function"><span class="keyword">function</span>(<span class="params">reg, s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> s.match(reg)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//  replace :: Regex -&gt; String -&gt; String -&gt; String</span></span><br><span class="line"><span class="keyword">var</span> replace = curry(<span class="function"><span class="keyword">function</span>(<span class="params">reg, sub, s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> s.replace(reg, sub)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>An example of handling function parameters.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  id :: a -&gt; a</span></span><br><span class="line"><span class="keyword">var</span> id = <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  map :: (a -&gt; b) -&gt; [a] -&gt; [b]</span></span><br><span class="line"><span class="keyword">var</span> map = curry(<span class="function"><span class="keyword">function</span>(<span class="params">f, xs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> xs.map(f)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Let’s dissect the Hindley-Milner Type Signature of the <code>map</code> function:</p>
<table>
<thead>
<tr>
<th>about the map function</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>function name</td>
<td>// <code>map</code> :: (a -&gt; b) -&gt; [a] -&gt; [b]</td>
</tr>
<tr>
<td>2 parameters</td>
<td>// map :: <code>(a -&gt; b) -&gt; [a]</code> -&gt; [b]</td>
</tr>
<tr>
<td>return value</td>
<td>// map :: (a -&gt; b) -&gt; [a] -&gt; <code>[b]</code></td>
</tr>
</tbody>
</table>
<p>What else can we infer about that function parameter?</p>
<table>
<thead>
<tr>
<th>about the function parameter</th>
<th>// map :: <code>(a -&gt; b)</code> -&gt; [a] -&gt; [b]</th>
</tr>
</thead>
<tbody>
<tr>
<td>only parameter <code>a</code></td>
<td>is the same type as <code>[a]</code> items</td>
</tr>
<tr>
<td>return value <code>b</code></td>
<td>is the same type as <code>[b]</code> items</td>
</tr>
</tbody>
</table>
<p>A few more…</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  head :: [a] -&gt; a</span></span><br><span class="line"><span class="keyword">var</span> head = <span class="function"><span class="keyword">function</span>(<span class="params">xs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> xs[<span class="number">0</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  filter :: (a -&gt; Bool) -&gt; [a] -&gt; [a]</span></span><br><span class="line"><span class="keyword">var</span> filter = curry(<span class="function"><span class="keyword">function</span>(<span class="params">f, xs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> xs.filter(f)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//  reduce :: (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b</span></span><br><span class="line"><span class="keyword">var</span> reduce = curry(<span class="function"><span class="keyword">function</span>(<span class="params">f, x, xs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> xs.reduce(f, x)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Let’s dissect the Hindley-Milner Type Signature of the <code>reduce</code> function:</p>
<table>
<thead>
<tr>
<th>about the reduce function</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>function name</td>
<td>// <code>reduce</code> :: (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b</td>
</tr>
<tr>
<td>3 parameters</td>
<td>// reduce :: <code>(b -&gt; a -&gt; b) -&gt; b -&gt; [a]</code> -&gt; b</td>
</tr>
<tr>
<td>return value</td>
<td>// reduce :: (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; <code>b</code></td>
</tr>
</tbody>
</table>
<p>What else can we deduce about that function parameter?</p>
<table>
<thead>
<tr>
<th>about the function parameter</th>
<th>// reduce :: <code>(b -&gt; a -&gt; b)</code> -&gt; b -&gt; [a] -&gt; b</th>
</tr>
</thead>
<tbody>
<tr>
<td>1<sup>st</sup> parameter <code>b</code></td>
<td>is the same type as the initializer</td>
</tr>
<tr>
<td>2<sup>nd</sup> parameter <code>a</code></td>
<td>is the same type as <code>[a]</code> items</td>
</tr>
<tr>
<td>return value <code>b</code></td>
<td>is the same type as the initializer</td>
</tr>
</tbody>
</table>
<h3 id="Parametricity"><a href="#Parametricity" class="headerlink" title="Parametricity"></a>Parametricity</h3><p>Once a <code>type variable</code> is introduced, there emerges a curious property called <code>parametricity</code>.</p>
<blockquote>
<p>parametricity states that a function will act on all types in a uniform manner.</p>
</blockquote>
<p>Let’s investigate:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// head :: [a] -&gt; a</span></span><br></pre></td></tr></table></figure>
<p>Looking at head, we see that it takes <code>[a]</code> to <code>a</code>. Besides the concrete type array, it has no other information available and, therefore, its functionality is limited to working on the array alone. The return value <code>a</code> says it cannot be a specific type, which means it can be any type, which leaves us with a function that must work uniformly for every conceivable type. This is what parametricity is all about.</p>
<p>We can deduce that the function cannot change the type, narrowing the possible actions the function can take.</p>
<h3 id="Theorems"><a href="#Theorems" class="headerlink" title="Theorems"></a>Theorems</h3><p>A few random example theorems lifted directly from Wadler’s paper on the subject.</p>
<pre><code>// head :: [a] -&gt; a
compose(f, head) == compose(head, map(f))

// filter :: (a -&gt; Bool) -&gt; [a] -&gt; [a]
compose(map(f), filter(compose(p, f))) === compose(filter(p), map(f))
</code></pre><p>The <code>head</code> theorem says that if we get the <code>head</code> of our array, then run some function <code>f</code> on it, that is equivalent to, and incidentally, much faster than, if we first <code>map(f)</code> over every element then take the <code>head</code> of the result.</p>
<p>You might think, well that’s just common sense. But last I checked, computers don’t have common sense. Indeed, they must have a formal way to automate these kind of code optimizations. Maths has a way of formalizing the intuitive, which is helpful amidst the rigid terrain of computer logic.</p>
<p>The <code>filter</code> theorem is similar. It says that if we compose <code>f</code> and <code>p</code> to check which should be filtered, then actually apply the <code>f</code> via <code>map</code> (remember filter, will not transform the elements - its signature enforces that a will not be touched), it will always be equivalent to mapping our <code>f</code> then filtering the result with the <code>p</code> predicate.</p>
<p>These are just two examples, but you can apply this reasoning to any <code>polymorphic type signature</code> and it will always hold. In JavaScript, there are some tools available to declare rewrite rules. One might also do this via the <code>compose</code> function itself. The fruit is low hanging and the possibilities are endless.</p>
<h3 id="Constraints"><a href="#Constraints" class="headerlink" title="Constraints"></a>Constraints</h3><p>One last thing to note is that we can constrain types to an interface.</p>
<pre><code>// sort :: Ord a =&gt; [a] -&gt; [a]
</code></pre><p>What we see on the left side of our fat arrow here is the statement of a fact: <code>a</code> must be an <code>Ord</code>. Or in other words, <code>a</code> must implement the <code>Ord interface</code>. What is Ord and where did it come from? In a typed language it would be a <code>defined interface</code> that says we can order the values. This not only tells us more about the <code>a</code> and what our sort function is up to, but also restricts the domain. We call these interface declarations <code>type constraints</code>.</p>
<pre><code>// assertEqual :: (Eq a, Show a) =&gt; a -&gt; a -&gt; Assertion
</code></pre><p>Here, we have two constraints: <code>Eq</code> and <code>Show</code>. Those will ensure that we can check equality of our as and print the difference if they are not equal.</p>
<h3 id="Summary-5"><a href="#Summary-5" class="headerlink" title="Summary"></a>Summary</h3><p>Hindley-Milner type signatures are ubiquitous in the functional world. Though they are simple to read and write, it takes time to master the technique of understanding programs through signatures alone. We will add type signatures to each line of code from here on out.</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>For this post we’ve covered the first 7 chapters of the book, but there is more to learn.  In the next post we will learn about error handling, code branching, how can we make the whole application pure instead of merely namespacing destructive functions, and how can we make our app safer and more expressive.</p>

        </div>
        
        <div class="post-tag">
            
            <a class="tag" href="/tags/javascript/" title="javascript">javascript</a>
            
            <a class="tag" href="/tags/functional/" title="functional">functional</a>
            
        </div>
        
    </article>
</div>
<div class="paginator">
    
        
            <a class="prev" href="/2016/08/10/2016/20160831-guide-to-FP-part2/">
                <i class="iconfont icon-prev"></i>
                <span class="nav-default">Frisby&#39;s Mostly Adequate Guide to Functional Programming - Part 2</span>
                <span class="nav-mobile">Prev</span>
            </a>
        
        
            <a class="next" href="/2016/07/19/2016/20160719-python-virtual-environments/">
                <span class="nav-default">python virtual environments</span>
                <span class="nav-mobile">Next</span>
                <i class="iconfont icon-next"></i>
            </a>
        
    
</div>
<div id="comment-container"></div>
    </div>
</div>
<footer class="footer-social">
    
    <a class="social-link" target="_blank" href="https://github.com/dearfrankg">
        <i class="iconfont icon-github"></i>
    </a>
    

    

    

    <div class="footer-copyright">
        <p class="time-line">
            &copy;
            
            
            2018
            &nbsp;<i class="iconfont icon-heart"></i>&nbsp;
            <a target="_blank" href="https://github.com/dearfrankg">Frank Gutierrez</a>
        </p>
    </div>
</footer>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="/js/index.js"></script>
<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> -->
<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
<script>
    

</script>
</html>
